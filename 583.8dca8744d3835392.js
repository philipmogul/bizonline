"use strict";(self.webpackChunkmatngular=self.webpackChunkmatngular||[]).push([[583],{583:(S,v,i)=>{i.d(v,{L:()=>J});var r=i(5861),c=i(4006),g=i(2340),o=i(4650),u=i(2318),y=i(1927),b=i(1932),w=i(8423),C=i(3166),E=i(7185),D=i(805),P=i(9775),M=i(5421),T=i(6895),x=i(1493),k=i(2137),O=i(5593),U=i(1740),A=i(3942);function Z(p,_){1&p&&(o.TgZ(0,"div",37),o._UZ(1,"img",38),o.TgZ(2,"p"),o._uU(3,"Downloading..."),o.qZA()())}function L(p,_){if(1&p&&o._UZ(0,"app-notification",39),2&p){const e=o.oxw();o.Q6J("message","Download completed!")("showNotification",e.showNotification)}}const N=function(){return{width:"30vw"}},I=function(){return{width:"15vw"}},B=function(){return{width:"40vw"}};let J=(()=>{class p{constructor(e,t,a,n,l,d,h,s,m,f,R,K){this.router=e,this.authSrv=t,this.apiSrv=a,this.spinner=n,this.route=l,this.cryptoSrv=d,this.toastr=h,this.confirmationService=s,this.printSrv=m,this.indexedDBService=f,this.datePipe=R,this.cdr=K,this.loginFormSubmitted=!1,this.isLoginFailed=!1,this.loginForm=new c.nJ({username:new c.p4("guest@apex.com",[c.kI.required]),password:new c.p4("Password",[c.kI.required]),rememberMe:new c.p4(!0)}),this.model={},this.showAddDeviceDialog=!1,this.newDeviceName="",this.deviceMac="",this.showNotification=!1,this.showDownload=!1}ngOnInit(){var e=this;return(0,r.Z)(function*(){try{null!=(yield e.authSrv.fetchValueByKey("mac"))?""!=e.authSrv.getUserDetailToken("uid")&&null!=e.authSrv.getUserDetailToken("uid")?"admin"===e.cryptoSrv.decryptEncodedText(e.authSrv.getUserDetailToken("role"))?e.router.navigate(["/dashboard"]):"employee"===e.cryptoSrv.decryptEncodedText(e.authSrv.getUserDetailToken("role"))?e.router.navigate(["/cash-sale"]):localStorage.clear():localStorage.clear():"localhost"===window.location.hostname?e.printSrv.getDeviceMac().then(function(){var n=(0,r.Z)(function*(l){try{yield e.authSrv.storeKeyValuePair("mac",e.cryptoSrv.encodeEncryptText(l)),""!=e.authSrv.getUserDetailToken("uid")&&null!=e.authSrv.getUserDetailToken("uid")?"admin"===e.cryptoSrv.decryptEncodedText(e.authSrv.getUserDetailToken("role"))?e.router.navigate(["/dashboard"]):"employee"===e.cryptoSrv.decryptEncodedText(e.authSrv.getUserDetailToken("role"))?e.router.navigate(["/cash-sale"]):localStorage.clear():localStorage.clear()}catch{e.toastr.error("Please refresh the page")}});return function(l){return n.apply(this,arguments)}}()).catch(n=>{}):""!=e.authSrv.getUserDetailToken("uid")&&null!=e.authSrv.getUserDetailToken("uid")?"admin"===e.cryptoSrv.decryptEncodedText(e.authSrv.getUserDetailToken("role"))?e.router.navigate(["/dashboard"]):"employee"===e.cryptoSrv.decryptEncodedText(e.authSrv.getUserDetailToken("role"))?e.printSrv.getDeviceMac().then(function(){var n=(0,r.Z)(function*(l){try{e.router.navigate(["/cash-sale"])}catch{e.toastr.error("Please refresh the page")}});return function(l){return n.apply(this,arguments)}}()).catch(n=>{e.toastr.error("Please refresh the page")}):localStorage.clear():localStorage.clear()}catch{e.toastr.error("Please refresh the page")}})()}get lf(){return this.loginForm.controls}onSubmit(){this.loginFormSubmitted=!0,!this.loginForm.invalid&&this.spinner.show(void 0,{type:"ball-triangle-path",size:"medium",bdColor:"rgba(0, 0, 0, 0.8)",color:"#fff",fullScreen:!0})}login(){var e=this;return(0,r.Z)(function*(){e.spinner.show();const t={action:e.cryptoSrv.encodeEncryptText("login-offline"),mobile:e.cryptoSrv.encodeEncryptText(e.model.mobile),password:e.cryptoSrv.encodeEncryptText(e.model.password)};e.authSrv.login(t).then(function(){var a=(0,r.Z)(function*(n){if("error"!==n.status){const l=window.location.hostname,d=window.location.port;if("localhost"===l&&"4200"!==d&&"http://localhost/FedhaApi/api.php"===g.N.apiUrl)e.spinner.hide(),e.showDownload=!0,e.cdr.detectChanges(),e.downloadSales(n);else if("localhost"===l&&"4200"!==d&&"http://localhost/FedhaApi/api.php"!==g.N.apiUrl){e.authSrv.setToken(n.access_token,n.uid,n.nm,n.img,n.role),e.authSrv.setUserShop(n.shop),e.spinner.hide();const h=window.location.hostname,s=e.cryptoSrv.decryptEncodedText(n.role);if("localhost"!=h&&"admin"==s){let m=e.cryptoSrv.decryptEncodedText(n.latest_date);m=new Date(m),m=e.datePipe.transform(m,"full")}}else if("admin"===e.cryptoSrv.decryptEncodedText(n.role)){e.authSrv.setToken(n.access_token,n.uid,n.nm,n.img,n.role),e.authSrv.setUserShop(n.shop),e.spinner.hide();const s=window.location.hostname,m=e.cryptoSrv.decryptEncodedText(n.role);if("localhost"!=s&&"admin"==m){let f=e.cryptoSrv.decryptEncodedText(n.latest_date);f=new Date(f),f=e.datePipe.transform(f,"full")}}else e.authSrv.setToken(n.access_token,n.uid,n.nm,n.img,n.role),e.authSrv.setUserShop(n.shop),e.spinner.hide()}else n.ad&&"1"===e.cryptoSrv.decryptEncodedText(n.ad)?e.showAdminDialog():n.ad&&"0"===e.cryptoSrv.decryptEncodedText(n.ad)?e.toastr.error(n.message,"Device not registered!"):e.toastr.error(n.message),e.spinner.hide()});return function(n){return a.apply(this,arguments)}}()).catch(a=>{e.toastr.error(a),e.spinner.hide()})})()}downloadSales(e){var t=this;return(0,r.Z)(function*(){if(t.showNotification=!1,yield t.apiSrv.userIsOnline()){const a={action:t.cryptoSrv.encodeEncryptText("restore-locally"),added_by:e.uid};t.apiSrv.post(a).then(n=>{if("error"!=n.status)if("error2"!=n.status){t.showNotification=!0,setTimeout(()=>{t.showDownload=!1,t.cdr.detectChanges(),t.authSrv.setToken(e.access_token,e.uid,e.nm,e.img,e.role),t.authSrv.setUserShop(e.shop),t.spinner.hide()},1700);const d=window.location.hostname,h=t.cryptoSrv.decryptEncodedText(e.role);if("localhost"!=d&&"admin"==h){let s=t.cryptoSrv.decryptEncodedText(e.latest_date);s=new Date(s),s=t.datePipe.transform(s,"full")}}else t.showDownload=!1,t.cdr.detectChanges(),t.toastr.error("Please login again.","Login session expired!"),t.authSrv.logout(),t.spinner.hide();else t.showDownload=!1,t.cdr.detectChanges(),t.spinner.hide(),n.message.includes("You are about to lose transactions made offline after")&&t.confirmationService.confirm({header:"Confirm",message:n.message+"<br>Download to lose only the offline transactions.<br>Ignore to lose only the online transactions..",acceptButtonStyleClass:"btn btn-primary",rejectButtonStyleClass:"btn btn-info",acceptLabel:"Download",rejectLabel:"Ignore",closeOnEscape:!1,accept:()=>{t.showDownload=!0,t.cdr.detectChanges(),t.downloadConfirmed(e)},reject:()=>{t.showNotification=!0,setTimeout(()=>{t.showDownload=!1,t.cdr.detectChanges(),t.authSrv.setToken(e.access_token,e.uid,e.nm,e.img,e.role),t.authSrv.setUserShop(e.shop),t.spinner.hide()},1700);const d=window.location.hostname,h=t.cryptoSrv.decryptEncodedText(e.role);if("localhost"!=d&&"admin"==h){let s=t.cryptoSrv.decryptEncodedText(e.latest_date);s=new Date(s),s=t.datePipe.transform(s,"full")}}})}).catch(n=>{t.showDownload=!1,t.cdr.detectChanges(),t.toastr.error(n),t.spinner.hide()})}else t.confirmationService.confirm({header:"Online srver not reachable!",message:"Connection to the online server cannot be established. Do you wish to proceed without downloading any updates?",acceptButtonStyleClass:"btn btn-primary",rejectButtonStyleClass:"btn btn-danger",acceptLabel:"Proceed",rejectLabel:"Cancel",accept:()=>{t.showDownload=!1,t.cdr.detectChanges(),t.authSrv.setToken(e.access_token,e.uid,e.nm,e.img,e.role),t.authSrv.setUserShop(e.shop),t.spinner.hide();const a=window.location.hostname,n=t.cryptoSrv.decryptEncodedText(e.role);if("localhost"!=a&&"admin"==n){let l=t.cryptoSrv.decryptEncodedText(e.latest_date);l=new Date(l),l=t.datePipe.transform(l,"full")}},reject:()=>{t.showDownload=!1}})})()}downloadConfirmed(e){var t=this;return(0,r.Z)(function*(){const a={action:t.cryptoSrv.encodeEncryptText("restore-locally-confirmed"),added_by:e.uid};t.apiSrv.post(a).then(n=>{if("error"!=n.status)if("error2"!=n.status){t.showNotification=!0,setTimeout(()=>{t.showDownload=!1,t.cdr.detectChanges(),t.authSrv.setToken(e.access_token,e.uid,e.nm,e.img,e.role),t.authSrv.setUserShop(e.shop),t.spinner.hide()},1700);const d=window.location.hostname,h=t.cryptoSrv.decryptEncodedText(e.role);if("localhost"!=d&&"admin"==h){let s=t.cryptoSrv.decryptEncodedText(e.latest_date);s=new Date(s),s=t.datePipe.transform(s,"full")}}else t.showDownload=!1,t.cdr.detectChanges(),t.toastr.error("Please login again.","Login session expired!"),t.authSrv.logout(),t.spinner.hide()}).catch(n=>{t.showDownload=!1,t.cdr.detectChanges(),t.toastr.error(n),t.spinner.hide()})})()}mobileFormatCorrect(e){return!("254"!==e.substring(0,3)||12!==e?.length||"-"===e.substring(0,1))}showAdminDialog(){localStorage.clear(),this.confirmationService.confirm({message:"This computer is not yet registered to access the system. Do you want to register it?",acceptButtonStyleClass:"btn btn-primary",rejectButtonStyleClass:"btn btn-danger",accept:()=>{this.showAddDeviceDialog=!0},reject:()=>{}})}addDevice(){this.spinner.show("adddevice");const e={action:this.cryptoSrv.encodeEncryptText("add-device"),name:this.cryptoSrv.encodeEncryptText(this.newDeviceName),mobile:this.cryptoSrv.encodeEncryptText(this.model.mobile),password:this.cryptoSrv.encodeEncryptText(this.model.password)};this.apiSrv.addDevice(e).then(t=>{this.showAddDeviceDialog=!1,"error"!==t.status?(this.spinner.hide("adddevice"),this.toastr.success(t.message),this.newDeviceName="",this.showAddDeviceDialog=!1,this.cdr.detectChanges()):(this.toastr.error(t.message),this.spinner.hide("adddevice"))}).catch(t=>{this.toastr.error(t),this.spinner.hide()})}hideDeviceDialog(){this.newDeviceName="",this.showAddDeviceDialog=!1}}return p.\u0275fac=function(e){return new(e||p)(o.Y36(u.F0),o.Y36(y.e),o.Y36(b.s),o.Y36(w.t2),o.Y36(u.gz),o.Y36(C.$),o.Y36(E._W),o.Y36(D.YP),o.Y36(P.$),o.Y36(M.ys),o.Y36(T.uU),o.Y36(o.sBO))},p.\u0275cmp=o.Xpm({type:p,selectors:[["app-login-page"]],decls:45,vars:24,consts:[["id","login"],[1,"row","auth-height","full-height-vh","m-0"],[1,"col-12","d-flex","align-items-center","justify-content-center"],[1,"card","overflow-hidden"],[1,"card-content"],[1,"card-body","auth-img"],[1,"row","m-0"],[1,"col-lg-6","d-none","d-lg-flex","justify-content-center","align-items-center","auth-img-bg","p-3"],["src","assets/img/logos/logo.webp","alt","","width","300","height","230",1,"img-fluid"],[1,"col-lg-6","col-12","px-4","py-5"],[1,"mb-2","card-title"],["autocomplete","off"],["form","ngForm"],[1,"form-group"],["type","text","placeholder","Username or mobile number","name","mobile","required","",1,"form-control",3,"ngModel","ngModelChange"],["mobileCtrl","ngModel"],["type","password","placeholder","Password","name","password","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"d-flex","justify-content-between","flex-sm-row","flex-column"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],["bdColor","#fcfcfcb6","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[2,"color","#fcfcfcb6"],["appendTo","body","modal","true","header","Add computer name",3,"closable","visible","visibleChange"],["form2","ngForm"],[1,"row"],[1,"col-md-12"],[1,"ui-fluid","px-2"],[1,"p-field"],["for","firstname3",2,"text-transform","none"],["id","firstname3","name","name","required","","type","text","pInputText","",1,"form-control",3,"ngModel","ngModelChange"],["type","button","pButton","","icon","pi pi-times","label","Cancel",1,"p-button-sm","p-button-danger","mr-3","float-right",3,"click"],["type","button","pButton","","icon","pi pi-check","label","Save",1,"p-button-sm","p-button-success","mr-3","float-right",3,"disabled","click"],["bdOpacity","#fff","name","adddevice","bdColor","rgba(255,255,255,0.76)","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[2,"color","#02926e"],["appendTo","body","modal","true",3,"closable","visible","visibleChange"],["class","text-center",4,"ngIf"],[3,"message","showNotification",4,"ngIf"],["header","Computer not registered","icon","pi pi-exclamation-triangle","appendTo","body",3,"baseZIndex","transitionOptions"],[1,"text-center"],["alt","img","src","assets/img/logos/sync2.gif",2,"height","60%","width","60%","margin-left","23px"],[3,"message","showNotification"]],template:function(e,t){if(1&e&&(o.TgZ(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7),o._UZ(8,"img",8),o.qZA(),o.TgZ(9,"div",9)(10,"h4",10),o._uU(11,"Login"),o.qZA(),o.TgZ(12,"p"),o._uU(13,"Welcome back, login to your account."),o.qZA(),o.TgZ(14,"form",11,12)(16,"div",13)(17,"input",14,15),o.NdJ("ngModelChange",function(n){return t.model.mobile=n}),o.qZA()(),o.TgZ(19,"div",13)(20,"input",16),o.NdJ("ngModelChange",function(n){return t.model.password=n}),o.qZA()(),o.TgZ(21,"div",17)(22,"button",18),o.NdJ("click",function(){return t.login()}),o._uU(23,"Login"),o.qZA()()(),o.TgZ(24,"ngx-spinner",19),o._UZ(25,"p",20),o.qZA()()()()()()()(),o.TgZ(26,"p-dialog",21),o.NdJ("visibleChange",function(n){return t.showAddDeviceDialog=n}),o.TgZ(27,"form",11,22)(29,"div",23)(30,"div",24)(31,"div",25)(32,"div",26)(33,"label",27),o._uU(34,"Computer name"),o.qZA(),o.TgZ(35,"input",28),o.NdJ("ngModelChange",function(n){return t.newDeviceName=n}),o.qZA()()()()()(),o.TgZ(36,"p-footer")(37,"button",29),o.NdJ("click",function(){return t.hideDeviceDialog()}),o.qZA(),o.TgZ(38,"button",30),o.NdJ("click",function(){return t.addDevice()}),o.qZA()(),o.TgZ(39,"ngx-spinner",31),o._UZ(40,"p",32),o.qZA()()(),o.TgZ(41,"p-dialog",33),o.NdJ("visibleChange",function(n){return t.showDownload=n}),o.YNc(42,Z,4,0,"div",34),o.YNc(43,L,1,2,"app-notification",35),o.qZA(),o._UZ(44,"p-confirmDialog",36)),2&e){const a=o.MAs(28);o.xp6(17),o.Q6J("ngModel",t.model.mobile),o.xp6(3),o.Q6J("ngModel",t.model.password),o.xp6(2),o.Q6J("disabled",""==t.model.mobile||""==t.model.password||null==t.model.mobile||null==t.model.password),o.xp6(2),o.Q6J("fullScreen",!1),o.xp6(2),o.Akn(o.DdM(21,N)),o.Q6J("closable",!1)("visible",t.showAddDeviceDialog),o.xp6(9),o.Q6J("ngModel",t.newDeviceName),o.xp6(3),o.Q6J("disabled",!a.valid),o.xp6(1),o.Q6J("fullScreen",!1),o.xp6(2),o.Akn(o.DdM(22,I)),o.Q6J("closable",!1)("visible",t.showDownload),o.xp6(1),o.Q6J("ngIf",t.showDownload&&!t.showNotification),o.xp6(1),o.Q6J("ngIf",t.showNotification),o.xp6(1),o.Akn(o.DdM(23,B)),o.Q6J("baseZIndex",1e4)("transitionOptions","300ms")}},dependencies:[T.O5,w.Ro,c._Y,c.Fj,c.JJ,c.JL,c.Q7,c.On,c.F,x.V,D.$_,k.Q,O.Hq,U.o,A.c],styles:[".alert-light-danger[_ngcontent-%COMP%]{background-color:#feefd0!important;color:#f55252!important;border-color:#feefd0}"]}),p})()},3942:(S,v,i)=>{i.d(v,{c:()=>c});var r=i(4650);let c=(()=>{class g{constructor(){}ngOnInit(){}}return g.\u0275fac=function(u){return new(u||g)},g.\u0275cmp=r.Xpm({type:g,selectors:[["app-notification"]],inputs:{message:"message",showNotification:"showNotification"},decls:6,vars:1,consts:[[1,"wrapper1"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 52 52",1,"checkmark"],["cx","26","cy","26","r","25","fill","none",1,"checkmark__circle"],["fill","none","d","M14.1 27.2l7.1 7.2 16.7-16.8",1,"checkmark__check"],[2,"position","absolute","margin-top","150px","margin-bottom","50px","font-weight","bold"]],template:function(u,y){1&u&&(r.TgZ(0,"div",0),r.O4$(),r.TgZ(1,"svg",1),r._UZ(2,"circle",2)(3,"path",3),r.qZA(),r.kcU(),r.TgZ(4,"p",4),r._uU(5),r.qZA()()),2&u&&(r.xp6(5),r.hij(" ",y.message," "))},styles:["*[_ngcontent-%COMP%]{padding:0;margin:0}.wrapper1[_ngcontent-%COMP%]{height:100%;display:flex;justify-content:center;align-items:center;background-color:transparent}.checkmark__circle[_ngcontent-%COMP%]{stroke-dasharray:166;stroke-dashoffset:166;stroke-width:2;stroke-miterlimit:10;stroke:#7ac142;fill:none;animation:stroke .6s cubic-bezier(.65,0,.45,1) forwards}.checkmark[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%;display:block;stroke-width:2;stroke:#fff;stroke-miterlimit:10;margin:10% auto;box-shadow:inset 0 0 #7ac142;animation:fill .4s ease-in-out .4s forwards,scale .3s ease-in-out .9s both}.checkmark__check[_ngcontent-%COMP%]{transform-origin:50% 50%;stroke-dasharray:48;stroke-dashoffset:48;animation:stroke .3s cubic-bezier(.65,0,.45,1) .8s forwards}@keyframes stroke{to{stroke-dashoffset:0}}@keyframes scale{0%,to{transform:none}50%{transform:scale3d(1.1,1.1,1)}}@keyframes fill{to{box-shadow:inset 0 0 0 30px #7ac142}}"]}),g})()}}]);