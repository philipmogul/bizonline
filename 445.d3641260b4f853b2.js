"use strict";(self.webpackChunkmatngular=self.webpackChunkmatngular||[]).push([[445],{7445:(ti,J,_)=>{_.r(J),_.d(J,{DebtorSaleModule:()=>je});var F=_(2318),t=_(4650),d=_(6895),y=_(2841),W=_(6498),Q=_(2340),w=_(7340),B=_(8423),z=_(3166),X=_(7185),tt=_(1927),et=_(1932),it=_(7052),k=_(805),ot=_(9775),S=_(4006),nt=_(1493),lt=_(2137),P=_(5593),v=_(3087),at=_(1740),st=_(666),q=_(9091),rt=_(2435),ct=_(8558),_t=_(8271),pt=_(613),dt=_(585);const ut=["dt1"],ht=["op"],mt=["op1"];function gt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"tr",30)(1,"th",31),t._uU(2,"Customer "),t.qZA(),t._UZ(3,"th"),t.qZA(),t.TgZ(4,"tr")(5,"th",32)(6,"input",33),t.NdJ("input",function(o){t.CHM(e),t.oxw();const l=t.MAs(10);return t.KtG(l.filter(o.target.value,"name","contains"))}),t.qZA()()()}}function xt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"p-button",38),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(3);return t.KtG(o.displayWaitingCustomers=!0)})("click",function(){t.CHM(e);const o=t.oxw().$implicit,l=t.oxw(2);return t.KtG(l.selectCustomerNew(o))}),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.Tol(e.pending_transactions.length>0?"animate-flicker":"")}}function ft(n,s){1&n&&(t.TgZ(0,"label",39),t._uU(1," Customer balance is more than sales limit "),t.qZA())}function Tt(n,s){if(1&n&&(t.TgZ(0,"tr",34)(1,"td",35)(2,"label"),t._uU(3),t.ALo(4,"titlecase"),t.qZA()(),t.TgZ(5,"td"),t.YNc(6,xt,1,2,"p-button",36),t.YNc(7,ft,2,0,"label",37),t.qZA()()),2&n){const e=s.$implicit;t.xp6(3),t.hij(" ",t.lcZ(4,3,e.name)," "),t.xp6(3),t.Q6J("ngIf",!e.limit_reached),t.xp6(1),t.Q6J("ngIf",e.limit_reached)}}function St(n,s){1&n&&(t.TgZ(0,"tr")(1,"td",40),t._uU(2,"No items found."),t.qZA()())}const I=function(){return[10,25,50]},O=function(){return["name"]};function bt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",7),t._UZ(1,"div",18),t.TgZ(2,"div",19)(3,"div",20)(4,"div",21)(5,"h4",22),t._uU(6," Select customer "),t.TgZ(7,"p-button",23),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.getReprintData())}),t.qZA()()(),t.TgZ(8,"div",24)(9,"p-table",25,26),t.YNc(11,gt,7,0,"ng-template",27),t.YNc(12,Tt,8,5,"ng-template",28),t.YNc(13,St,3,0,"ng-template",29),t.qZA()()()()()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("@enter",void 0),t.xp6(6),t.Q6J("value",e.debtorsWithSales)("rowHover",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",t.DdM(9,I))("paginator",!0)("filterDelay",0)("globalFilterFields",t.DdM(10,O))}}function yt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"tr")(1,"th",52),t._uU(2,"Name"),t.qZA(),t.TgZ(3,"th",31),t._uU(4,"Available"),t.qZA(),t.TgZ(5,"th",53),t._uU(6,"Location"),t.qZA(),t.TgZ(7,"th",31),t._uU(8,"Unit"),t.qZA(),t.TgZ(9,"th",53),t._uU(10,"Qty"),t.qZA(),t.TgZ(11,"th",53),t._uU(12,"Price"),t.qZA(),t.TgZ(13,"th",53),t._uU(14,"Total"),t.qZA(),t._UZ(15,"th",54),t.qZA(),t.TgZ(16,"tr")(17,"th")(18,"input",55),t.NdJ("input",function(o){t.CHM(e),t.oxw();const l=t.MAs(8);return t.KtG(l.filterGlobal(o.target.value,"contains"))}),t.qZA()(),t._UZ(19,"th",56),t.qZA()}}const M=function(n){return{"background-color":n,color:"#ffffff",cursor:"pointer"}};function vt(n,s){if(1&n&&t._UZ(0,"p-avatar",65),2&n){const e=s.index,i=t.oxw(5);t.Akn(t.VKq(2,M,i.locations[e].color))}}const Y=function(){return[]};function At(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"p-avatarGroup",63),t.NdJ("click",function(o){t.CHM(e);const l=t.oxw().$implicit,a=t.oxw(3);return t.KtG(a.showLocationsQuantityNew(l,o))}),t.YNc(1,vt,1,4,"p-avatar",64),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngForOf",t.DdM(1,Y).constructor(e.locations_count))}}function Ct(n,s){1&n&&(t.TgZ(0,"small",66),t._uU(1," Missing units "),t.qZA())}function Zt(n,s){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=s.$implicit;t.xp6(1),t.Oqu(e.location.name)}}function wt(n,s){if(1&n&&(t.TgZ(0,"div",72)(1,"div"),t._uU(2),t.qZA()()),2&n){const e=s.$implicit;t.xp6(2),t.Oqu(e.location.name)}}function Dt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"p-dropdown",69),t.NdJ("onChange",function(o){t.CHM(e);const l=t.oxw(5);return t.KtG(l.newLocationSelected(o))})("ngModelChange",function(o){t.CHM(e);const l=t.oxw(5);return t.KtG(l.selectedItem.location=o)})("keydown.enter",function(o){t.CHM(e);const l=t.oxw(2).$implicit,a=t.oxw(3);return t.KtG(a.focusNext1(o,"qty2"+a.getName(l.name)))}),t.YNc(1,Zt,2,1,"ng-template",70),t.YNc(2,wt,3,1,"ng-template",71),t.qZA()}if(2&n){const e=t.oxw(2).$implicit,i=t.oxw(3);t.Q6J("options",i.selectedItem.locations)("disabled",0==e.min_unit_ok)("ngModel",i.selectedItem.location)("filter",!1)}}function qt(n,s){if(1&n&&t._uU(0),2&n){const e=t.oxw(5);t.hij(" ",e.selectedItem.location?e.selectedItem.location.location.name:""," ")}}function It(n,s){1&n&&(t.TgZ(0,"p-cellEditor"),t.YNc(1,Dt,3,4,"ng-template",67),t.YNc(2,qt,1,1,"ng-template",68),t.qZA())}function Mt(n,s){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=s.$implicit;t.xp6(1),t.Oqu(e.unit_name)}}function Et(n,s){if(1&n&&(t.TgZ(0,"div",72)(1,"div"),t._uU(2),t.qZA()()),2&n){const e=s.$implicit;t.xp6(2),t.Oqu(e.unit_name)}}function kt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"p-dropdown",73),t.NdJ("onChange",function(o){t.CHM(e);const l=t.oxw(5);return t.KtG(l.newUnitSelected(o))})("ngModelChange",function(o){t.CHM(e);const l=t.oxw(5);return t.KtG(l.selectedItem.unit=o)})("keydown.enter",function(o){t.CHM(e);const l=t.oxw(2).$implicit,a=t.oxw(3);return t.KtG(a.focusNext1(o,"qty2"+a.getName(l.name)))}),t.YNc(1,Mt,2,1,"ng-template",70),t.YNc(2,Et,3,1,"ng-template",71),t.qZA()}if(2&n){const e=t.oxw(5);t.Q6J("options",e.selectedItem.selling_units)("disabled",e.selectedItem.selling_units.length<1||null==e.selectedItem.location)("ngModel",e.selectedItem.unit)("filter",!1)}}function Ut(n,s){if(1&n&&t._uU(0),2&n){const e=t.oxw(5);t.hij(" ",e.selectedItem.unit?e.selectedItem.unit.unit_name:""," ")}}function Nt(n,s){1&n&&(t.TgZ(0,"p-cellEditor"),t.YNc(1,kt,3,4,"ng-template",67),t.YNc(2,Ut,1,1,"ng-template",68),t.qZA())}function Lt(n,s){if(1&n&&(t.TgZ(0,"p",76)(1,"small",77)(2,"i",78),t._uU(3),t.qZA()()()),2&n){const e=t.oxw(6);t.xp6(3),t.Oqu(e.quantityError)}}function Rt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"input",74),t.NdJ("ngModelChange",function(o){t.CHM(e);const l=t.oxw(5);return t.KtG(l.selectedItem.sell_qty=o)})("input",function(){t.CHM(e);const o=t.oxw(5);return t.KtG(o.confirmQuantityNew())})("keydown.enter",function(){t.CHM(e);const o=t.oxw(2).$implicit,l=t.oxw(3);return t.KtG(l.focusNext("price2"+l.getName(o.name)))}),t.qZA(),t.YNc(1,Lt,4,1,"p",75)}if(2&n){const e=t.oxw(2).$implicit,i=t.oxw(3);t.MGl("id","qty2",i.getName(e.name),""),t.Q6J("ngModel",i.selectedItem.sell_qty),t.xp6(1),t.Q6J("ngIf",""!=i.quantityError)}}function Jt(n,s){if(1&n&&(t._uU(0),t.ALo(1,"number")),2&n){const e=t.oxw(5);t.hij(" ",t.lcZ(1,1,e.selectedItem.sell_qty)," ")}}function Ft(n,s){1&n&&(t.TgZ(0,"p-cellEditor"),t.YNc(1,Rt,2,3,"ng-template",67),t.YNc(2,Jt,2,3,"ng-template",68),t.qZA())}function Qt(n,s){if(1&n&&(t.TgZ(0,"p",76)(1,"small",77)(2,"i",78),t._uU(3),t.qZA()()()),2&n){const e=t.oxw(6);t.xp6(3),t.Oqu(e.priceError)}}function Bt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"input",79),t.NdJ("ngModelChange",function(o){t.CHM(e);const l=t.oxw(5);return t.KtG(l.selectedItem.sold_price=o)})("input",function(){t.CHM(e);const o=t.oxw(5);return t.KtG(o.confirmSellPrice())})("keydown.enter",function(){t.CHM(e);const o=t.oxw(2).$implicit,l=t.oxw(3);return t.KtG(l.focusNext("save2"+l.getName(o.name)))}),t.qZA(),t.YNc(1,Qt,4,1,"p",75)}if(2&n){const e=t.oxw(2).$implicit,i=t.oxw(3);t.MGl("id","price2",i.getName(e.name),""),t.Q6J("disabled",""!=i.quantityError||i.selectedItem.sell_qty<1)("ngModel",i.selectedItem.sold_price),t.xp6(1),t.Q6J("ngIf",""!=i.priceError)}}function Pt(n,s){if(1&n&&(t._uU(0),t.ALo(1,"currency")),2&n){const e=t.oxw(5);t.hij(" ",t.xi3(1,1,e.selectedItem.sold_price,"Ksh")," ")}}function Ot(n,s){1&n&&(t.TgZ(0,"p-cellEditor"),t.YNc(1,Bt,2,4,"ng-template",67),t.YNc(2,Pt,2,4,"ng-template",68),t.qZA())}function Yt(n,s){if(1&n&&(t.TgZ(0,"p",80),t._uU(1),t.ALo(2,"number"),t.qZA()),2&n){const e=t.oxw(4);t.xp6(1),t.hij(" ",t.lcZ(2,1,e.selectedItem.sell_qty*e.selectedItem.sold_price)," ")}}function Gt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"button",86),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2).$implicit,l=t.oxw(3);return t.KtG(l.onRowEditInitWaiting(o))}),t.qZA()}}function Ht(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"button",87),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2).$implicit,l=t.oxw(3);return t.KtG(l.onRowEditSaveWaiting(o))}),t.qZA()}if(2&n){const e=t.oxw(2).$implicit,i=t.oxw(3);t.MGl("id","save2",i.getName(e.name),""),t.Q6J("disabled",""!=i.quantityError||i.selectedItem.sell_qty<1||""!=i.priceError||i.selectedItem.sold_price<=0||null==i.selectedItem.location||!i.confirmQuantityIsNumber())}}function Kt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"button",88),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2),l=o.$implicit,a=o.rowIndex,c=t.oxw(3);return t.KtG(c.onRowEditCancel(l,a))}),t.qZA()}}function $t(n,s){1&n&&t._UZ(0,"div",89)}function jt(n,s){if(1&n&&(t.TgZ(0,"div",81),t.YNc(1,Gt,1,0,"button",82),t.YNc(2,Ht,1,2,"button",83),t.YNc(3,Kt,1,0,"button",84),t.YNc(4,$t,1,0,"div",85),t.qZA()),2&n){const e=t.oxw().$implicit,i=t.oxw(3);t.xp6(1),t.Q6J("ngIf",e.id!=i.selectedItem.id&&i.loaderToShow!=e.id),t.xp6(1),t.Q6J("ngIf",e.id==i.selectedItem.id&&i.loaderToShow!=e.id),t.xp6(1),t.Q6J("ngIf",e.id==i.selectedItem.id&&i.loaderToShow!=e.id),t.xp6(1),t.Q6J("ngIf",i.loaderToShow==e.id)}}function Vt(n,s){if(1&n&&(t.TgZ(0,"tr",57)(1,"td"),t._uU(2),t.ALo(3,"titlecase"),t.qZA(),t.TgZ(4,"td"),t.YNc(5,At,2,2,"p-avatarGroup",58),t.YNc(6,Ct,2,0,"small",59),t.qZA(),t.TgZ(7,"td"),t.YNc(8,It,3,0,"p-cellEditor",60),t.qZA(),t.TgZ(9,"td"),t.YNc(10,Nt,3,0,"p-cellEditor",60),t.qZA(),t.TgZ(11,"td"),t.YNc(12,Ft,3,0,"p-cellEditor",60),t.qZA(),t.TgZ(13,"td"),t.YNc(14,Ot,3,0,"p-cellEditor",60),t.qZA(),t.TgZ(15,"td"),t.YNc(16,Yt,3,3,"p",61),t.qZA(),t.TgZ(17,"td"),t.YNc(18,jt,5,4,"div",62),t.qZA()()),2&n){const e=s.$implicit,i=t.oxw(3);t.Q6J("pEditableRow",e),t.xp6(2),t.hij(" ",t.lcZ(3,10,e.name)," "),t.xp6(3),t.Q6J("ngIf",e.locations_count>0&&1==e.min_unit_ok),t.xp6(1),t.Q6J("ngIf",0==e.min_unit_ok),t.xp6(2),t.Q6J("ngIf",e.id==i.selectedItem.id),t.xp6(2),t.Q6J("ngIf",e.id==i.selectedItem.id&&i.selectedItem.selling_units),t.xp6(2),t.Q6J("ngIf",e.id==i.selectedItem.id),t.xp6(2),t.Q6J("ngIf",e.id==i.selectedItem.id),t.xp6(2),t.Q6J("ngIf",e.id==i.selectedItem.id),t.xp6(2),t.Q6J("ngIf",e.locations_count>0)}}function Wt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"tr",30)(1,"th",90),t._uU(2,"Item "),t._UZ(3,"p-sortIcon",91),t.qZA(),t.TgZ(4,"th",53),t._uU(5,"Unit "),t.qZA(),t.TgZ(6,"th",53),t._uU(7,"Qty "),t.qZA(),t.TgZ(8,"th",53),t._uU(9,"Price "),t.qZA(),t.TgZ(10,"th",53),t._uU(11,"Total "),t.qZA(),t._UZ(12,"th",54),t.qZA(),t.TgZ(13,"tr")(14,"th")(15,"input",92),t.NdJ("input",function(o){t.CHM(e),t.oxw();const l=t.MAs(18);return t.KtG(l.filter(o.target.value,"item.name","contains"))}),t.qZA()(),t._UZ(16,"th")(17,"th")(18,"th")(19,"th")(20,"th"),t.qZA()}}const G=function(n){return{"word-wrap":"normal",color:n}};function zt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.ALo(3,"titlecase"),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.ALo(6,"titlecase"),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.ALo(9,"number"),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.ALo(12,"number"),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.ALo(15,"number"),t.qZA(),t.TgZ(16,"td")(17,"p-button",93),t.NdJ("onClick",function(){const l=t.CHM(e).$implicit,a=t.oxw(3);return t.KtG(a.confirmDelete(l))}),t.qZA()()()}if(2&n){const e=s.$implicit;t.Akn(t.VKq(19,G,e.location.color)),t.xp6(2),t.hij(" ",t.lcZ(3,7,e.item.name)," "),t.xp6(3),t.hij(" ",t.lcZ(6,9,e.unit.unit_name)," "),t.xp6(3),t.hij(" ",t.lcZ(9,11,e.qty)," "),t.xp6(3),t.hij(" ",t.xi3(12,13,e.sp,".2")," "),t.xp6(3),t.hij(" ",t.xi3(15,16,e.qty*e.sp,".2")," ")}}function Xt(n,s){if(1&n&&(t.TgZ(0,"div",94)(1,"div",95)(2,"div",96)(3,"div",97)(4,"h3"),t._uU(5),t.ALo(6,"number"),t.qZA()()()()()),2&n){const e=t.oxw(3);t.xp6(5),t.hij("Total: \xa0Ksh ",t.xi3(6,1,e.totalCartAmount,".2"),"")}}function te(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",101)(1,"p-radioButton",121),t.NdJ("ngModelChange",function(o){t.CHM(e);const l=t.oxw(4);return t.KtG(l.todayChecked=o)}),t.qZA(),t.TgZ(2,"label",122),t._uU(3,"Different date"),t.qZA()()}if(2&n){const e=t.oxw(4);t.xp6(1),t.Q6J("ngModel",e.todayChecked)}}function ee(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"p-calendar",123),t.NdJ("ngModelChange",function(o){t.CHM(e);const l=t.oxw(4);return t.KtG(l.dateOfSale=o)}),t.qZA()}if(2&n){const e=t.oxw(4);t.Q6J("ngModel",e.dateOfSale)("maxDate",e.today)("touchUI",!1)("monthNavigator",!0)}}function ie(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",7)(1,"div",98)(2,"div",99)(3,"div",100)(4,"h5"),t._uU(5,"Date of sale"),t.qZA(),t.TgZ(6,"div",101)(7,"p-radioButton",102),t.NdJ("ngModelChange",function(o){t.CHM(e);const l=t.oxw(3);return t.KtG(l.todayChecked=o)}),t.qZA(),t.TgZ(8,"label",103),t._uU(9,"Today"),t.qZA()(),t.YNc(10,te,4,1,"div",104),t.YNc(11,ee,1,4,"p-calendar",105),t.qZA()()(),t.TgZ(12,"div",106)(13,"div",99)(14,"div",100)(15,"div",101)(16,"p-radioButton",107),t.NdJ("ngModelChange",function(o){t.CHM(e);const l=t.oxw(3);return t.KtG(l.printReceipt=o)}),t.qZA(),t.TgZ(17,"label",108),t._uU(18,"Print receipt"),t.qZA()(),t.TgZ(19,"div",101)(20,"p-radioButton",109),t.NdJ("ngModelChange",function(o){t.CHM(e);const l=t.oxw(3);return t.KtG(l.printReceipt=o)}),t.qZA(),t.TgZ(21,"label",110),t._uU(22,"No receipt"),t.qZA()()()()(),t.TgZ(23,"div",106)(24,"div",99)(25,"div",100)(26,"div",101)(27,"p-radioButton",111),t.NdJ("ngModelChange",function(o){t.CHM(e);const l=t.oxw(3);return t.KtG(l.printDeliveryReceipt=o)}),t.qZA(),t.TgZ(28,"label",112),t._uU(29,"Print delivery"),t.qZA()(),t.TgZ(30,"div",101)(31,"p-radioButton",113),t.NdJ("ngModelChange",function(o){t.CHM(e);const l=t.oxw(3);return t.KtG(l.printDeliveryReceipt=o)}),t.qZA(),t.TgZ(32,"label",114),t._uU(33,"No delivery"),t.qZA()()()()(),t.TgZ(34,"div",106)(35,"div",99)(36,"div",100)(37,"div",101)(38,"p-radioButton",115),t.NdJ("ngModelChange",function(o){t.CHM(e);const l=t.oxw(3);return t.KtG(l.printA4Receipt=o)}),t.qZA(),t.TgZ(39,"label",116),t._uU(40,"Download A4 receipt"),t.qZA()(),t.TgZ(41,"div",101)(42,"p-radioButton",117),t.NdJ("ngModelChange",function(o){t.CHM(e);const l=t.oxw(3);return t.KtG(l.printA4Receipt=o)}),t.qZA(),t.TgZ(43,"label",118),t._uU(44,"No A4 receipt"),t.qZA()()()()(),t.TgZ(45,"div",119)(46,"button",120),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(3);return t.KtG(o.completeSale())}),t.qZA()()()}if(2&n){const e=t.oxw(3);t.Q6J("@enter",void 0),t.xp6(7),t.Q6J("ngModel",e.todayChecked),t.xp6(3),t.Q6J("ngIf",e.userIsAdmin),t.xp6(1),t.Q6J("ngIf",e.userIsAdmin),t.xp6(5),t.Q6J("ngModel",e.printReceipt),t.xp6(4),t.Q6J("ngModel",e.printReceipt),t.xp6(7),t.Q6J("ngModel",e.printDeliveryReceipt),t.xp6(4),t.Q6J("ngModel",e.printDeliveryReceipt),t.xp6(7),t.Q6J("ngModel",e.printA4Receipt),t.xp6(4),t.Q6J("ngModel",e.printA4Receipt)}}const oe=function(){return[15,25,50]},H=function(){return["name","description"]};function ne(n,s){if(1&n&&(t.TgZ(0,"div",7)(1,"div",44)(2,"div",20)(3,"div",21)(4,"h4",45),t._uU(5," Select item to sell "),t.qZA()(),t.TgZ(6,"div",46)(7,"p-table",47,48),t.YNc(9,yt,20,0,"ng-template",27),t.YNc(10,Vt,19,12,"ng-template",28),t.qZA()()()(),t.TgZ(11,"div",49)(12,"div",20)(13,"div",21)(14,"h4",45),t._uU(15," Items selected "),t.qZA()(),t.TgZ(16,"div",46)(17,"p-table",25,50),t.YNc(19,Wt,21,0,"ng-template",27),t.YNc(20,zt,18,21,"ng-template",28),t.qZA(),t.YNc(21,Xt,7,4,"div",51),t.YNc(22,ie,47,10,"div",0),t.qZA()()()()),2&n){const e=t.oxw(2);t.xp6(2),t.Q6J("@enter",void 0),t.xp6(5),t.Q6J("value",e.newStock)("rows",15)("showCurrentPageReport",!0)("rowsPerPageOptions",t.DdM(18,oe))("paginator",!0)("filterDelay",0)("globalFilterFields",t.DdM(19,O)),t.xp6(10),t.Q6J("value",e.cartItems)("rowHover",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",t.DdM(20,I))("paginator",!0)("filterDelay",0)("globalFilterFields",t.DdM(21,H)),t.xp6(4),t.Q6J("ngIf",e.totalCartAmount>0),t.xp6(1),t.Q6J("ngIf",e.totalCartAmount>0)}}const le=function(){return{width:"95vw"}};function ae(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"p-dialog",41),t.NdJ("visibleChange",function(o){t.CHM(e);const l=t.oxw();return t.KtG(l.displayCustomerDialog=o)}),t.ALo(1,"titlecase"),t.YNc(2,ne,23,22,"div",0),t.TgZ(3,"p-footer")(4,"button",42),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return o.displayCustomerDialog=!1,o.totalCartAmount=0,o.selectedItem={},t.KtG(o.ngOnInit())}),t.qZA()(),t.TgZ(5,"ngx-spinner",43),t._UZ(6,"p",5),t.qZA()()}if(2&n){const e=t.oxw();t.Akn(t.DdM(10,le)),t.Q6J("header",t.lcZ(1,8,e.selectedCustomer.name))("closable",!1)("visible",e.displayCustomerDialog)("baseZIndex",1e4),t.xp6(2),t.Q6J("ngIf",e.showNew),t.xp6(3),t.Q6J("fullScreen",!0)}}function se(n,s){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=s.$implicit;t.xp6(1),t.Oqu(e.location.name)}}function re(n,s){if(1&n&&(t.TgZ(0,"div",72)(1,"div"),t._uU(2),t.qZA()()),2&n){const e=s.$implicit;t.xp6(2),t.Oqu(e.location.name)}}function ce(n,s){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=s.$implicit;t.xp6(1),t.Oqu(e.unit_name)}}function _e(n,s){if(1&n&&(t.TgZ(0,"div",72)(1,"div"),t._uU(2),t.qZA()()),2&n){const e=s.$implicit;t.xp6(2),t.Oqu(e.unit_name)}}function pe(n,s){1&n&&(t.TgZ(0,"tr")(1,"th",32),t._uU(2,"Available"),t.qZA()())}function de(n,s){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.ALo(3,"titlecase"),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.ALo(6,"number"),t.qZA()()),2&n){const e=s.$implicit;t.xp6(2),t.Oqu(t.lcZ(3,2,e[0])),t.xp6(3),t.Oqu(t.lcZ(6,4,e[1]))}}function ue(n,s){if(1&n&&(t.TgZ(0,"div",129)(1,"p-table",145),t.YNc(2,pe,3,0,"ng-template",27),t.YNc(3,de,7,6,"ng-template",28),t.qZA()()),2&n){const e=t.oxw(3);t.xp6(1),t.Q6J("value",e.availableUnits)("paginator",!1)("rows",10)}}function he(n,s){if(1&n&&(t.TgZ(0,"small",146),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij(" ",e.quantityError," ")}}function me(n,s){1&n&&(t.TgZ(0,"small",147),t._uU(1," Selling price is lower than buying price "),t.qZA())}function ge(n,s){if(1&n&&(t.TgZ(0,"small",147),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij(" ",e.priceError2," ")}}function xe(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"form",126,127),t.NdJ("ngSubmit",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.addToCart())}),t.TgZ(2,"div",7)(3,"div",10)(4,"div",128)(5,"div",7)(6,"div",129)(7,"div",130)(8,"label",131),t._uU(9,"Location to sell item"),t.qZA(),t._UZ(10,"br"),t.TgZ(11,"p-dropdown",132),t.NdJ("onChange",function(o){t.CHM(e);const l=t.oxw(2);return t.KtG(l.updateLocationSelected(o))})("ngModelChange",function(o){t.CHM(e);const l=t.oxw(2);return t.KtG(l.itemToSellModel.location=o)}),t.YNc(12,se,2,1,"ng-template",70),t.YNc(13,re,3,1,"ng-template",71),t.qZA()(),t.TgZ(14,"div",130)(15,"label",133),t._uU(16,"Unit to sell"),t.qZA(),t._UZ(17,"br"),t.TgZ(18,"p-dropdown",134),t.NdJ("onChange",function(o){t.CHM(e);const l=t.oxw(2);return t.KtG(l.updateUnitSelected(o))})("ngModelChange",function(o){t.CHM(e);const l=t.oxw(2);return t.KtG(l.itemToSellModel.unit=o)}),t.YNc(19,ce,2,1,"ng-template",70),t.YNc(20,_e,3,1,"ng-template",71),t.qZA()()(),t.YNc(21,ue,4,3,"div",135),t.qZA(),t.TgZ(22,"div",130)(23,"label",136),t._uU(24,"Unit quantity to sell"),t.qZA(),t.TgZ(25,"input",137),t.NdJ("input",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.checkQuantity())})("ngModelChange",function(o){t.CHM(e);const l=t.oxw(2);return t.KtG(l.itemToSellModel.unit_quantity=o)}),t.qZA(),t.YNc(26,he,2,1,"small",138),t.qZA(),t.TgZ(27,"div",130)(28,"label",136),t._uU(29,"Unit selling price"),t.qZA(),t.TgZ(30,"input",139),t.NdJ("input",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.confirmPrice())})("ngModelChange",function(o){t.CHM(e);const l=t.oxw(2);return t.KtG(l.itemToSellModel.unit_price=o)}),t.qZA(),t.YNc(31,me,2,0,"small",140),t.YNc(32,ge,2,1,"small",140),t.qZA(),t.TgZ(33,"div",130)(34,"label",141),t._uU(35,"Total price"),t.qZA(),t._UZ(36,"input",142),t.qZA()()()(),t.TgZ(37,"p-footer")(38,"button",143),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.hideSellForm())}),t.qZA(),t._UZ(39,"button",144),t.qZA()()}if(2&n){const e=t.MAs(1),i=t.oxw(2);t.xp6(11),t.Q6J("options",i.itemToSellModel.locations_qty)("ngModel",i.itemToSellModel.location),t.xp6(7),t.Q6J("options",i.itemToSellModel.selling_units)("disabled",!i.activateSellForm)("ngModel",i.itemToSellModel.unit),t.xp6(3),t.Q6J("ngIf",i.availableUnits!=t.DdM(15,Y)),t.xp6(4),t.Q6J("disabled",!i.activateSellForm||null==i.itemToSellModel.unit)("ngModel",i.itemToSellModel.unit_quantity),t.xp6(1),t.Q6J("ngIf",""!=i.quantityError),t.xp6(4),t.Q6J("ngModel",i.itemToSellModel.unit_price),t.xp6(1),t.Q6J("ngIf",""!=i.priceError),t.xp6(1),t.Q6J("ngIf",""!=i.priceError2),t.xp6(4),t.Q6J("disabled",!0)("value",i.itemToSellModel.total_price),t.xp6(3),t.Q6J("disabled",!e.valid||null==i.itemToSellModel.location||i.itemToSellModel.unit_quantity<1||i.itemToSellModel.unit_price<0||null==i.itemToSellModel.unit||""!=i.priceError||""!=i.priceError2||""!=i.quantityError||""!=i.discountError||!i.activateSellForm||i.buttonClicked)}}const K=function(){return{width:"30vw"}};function fe(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"p-dialog",41),t.NdJ("visibleChange",function(o){t.CHM(e);const l=t.oxw();return t.KtG(l.displaySellDialog=o)}),t.YNc(1,xe,40,16,"form",124),t.TgZ(2,"ngx-spinner",125),t._UZ(3,"p",5),t.qZA()()}if(2&n){const e=t.oxw();t.Akn(t.DdM(8,K)),t.s9C("header",e.itemToSellModel.name),t.Q6J("closable",!1)("visible",e.displaySellDialog)("baseZIndex",1e4),t.xp6(1),t.Q6J("ngIf",!e.showNotification),t.xp6(1),t.Q6J("fullScreen",!1)}}function Te(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"tr",30)(1,"th",149),t._uU(2," Customer "),t._UZ(3,"p-sortIcon",91),t.qZA(),t.TgZ(4,"th",53),t._uU(5,"Receipt number "),t.qZA(),t.TgZ(6,"th",53),t._uU(7,"Receipt total "),t.qZA(),t.TgZ(8,"th",53),t._uU(9,"Reversed amount "),t.qZA(),t.TgZ(10,"th",53),t._uU(11,"Date sold "),t.qZA(),t.TgZ(12,"th",53),t._uU(13,"Time "),t.qZA(),t._UZ(14,"th",150),t.qZA(),t.TgZ(15,"tr")(16,"th",151)(17,"input",33),t.NdJ("input",function(o){t.CHM(e),t.oxw();const l=t.MAs(1);return t.KtG(l.filterGlobal(o.target.value,"contains"))}),t.qZA()()()}}function Se(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"p-button",154),t.NdJ("onClick",function(){t.CHM(e);const o=t.oxw().$implicit,l=t.oxw(2);return t.KtG(l.selectReceipt(o,!1,!1,!1))}),t.qZA()}}function be(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",155)(1,"button",156),t._uU(2," Reprint "),t.qZA(),t.TgZ(3,"div",157)(4,"button",158),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,l=t.oxw(2);return t.KtG(l.selectReceipt(o,!0,!1,!1))}),t._UZ(5,"i",159),t._uU(6," Sale receipt "),t.qZA(),t.TgZ(7,"button",158),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,l=t.oxw(2);return t.KtG(l.selectReceipt(o,!1,!0,!1))}),t._UZ(8,"i",159),t._uU(9," Delivery receipt "),t.qZA(),t.TgZ(10,"button",158),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,l=t.oxw(2);return t.KtG(l.selectReceipt(o,!0,!1,!0))}),t._UZ(11,"i",159),t._uU(12," A4 receipt "),t.qZA()()()}}function ye(n,s){if(1&n&&(t.TgZ(0,"tr",34)(1,"td"),t._uU(2),t.ALo(3,"titlecase"),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.ALo(8,"number"),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.ALo(11,"number"),t.qZA(),t.TgZ(12,"td"),t._uU(13),t.ALo(14,"date"),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td"),t.YNc(18,Se,1,0,"p-button",152),t.YNc(19,be,13,0,"div",153),t.qZA()()),2&n){const e=s.$implicit,i=t.oxw(2);t.xp6(2),t.hij(" ",t.lcZ(3,8,e.customer.name)," "),t.xp6(3),t.hij(" ",e.transaction_code," "),t.xp6(2),t.hij(" ",t.xi3(8,10,e.transaction_total,".2")," "),t.xp6(3),t.hij(" ",t.xi3(11,13,e.reversed,".2")," "),t.xp6(3),t.hij(" ",t.lcZ(14,16,e.date_of_sale)," "),t.xp6(3),t.hij(" ",i.getTimeValue(e.date_of_sale)," "),t.xp6(2),t.Q6J("ngIf",e.transaction_total>0),t.xp6(1),t.Q6J("ngIf",e.transaction_total>0)}}const ve=function(){return["customer.name","transaction_code","transaction_total"]};function Ae(n,s){if(1&n&&(t.TgZ(0,"p-table",25,148),t.YNc(2,Te,18,0,"ng-template",27),t.YNc(3,ye,20,18,"ng-template",28),t.qZA()),2&n){const e=t.oxw();t.Q6J("value",e.reprintItems)("rowHover",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",t.DdM(8,I))("paginator",!0)("filterDelay",0)("globalFilterFields",t.DdM(9,ve))}}function Ce(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"tr",30)(1,"th",90),t._uU(2,"Item "),t._UZ(3,"p-sortIcon",91),t.qZA(),t.TgZ(4,"th",53),t._uU(5,"Location "),t.qZA(),t.TgZ(6,"th",53),t._uU(7,"Unit "),t.qZA(),t.TgZ(8,"th",53),t._uU(9,"Qty "),t.qZA(),t.TgZ(10,"th",53),t._uU(11,"Price "),t.qZA(),t.TgZ(12,"th",53),t._uU(13,"Total "),t.qZA()(),t.TgZ(14,"tr")(15,"th",161)(16,"input",92),t.NdJ("input",function(o){t.CHM(e),t.oxw();const l=t.MAs(1);return t.KtG(l.filter(o.target.value,"item.name","contains"))}),t.qZA()()()}}function Ze(n,s){if(1&n&&(t.TgZ(0,"tr",34)(1,"td"),t._uU(2),t.ALo(3,"titlecase"),t.qZA(),t.TgZ(4,"td")(5,"p-avatarGroup"),t._UZ(6,"p-avatar",162),t.qZA()(),t.TgZ(7,"td"),t._uU(8),t.ALo(9,"titlecase"),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.ALo(12,"number"),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.ALo(15,"number"),t.qZA(),t.TgZ(16,"td"),t._uU(17),t.ALo(18,"number"),t.qZA()()),2&n){const e=s.$implicit;t.xp6(2),t.hij(" ",t.lcZ(3,7,e.item.name)," "),t.xp6(4),t.Akn(t.VKq(19,M,e.location.color)),t.xp6(2),t.hij(" ",t.lcZ(9,9,e.unit.unit_name)," "),t.xp6(3),t.hij(" ",t.lcZ(12,11,e.qty)," "),t.xp6(3),t.hij(" ",t.xi3(15,13,e.sp,".2")," "),t.xp6(3),t.hij(" ",t.xi3(18,16,e.qty*e.sp,".2")," ")}}function we(n,s){if(1&n&&(t.TgZ(0,"p-table",25,160),t.YNc(2,Ce,17,0,"ng-template",27),t.YNc(3,Ze,19,21,"ng-template",28),t.qZA()),2&n){const e=t.oxw();t.Q6J("value",e.transactionToView.items)("rowHover",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",t.DdM(8,I))("paginator",!0)("filterDelay",0)("globalFilterFields",t.DdM(9,H))}}function De(n,s){1&n&&(t.TgZ(0,"tr",30)(1,"th",52),t._uU(2,"Item "),t.qZA(),t.TgZ(3,"th",53),t._uU(4,"Quantity ordered "),t.qZA(),t.TgZ(5,"th",52),t._uU(6,"Quantity available "),t.qZA()())}function qe(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.ALo(3,"titlecase"),t.qZA(),t.TgZ(4,"td")(5,"p-avatarGroup",63),t.NdJ("click",function(o){const a=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.showLocationsQuantityOrdered(a.item,a,o))}),t._UZ(6,"p-avatar",65),t.qZA()(),t.TgZ(7,"td")(8,"p-avatarGroup",63),t.NdJ("click",function(o){const a=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.showLocationsQuantityNew(a.item,o))}),t._UZ(9,"p-avatar",65),t.qZA()()()}if(2&n){const e=s.$implicit;t.Akn(t.VKq(9,G,e.location.color)),t.xp6(2),t.hij(" ",t.lcZ(3,7,e.item.name)," "),t.xp6(4),t.Akn(t.VKq(11,M,e.location.color)),t.xp6(3),t.Akn(t.VKq(13,M,e.location.color))}}const Ie=function(){return{width:"50vw"}},Me=function(){return[500]},Ee=function(){return["item.name"]};function ke(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"p-dialog",163),t.NdJ("visibleChange",function(o){t.CHM(e);const l=t.oxw();return t.KtG(l.showQuantityError=o)}),t.TgZ(1,"div",7)(2,"div",164)(3,"p-table",25,165),t.YNc(5,De,7,0,"ng-template",27),t.YNc(6,qe,10,15,"ng-template",28),t.qZA()()()()}if(2&n){const e=t.oxw();t.Akn(t.DdM(13,Ie)),t.Q6J("closable",!0)("visible",e.showQuantityError)("baseZIndex",1e4),t.xp6(3),t.Q6J("value",e.lessItems)("rowHover",!0)("rows",10)("showCurrentPageReport",!1)("rowsPerPageOptions",t.DdM(14,Me))("paginator",!1)("filterDelay",0)("globalFilterFields",t.DdM(15,Ee))}}function Ue(n,s){if(1&n&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"titlecase"),t.ALo(3,"number"),t.qZA()),2&n){const e=s.$implicit;t.xp6(1),t.AsE(" ",t.lcZ(2,2,e.unit_name)," (",t.lcZ(3,4,e.unit_quantity),") ")}}function Ne(n,s){if(1&n&&(t.TgZ(0,"tr"),t._UZ(1,"th"),t.TgZ(2,"th"),t._uU(3,"Location"),t.qZA(),t.YNc(4,Ue,4,6,"th",166),t.qZA()),2&n){const e=t.oxw(2);t.xp6(4),t.Q6J("ngForOf",e.itemToViewLocations.selling_units)}}function Le(n,s){if(1&n&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&n){const e=s.$implicit,i=t.oxw().$implicit,o=t.oxw(2);t.xp6(1),t.hij(" ",o.getLocationUnitQuantityOrdered(i.location_quantity,o.itemToViewLocations.selling_units)[e.unit_name]," ")}}const $=function(n){return{"background-color":n,color:"#ffffff"}};function Re(n,s){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._UZ(2,"p-avatar",65),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.ALo(5,"titlecase"),t.qZA(),t.YNc(6,Le,2,1,"td",166),t.qZA()),2&n){const e=s.$implicit,i=t.oxw(2);t.xp6(2),t.Akn(t.VKq(6,$,e.location.color)),t.xp6(2),t.Oqu(t.lcZ(5,4,e.location.name)),t.xp6(2),t.Q6J("ngForOf",i.itemToViewLocations.selling_units)}}function Je(n,s){if(1&n&&(t.TgZ(0,"p-table",145),t.YNc(1,Ne,5,1,"ng-template",27),t.YNc(2,Re,7,8,"ng-template",28),t.qZA()),2&n){const e=t.oxw();t.Q6J("value",e.itemToViewLocations.locations_qty)("paginator",!1)("rows",5)}}function Fe(n,s){if(1&n&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"titlecase"),t.ALo(3,"number"),t.TgZ(4,"p",167)(5,"i",168),t._uU(6),t.ALo(7,"number"),t.qZA()()()),2&n){const e=s.$implicit;t.xp6(1),t.AsE(" ",t.lcZ(2,3,e.unit_name)," (",t.lcZ(3,5,e.unit_quantity),") "),t.xp6(5),t.hij("@Ksh ",t.lcZ(7,7,e.recom_selling_price),"")}}function Qe(n,s){if(1&n&&(t.TgZ(0,"tr"),t._UZ(1,"th"),t.TgZ(2,"th"),t._uU(3,"Location"),t.qZA(),t.YNc(4,Fe,8,9,"th",166),t.qZA()),2&n){const e=t.oxw(2);t.xp6(4),t.Q6J("ngForOf",e.itemToViewLocations.selling_units)}}function Be(n,s){if(1&n&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&n){const e=s.$implicit,i=t.oxw().$implicit,o=t.oxw(2);t.xp6(1),t.hij(" ",o.getLocationUnitQuantity(i.location_quantity,o.itemToViewLocations.selling_units)[e.unit_name]," ")}}function Pe(n,s){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._UZ(2,"p-avatar",65),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.ALo(5,"titlecase"),t.qZA(),t.YNc(6,Be,2,1,"td",166),t.qZA()),2&n){const e=s.$implicit,i=t.oxw(2);t.xp6(2),t.Akn(t.VKq(6,$,e.location.color)),t.xp6(2),t.Oqu(t.lcZ(5,4,e.location.name)),t.xp6(2),t.Q6J("ngForOf",i.itemToViewLocations.selling_units)}}function Oe(n,s){if(1&n&&(t.TgZ(0,"p-table",145),t.YNc(1,Qe,5,1,"ng-template",27),t.YNc(2,Pe,7,8,"ng-template",28),t.qZA()),2&n){const e=t.oxw();t.Q6J("value",e.itemToViewLocations.locations_qty)("paginator",!1)("rows",5)}}const Ye=function(){return{width:"80vw"}},Ge=function(){return{width:"70vw"}},j=function(){return{width:"500px"}},He=[{path:"",component:(()=>{class n{constructor(e,i,o,l,a,c,r,u,T,D){this.spinner=e,this.cryptoSrv=i,this.toastr=o,this.authSrv=l,this.apiSrv=a,this.pdfSrv=c,this._decimalPipe=r,this.confirmationService=u,this.printSrv=T,this.locale=D,this.productImagesUrl=Q.N.imageUrls,this.shopLogoUrl=Q.N.shopLogoUrls,this.debtorsWithSales=[],this.allStock=[],this.displayCustomerDialog=!1,this.totalCartAmount=0,this.cartItems=[],this.activateSellForm=!1,this.printReceipt="yes",this.printDeliveryReceipt="no",this.printA4Receipt="no",this.todayChecked="today",this.dateOfSale=new Date,this.showNotification=!1,this.itemToSellModel={},this.displaySellDialog=!1,this.quantityError="",this.discountError="",this.priceError="",this.shopDetail={},this.receiptCustomer="",this.loading=!0,this.categories=[],this.showReprintForm=!1,this.reprintItems=[],this.displayItemsDialog=!1,this.userIsAdmin=!1,this.availableUnits=[],this.buttonClicked=!1,this.priceError2="",this.loading2=!1,this.newStock=[],this.showNew=!0,this.selectedLocation="",this.selectedItem={},this.clonedProducts={},this.loaderToShow="",this.showQuantityError=!1,this.lessItems=[]}ngOnInit(){"admin"===this.cryptoSrv.decryptEncodedText(this.authSrv.getUserDetailToken("role"))&&(this.userIsAdmin=!0),"1"===this.cryptoSrv.decryptEncodedText(this.authSrv.getRoleToken("sell_debtors"))||this.userIsAdmin?this.getDebtors():(this.toastr.error("You have no rights to access that page!"),this.authSrv.logout())}getDebtors(){this.spinner.show();const e={action:this.cryptoSrv.encodeEncryptText("get-all-debtors-and-pending-sales"),uid:this.authSrv.getUserDetailToken("uid")};this.apiSrv.read(e).then(i=>{"error"!=i.status?"error2"!=i.status?(this.debtorsWithSales=i.debtors,this.debtorsWithSales.sort((o,l)=>l.pending_transactions.length-o.pending_transactions.length),this.spinner.hide(),this.loading=!1):(this.spinner.hide(),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.spinner.hide(),this.toastr.error(i.message))}).catch(i=>{this.toastr.error(i),this.spinner.hide()})}onCategoryChange(e){this.table.filter(e.value,"category","in")}showLocationsQuantity(e,i){if(e.selling_units)this.itemToViewLocations=e,this.overlay.toggle(i);else{this.loading2=!0;let o=this.allStock.find(a=>a.id===e.id);this.itemToViewLocations=o;const l={action:this.cryptoSrv.encodeEncryptText("get_item_all_locations_quantity"),item_id:e.id,added_by:this.authSrv.getUserDetailToken("uid")};this.apiSrv.read(l).then(a=>{"error"!=a.status?"error2"!=a.status?(o.selling_units=a.selling_units,o.locations_qty=a.locations_qty,o.total_qty=a.total_qty,o.locations=a.locations,this.overlay.toggle(i),this.loading2=!1):(this.loading2=!1,this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.loading2=!1,this.toastr.error(a.message))}).catch(a=>{this.toastr.error(a),this.loading2=!1})}}getLocationUnitQuantity(e,i){const o={};return(i=i.sort((l,a)=>a.unit_quantity-l.unit_quantity)).forEach(l=>{if(e>0){const a=Math.floor(e/l.unit_quantity);o[l.unit_name]=a,e-=a*l.unit_quantity}else o[l.unit_name]=0}),o}selectCustomer(e){this.showNotification=!1,this.selectedCustomer=e,this.totalCartAmount=0,this.spinner.show();const i={action:this.cryptoSrv.encodeEncryptText("get-stock-and-debtor-cart-items"),uid:this.authSrv.getUserDetailToken("uid"),cid:this.selectedCustomer.id};this.apiSrv.read(i).then(o=>{"error"!=o.status?"error2"!=o.status?(this.allStock=o.data.stock,this.locations=o.data.locations,this.categories=o.data.categories,this.cartItems=o.cartItems,this.cartItems.forEach(l=>{this.totalCartAmount+=l.qty*l.sp}),this.allStock.forEach(l=>{parseInt(l.prices_ok.toString())>0?(l.prices_ok=!1,l.sp_units_ok=!1,l.attention=1):(l.prices_ok=!0,l.sp_units_ok=!0),parseInt(l.min_qty_ok.toString())<1||parseInt(l.min_qty_ok.toString())>1?(l.min_qty_ok=!1,l.min_unit_ok=!1,l.attention=1):(l.min_qty_ok=!0,l.min_unit_ok=!0),l.locations_count=parseInt(l.locations_count.toString()),l.category=this.categories.find(a=>a.id===l.category_id)}),this.spinner.hide(),this.displayCustomerDialog=!0):(this.spinner.hide(),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.spinner.hide(),this.toastr.error(o.message))}).catch(o=>{this.toastr.error(o),this.spinner.hide()})}selectCustomerNew(e){if("localhost"==window.location.hostname){this.showNotification=!1,this.selectedCustomer=e,this.totalCartAmount=0,this.spinner.show();const o={action:this.cryptoSrv.encodeEncryptText("get-stock-and-debtor-cart-items-new"),uid:this.authSrv.getUserDetailToken("uid"),cid:this.selectedCustomer.id};this.apiSrv.read(o).then(l=>{"error"!=l.status?"error2"!=l.status?(this.newStock=l.stock,this.locations=l.locations,this.cartItems=l.cartItems,this.cartItems.forEach(a=>{this.totalCartAmount+=a.qty*a.sp}),this.newStock.forEach(a=>{const c=a.locations.split(",");a.locations_count=c.length,1==a.min_unit_ok&&(a.min_unit_ok=!0)}),this.spinner.hide(),this.displayCustomerDialog=!0):(this.spinner.hide(),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.spinner.hide(),this.toastr.error(l.message))}).catch(l=>{this.toastr.error(l),this.spinner.hide()})}else{this.showNotification=!1,this.selectedCustomer=e,this.totalCartAmount=0,this.spinner.show();const o={action:this.cryptoSrv.encodeEncryptText("get-stock-and-debtor-cart-items-new"),uid:this.authSrv.getUserDetailToken("uid"),cid:this.selectedCustomer.id};this.apiSrv.read(o).then(l=>{"error"!=l.status?"error2"!=l.status?(this.newStock=l.stock,this.locations=l.locations,this.cartItems=l.cartItems,this.cartItems.forEach(a=>{this.totalCartAmount+=a.qty*a.sp}),this.newStock.forEach(a=>{const c=a.locations.split(",");a.locations_count=c.length,1==a.min_unit_ok&&(a.min_unit_ok=!0)}),this.spinner.hide(),this.displayCustomerDialog=!0):(this.spinner.hide(),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.spinner.hide(),this.toastr.error(l.message))}).catch(l=>{this.toastr.error(l),this.spinner.hide()})}}showLocationsQuantityNew(e,i){if(e.selling_units)this.itemToViewLocations=e,this.overlay.toggle(i);else{this.loaderToShow=e.id,this.loading2=!0;let o=this.newStock.find(a=>a.id===e.id);this.itemToViewLocations=o;const l={action:this.cryptoSrv.encodeEncryptText("get_item_all_locations_quantity"),item_id:e.id,added_by:this.authSrv.getUserDetailToken("uid")};this.apiSrv.read(l).then(a=>{"error"!=a.status?"error2"!=a.status?(o.selling_units=a.selling_units,o.locations_qty=a.locations_qty,o.total_qty=a.total_qty,o.locations=a.locations,this.overlay.toggle(i),this.loading2=!1,this.loaderToShow=""):(this.loaderToShow="",this.loading2=!1,this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.loaderToShow="",this.loading2=!1,this.toastr.error(a.message))}).catch(a=>{this.toastr.error(a),this.loaderToShow="",this.loading2=!1})}}showLocationsQuantityOrdered(e,i,o){this.loaderToShow=e.id,this.itemToViewLocations=e;const l={action:this.cryptoSrv.encodeEncryptText("get_item_all_locations_quantity"),item_id:e.id,added_by:this.authSrv.getUserDetailToken("uid")};this.apiSrv.read(l).then(a=>{if("error"!=a.status)if("error2"!=a.status){e.selling_units=a.selling_units,e.locations_qty=a.locations_qty;let c=e.locations_qty.find(r=>r.location.id==i.location.id);c&&(c.location_quantity=i.qty_ordered),e.locations=a.locations,this.itemToViewLocations=e,this.overlay1.toggle(o),this.loaderToShow=""}else this.loaderToShow="",this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout();else this.loaderToShow="",this.toastr.error(a.message)}).catch(a=>{this.toastr.error(a),this.loaderToShow=""})}getLocationUnitQuantityOrdered(e,i){const o={};return(i=i.sort((l,a)=>a.unit_quantity-l.unit_quantity)).forEach(l=>{if(e>0){const a=Math.floor(e/l.unit_quantity);o[l.unit_name]=a,e-=a*l.unit_quantity}else o[l.unit_name]=0}),o}newLocationSelected(e){this.selectedItem.location=e.value,this.selectedItem.unit=null,this.selectedItem.sell_qty=0,this.checkLockStatusNew()}checkLockStatusNew(){this.loaderToShow=this.selectedItem.id;const e={action:this.cryptoSrv.encodeEncryptText("check-lock-status-new"),item_id:this.selectedItem.id,location_id:this.selectedItem.location.location.id,uid:this.authSrv.getUserDetailToken("uid"),right:this.cryptoSrv.encodeEncryptText("sell_cash")};this.apiSrv.read(e).then(i=>{"error"!=i.status?"error2"!=i.status?(this.activateSellForm=!0,this.selectedItem.selling_units=i.units,this.selectedItem.locations.find(({location:l})=>l.id===this.selectedItem.location.location.id).quantity=i.qty,this.loading=!1,this.activateSellForm=!0,this.loaderToShow=""):(this.loaderToShow="",this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.loaderToShow="","locked"===i.message?(this.activateSellForm=!1,this.toastr.warning("Item is locked by "+i.user)):(this.selectedItem.selling_units=[],this.selectedItem.location=null,this.activateSellForm=!1,this.toastr.error(i.message)))}).catch(i=>{this.selectedItem.selling_units=[],this.selectedItem.location=null,this.toastr.error(i),this.activateSellForm=!1,this.loaderToShow=""})}focusNext1(e,i){e.preventDefault(),e.stopPropagation();const o=document.getElementById(i);o&&o.focus()}focusNext(e){const i=document.getElementById(e);i&&i.focus()}getName(e){return e.replace(/\s+/g,"-")}newUnitSelected(e){this.selectedItem.unit=e.value,this.selectedItem.sell_qty=0,this.selectedItem.sell_price=this.selectedItem.unit.recom_selling_price,this.selectedItem.sold_price=this.selectedItem.unit.recom_selling_price}confirmQuantityNew(){const e=parseFloat(this.selectedItem.location.quantity);if(parseInt(this.selectedItem.unit.unit_quantity.toString())*parseInt(this.selectedItem.sell_qty)>e){const o=Math.floor(e/parseInt(this.selectedItem.unit.unit_quantity));this.quantityError="Only "+o+" "+this.selectedItem.unit.unit_name+"s are available"}else this.quantityError=""}confirmQuantityIsNumber(){return Number.isInteger(+this.selectedItem.sell_qty)&&+this.selectedItem.sell_qty>0}confirmSellPrice(){this.priceError=parseFloat(this.selectedItem.sold_price)<parseFloat(this.selectedItem.unit.min_selling_price.toString())?"Price cannot be lower than"+this.selectedItem.unit.min_selling_price:""}onRowEditInitWaiting(e){this.loaderToShow=e.id,this.clonedProducts[e.id]={...e};const i={action:this.cryptoSrv.encodeEncryptText("get-item-locations"),item_id:e.id,uid:this.authSrv.getUserDetailToken("uid"),right:this.cryptoSrv.encodeEncryptText("sell_cash")};this.apiSrv.read(i).then(o=>{"error"!=o.status?"error2"!=o.status?(this.selectedItem=this.apiSrv.deepCopy(e),this.selectedItem.sell_qty=0,this.selectedItem.sold_price=0,this.selectedItem.locations=o.locations,this.priceError="",this.quantityError="",this.activateSellForm=!0,this.loaderToShow=""):(this.loaderToShow="",this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.loaderToShow="","locked"===o.message?(this.activateSellForm=!1,this.toastr.warning("Item is locked by "+o.user)):(this.activateSellForm=!1,this.toastr.error(o.message)))}).catch(o=>{this.toastr.error(o),this.spinner.hide("sell"),this.spinner.show("sellw")})}onRowEditSaveWaiting(e){this.loaderToShow=e.id;const i=parseFloat(this.selectedItem.sell_qty)*parseFloat(this.selectedItem.unit.unit_quantity),o=parseFloat(this.selectedItem.buying_price)*parseFloat(this.selectedItem.unit.unit_quantity),l=parseFloat(this.selectedItem.unit.min_selling_price),a=parseFloat(this.selectedItem.unit.recom_selling_price),c={action:this.cryptoSrv.encodeEncryptText("add-item-to-cart-debtor-new"),item_id:this.selectedItem.id,cid:this.selectedCustomer.id,location_id:this.selectedItem.location.location.id,unit_id:this.selectedItem.unit.id,unit_qty:this.cryptoSrv.encodeEncryptText(this.selectedItem.sell_qty.toString()),tt_qty:this.cryptoSrv.encodeEncryptText(i.toString()),unit_bp:this.cryptoSrv.encodeEncryptText(o.toString()),min_sp:this.cryptoSrv.encodeEncryptText(l.toString()),recom_sp:this.cryptoSrv.encodeEncryptText(a.toString()),unit_price:this.cryptoSrv.encodeEncryptText(this.selectedItem.sold_price.toString()),uid:this.authSrv.getUserDetailToken("uid")};this.apiSrv.post(c).then(r=>{"error"!=r.status?"error2"!=r.status?(this.newStock=r.stock,this.locations=r.locations,this.cartItems=r.cartItems,this.availableUnits=[],this.selectedItem={},this.newStock=r.stock,this.locations=r.locations,this.cartItems=r.cartItems,this.totalCartAmount=0,this.cartItems.forEach(u=>{this.totalCartAmount+=u.qty*u.sp}),this.newStock.forEach(u=>{const T=u.locations.split(",");u.locations_count=T.length,1==u.min_unit_ok&&(u.min_unit_ok=!0)}),this.loaderToShow="",this.toastr.success("Item added to list!")):(this.loaderToShow="",this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.loaderToShow="","locked"===r.message?(this.activateSellForm=!1,this.toastr.warning("Item is locked by "+r.user)):this.toastr.error(r.message))}).catch(r=>{this.toastr.error(r),this.loaderToShow=""})}onRowEditCancel(e,i){this.selectedItem={};const o={action:this.cryptoSrv.encodeEncryptText("unlock-user-items"),uid:this.authSrv.getUserDetailToken("uid")};this.apiSrv.post(o).then(l=>{"error"!=l.status&&("error2"!=l.status||(this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()))}).catch(l=>{})}getAllStockAndCart(){this.totalCartAmount=0,this.spinner.show("waiting");const e={action:this.cryptoSrv.encodeEncryptText("get-stock-and-debtor-cart-items"),uid:this.authSrv.getUserDetailToken("uid"),cid:this.selectedCustomer.id};this.apiSrv.read(e).then(i=>{"error"!=i.status?"error2"!=i.status?(this.allStock=i.data.stock,this.locations=i.data.locations,this.categories=i.data.categories,this.cartItems=i.cartItems,this.cartItems.forEach(o=>{this.totalCartAmount+=o.qty*o.sp}),this.allStock.forEach(o=>{parseInt(o.prices_ok.toString())>0?(o.prices_ok=!1,o.sp_units_ok=!1,o.attention=1):(o.prices_ok=!0,o.sp_units_ok=!0),parseInt(o.min_qty_ok.toString())<1||parseInt(o.min_qty_ok.toString())>1?(o.min_qty_ok=!1,o.min_unit_ok=!1,o.attention=1):(o.min_qty_ok=!0,o.min_unit_ok=!0),o.locations_count=parseInt(o.locations_count.toString()),o.category=this.categories.find(l=>l.id===o.category_id)}),this.spinner.hide("waiting"),this.loading=!1):(this.spinner.hide("waiting"),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.spinner.hide("waiting"),this.toastr.error(i.message))}).catch(i=>{this.toastr.error(i),this.spinner.hide("waiting")})}selectItem(e){if(e.selling_units)this.showNotification=!1,this.activateSellForm=!1,this.itemToSellModel=e,this.itemToSellModel.unit=e.selling_units[0],this.itemToSellModel.unit_price=this.itemToSellModel.unit.recom_selling_price,this.itemToSellModel.discount=0,this.itemToSellModel.total_price=0,this.availableUnits=[],this.buttonClicked=!1,this.displaySellDialog=!0,this.checkPrice();else{this.loading2=!0;let i=this.allStock.find(l=>l.id===e.id);this.itemToViewLocations=i;const o={action:this.cryptoSrv.encodeEncryptText("get_item_all_locations_quantity"),item_id:e.id,added_by:this.authSrv.getUserDetailToken("uid")};this.apiSrv.read(o).then(l=>{"error"!=l.status?"error2"!=l.status?(i.selling_units=l.selling_units,i.locations_qty=l.locations_qty,i.total_qty=l.total_qty,i.locations=l.locations,this.showNotification=!1,this.activateSellForm=!1,this.itemToSellModel=e,this.itemToSellModel.unit=e.selling_units[0],this.itemToSellModel.unit_price=this.itemToSellModel.unit.recom_selling_price,this.itemToSellModel.discount=0,this.itemToSellModel.total_price=0,this.availableUnits=[],this.buttonClicked=!1,this.displaySellDialog=!0,this.checkPrice(),this.loading2=!1):(this.loading2=!1,this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.loading2=!1,this.toastr.error(l.message))}).catch(l=>{this.toastr.error(l),this.loading2=!1})}}updateLocationSelected(e){this.itemToSellModel.location_id=e.value.location.id,this.itemToSellModel.location=e.value,this.itemToSellModel.unit_quantity=0,this.itemToSellModel.unit=null,this.checkLockStatus()}updateUnitSelected(e){this.itemToSellModel.unit_id=e.value.id,this.itemToSellModel.unit=e.value,this.itemToSellModel.unit_price=this.itemToSellModel.unit.recom_selling_price,this.itemToSellModel.unit_quantity=0,this.checkLockStatus(),this.checkPrice()}updateAvailableUnits(e){const i=this.getLocationUnitQuantity(e,this.itemToSellModel.selling_units);this.availableUnits=Object.entries(i)}checkPrice(){const e=parseInt(this.itemToSellModel.buying_price)*this.itemToSellModel.unit.unit_quantity;this.priceError=parseInt(this.itemToSellModel.unit_price)<e?"Selling price is lower than buying price":""}checkLockStatus(){this.spinner.show("sell"),this.spinner.show("sellw");const e={action:this.cryptoSrv.encodeEncryptText("check-lock-status"),item_id:this.itemToSellModel.id,location_id:this.itemToSellModel.location_id,uid:this.authSrv.getUserDetailToken("uid"),right:this.cryptoSrv.encodeEncryptText("sell_debtor")};this.apiSrv.read(e).then(i=>{if("error"!=i.status)if("error2"!=i.status){this.activateSellForm=!0;const o=this.itemToSellModel.locations_qty.find(({location:l})=>l.id===this.itemToSellModel.location.location.id);o&&(o.location_quantity=i.qty),this.updateAvailableUnits(i.qty),this.loading=!1,this.spinner.hide("sell"),this.spinner.hide("sellw")}else this.spinner.hide("sell"),this.spinner.hide("sellw"),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout();else this.spinner.hide("sell"),this.spinner.hide("sellw"),"locked"===i.message?(this.activateSellForm=!1,this.toastr.warning("Item is locked by "+i.user)):(this.activateSellForm=!1,this.toastr.error(i.message))}).catch(i=>{this.toastr.error(i),this.spinner.hide("sell")})}checkQuantity(){const e=this.itemToSellModel.location,o=this.itemToSellModel.locations_qty.find(a=>a.id===e.id).location_quantity;if(this.itemToSellModel.unit_quantity*this.itemToSellModel.unit.unit_quantity>o){const a=Math.floor(parseInt(o)/parseInt(this.itemToSellModel.unit.unit_quantity));this.quantityError="You can only sell a max of "+a+" "+this.itemToSellModel.unit.unit_name}else this.itemToSellModel.total_price=parseFloat(this.itemToSellModel.unit_quantity)*parseFloat(this.itemToSellModel.unit_price),this.itemToSellModel.total_price=this._decimalPipe.transform(this.itemToSellModel.total_price,"1.2-2"),this.quantityError=""}confirmPrice(){this.itemToSellModel.unit_price<this.itemToSellModel.unit.min_selling_price?this.priceError2="Selling price cannot be below "+this.itemToSellModel.unit.min_selling_price:(this.itemToSellModel.total_price=parseFloat(this.itemToSellModel.unit_quantity)*parseFloat(this.itemToSellModel.unit_price),this.itemToSellModel.total_price=this._decimalPipe.transform(this.itemToSellModel.total_price,"1.2-2"),this.priceError2="")}checkDiscountTotal(){const i=(this.itemToSellModel.unit.recom_selling_price-this.itemToSellModel.unit.min_selling_price)*this.itemToSellModel.unit_quantity;this.discountError=this.itemToSellModel.discount>i?"Discount cannot be more than "+i:""}hideSellForm(){this.displaySellDialog=!1,this.unLockItem(this.itemToSellModel)}unLockItem(e){if(this.itemToSellModel.location){this.spinner.show();const i={action:this.cryptoSrv.encodeEncryptText("unlock-item"),item_id:this.itemToSellModel.id,location_id:this.itemToSellModel.location.id,user_id:this.authSrv.getUserDetailToken("uid")};this.apiSrv.read(i).then(o=>{"error"!=o.status?"error2"!=o.status?(this.itemToSellModel={},this.getAllStockAndCart(),this.loading=!1,this.spinner.hide()):(this.spinner.hide(),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.spinner.hide(),"locked"===o.message?this.toastr.warning("Item is locked by "+o.user):this.toastr.error(o.message))}).catch(o=>{this.toastr.error(o),this.spinner.hide()})}else this.displaySellDialog=!1,this.itemToSellModel={}}addToCart(){this.buttonClicked=!0,this.spinner.show("sell");const e=parseFloat(this.itemToSellModel.unit_quantity)*parseFloat(this.itemToSellModel.unit.unit_quantity),i=parseFloat(this.itemToSellModel.buying_price)*parseFloat(this.itemToSellModel.unit.unit_quantity),o=parseFloat(this.itemToSellModel.unit.min_selling_price),l=parseFloat(this.itemToSellModel.unit.recom_selling_price);this.itemToSellModel.unit_price=this.itemToSellModel.unit_price-this.itemToSellModel.discount/this.itemToSellModel.unit_quantity;const c={action:this.cryptoSrv.encodeEncryptText("add-item-to-cart-debtor"),item_id:this.itemToSellModel.id,cid:this.selectedCustomer.id,location_id:this.itemToSellModel.location.location.id,unit_id:this.itemToSellModel.unit.id,unit_qty:this.cryptoSrv.encodeEncryptText(this.itemToSellModel.unit_quantity.toString()),tt_qty:this.cryptoSrv.encodeEncryptText(e.toString()),unit_bp:this.cryptoSrv.encodeEncryptText(i.toString()),min_sp:this.cryptoSrv.encodeEncryptText(o.toString()),recom_sp:this.cryptoSrv.encodeEncryptText(l.toString()),unit_price:this.cryptoSrv.encodeEncryptText(this.itemToSellModel.unit_price.toString()),uid:this.authSrv.getUserDetailToken("uid")};this.apiSrv.post(c).then(r=>{"error"!=r.status?"error2"!=r.status?(this.activateSellForm=!1,this.displaySellDialog=!1,this.getAllStockAndCart(),this.spinner.hide("sell"),this.availableUnits=[]):(this.spinner.hide("sell"),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.spinner.hide("sell"),"locked"===r.message?(this.activateSellForm=!1,this.toastr.warning("Item is locked by "+r.user)):this.toastr.error(r.message))}).catch(r=>{this.toastr.error(r),this.spinner.hide("sell")})}confirmDelete(e){this.confirmationService.confirm({message:"Are you sure you want to delete item from list?",acceptButtonStyleClass:"btn btn-primary",rejectButtonStyleClass:"btn btn-danger",accept:()=>{this.spinner.show("waiting");const i=e.unit.unit_quantity*e.qty,o={action:this.cryptoSrv.encodeEncryptText("delete-item-from-cart-debtor-new"),id:e.id,customer:this.selectedCustomer.id,item_id:e.item.id,tt_qty:this.cryptoSrv.encodeEncryptText(i.toString()),location_id:e.location.id,added_by:this.authSrv.getUserDetailToken("uid")};this.apiSrv.post(o).then(l=>{"error"!=l.status?"error2"!=l.status?(this.newStock=l.stock,this.locations=l.locations,this.cartItems=l.cartItems,this.availableUnits=[],this.selectedItem={},this.newStock=l.stock,this.locations=l.locations,this.cartItems=l.cartItems,this.totalCartAmount=0,this.cartItems.forEach(a=>{this.totalCartAmount+=a.qty*a.sp}),this.newStock.forEach(a=>{const c=a.locations.split(",");a.locations_count=c.length,1==a.min_unit_ok&&(a.min_unit_ok=!0)}),this.spinner.hide("waiting"),this.toastr.success("Item deleted")):(this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout(),this.spinner.hide("waiting")):(this.spinner.hide("new"),"locked"===l.message?(this.activateSellForm=!1,this.toastr.warning("Item is locked by "+l.user)):this.toastr.error(l.message))}).catch(l=>{this.toastr.error(l),this.spinner.hide("waiting")})},reject:()=>{}})}completeSale(){const e=this.selectedCustomer.sales_limit-this.selectedCustomer.balance;if(this.totalCartAmount>e)this.toastr.error("Total amount will exceed customers limit. You can only sell a total of Ksh"+parseInt(e.toString())+" to this customer");else{this.spinner.show("waiting");const i=new Date;this.dateOfSale.setHours(i.getHours()),this.dateOfSale.setMinutes(i.getMinutes()),this.dateOfSale.setSeconds(i.getSeconds());const o={action:this.cryptoSrv.encodeEncryptText("complete-debtor-sale"),cid:this.selectedCustomer.id,date_of_sale:this.cryptoSrv.encodeEncryptText(this.dateOfSale.toLocaleString("sv-SE",{hour12:!1})),added_by:this.authSrv.getUserDetailToken("uid"),total:this.cryptoSrv.encodeEncryptText(this.totalCartAmount.toString())};this.apiSrv.post(o).then(l=>{"error"!=l.status?"error2"!=l.status?"lock"!=l.status?(this.displayCustomerDialog=!1,"yes"===this.printReceipt||"yes"===this.printDeliveryReceipt||"yes"===this.printA4Receipt?(this.shopDetail=l.Shop,"yes"===this.printReceipt&&this.printTestWaitingCustomer(),"yes"===this.printDeliveryReceipt&&this.printTestWaitingCustomerDelivery(),"yes"===this.printA4Receipt&&this.downloadReceipt(l.balance_bf),setTimeout(()=>{this.ngOnInit()},3e3),this.toastr.success("Sale completed")):(this.ngOnInit(),this.toastr.success("Sale completed!")),this.spinner.hide("waiting")):(this.spinner.hide("waiting"),this.toastr.warning(l.message)):(this.spinner.hide("waiting"),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):"Quantity less!"==l.message?(this.spinner.hide("waiting"),this.showQuantityError=!0,this.lessItems=l.items):(this.spinner.hide("waiting"),"locked"===l.message?this.toastr.warning("Item is locked by "+l.user):this.toastr.error(l.message))}).catch(l=>{this.toastr.error(l),this.spinner.hide()})}}getReprintData(){this.spinner.show();const e={action:this.cryptoSrv.encodeEncryptText("get-user-reprint-debtor-transactions"),uid:this.authSrv.getUserDetailToken("uid")};this.apiSrv.read(e).then(i=>{"error"!=i.status?"error2"!=i.status?(this.reprintItems=i.transactions,this.spinner.hide(),this.reprintItems.forEach(o=>{o.transaction_code=this.cryptoSrv.decryptEncodedText(o.transaction_code)}),this.showReprintForm=!0,this.loading=!1):(this.spinner.hide(),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.spinner.hide(),this.toastr.error(i.message))}).catch(i=>{this.toastr.error(i),this.spinner.hide()})}getTimeValue(e){return new Date(e).toLocaleString("en-US",{hour12:!0}).split(", ")[1]}selectReceipt(e,i,o,l){this.transactionToView=e,this.spinner.show("reprint");const a={code:this.cryptoSrv.encodeEncryptText(this.transactionToView.transaction_code),uid:this.authSrv.getUserDetailToken("uid")};i||o?(this.selectedCustomer={id:e.customer.id,name:e.customer.name,sales_limit:0,mobile_number:0,balance:0,pending_transactions:[]},a.action=this.cryptoSrv.encodeEncryptText("get-user-debtor-reprint-items")):a.action=this.cryptoSrv.encodeEncryptText("get-debtor-transaction-code-items"),this.apiSrv.read(a).then(c=>{if("error"!=c.status)if("error2"!=c.status){if(this.spinner.hide("reprint"),i||o){if(this.shopDetail=c.Shop,this.cartItems=c.items,this.totalCartAmount=0,this.cartItems.forEach(r=>{this.totalCartAmount+=r.sp*r.qty}),i)if(l){const r={};r.number=this.cryptoSrv.decryptEncodedText(this.shopDetail.tcode),r.invoice_total=this.totalCartAmount,r.date=new Date,r.items=[],this.cartItems.forEach(u=>{r.items.push({item:u.item.name,unit:u.unit,unit_quantity:u.qty,selling_price:u.sp})}),this.pdfSrv.downloadReceipt(r,this.shopDetail,this.selectedCustomer,c.balance_bf)}else this.printTestWaitingCustomer();o&&this.printTestWaitingCustomerDelivery()}else this.transactionToView.items=c.items,this.displayItemsDialog=!0;this.loading=!1}else this.spinner.hide("reprint"),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout();else this.spinner.hide("reprint"),this.toastr.error(c.message)}).catch(c=>{this.toastr.error(c),this.spinner.hide("reprint")})}createPrintDataWaiting(){let e={};e.name=this.cryptoSrv.decryptEncodedText(this.shopDetail.name),e.tcode=this.cryptoSrv.decryptEncodedText(this.shopDetail.tcode),e.username=this.cryptoSrv.decryptEncodedText(this.shopDetail.username),e.location=this.cryptoSrv.decryptEncodedText(this.shopDetail.location),e.description=this.cryptoSrv.decryptEncodedText(this.shopDetail.description),e.contacts=[],e.balance_bf=this.shopDetail.balance_bf,this.shopDetail.contacts.forEach(p=>{let x=this.cryptoSrv.decryptEncodedText(p);e.contacts.push(x)}),e.receipt_options={},e.receipt_options.till=this.cryptoSrv.decryptEncodedText(this.shopDetail.receipt_options.till),e.receipt_options.paybill=this.cryptoSrv.decryptEncodedText(this.shopDetail.receipt_options.paybill),e.receipt_options.paybill_account=this.cryptoSrv.decryptEncodedText(this.shopDetail.receipt_options.paybill_account),e.receipt_options.mpesa_business_name=this.cryptoSrv.decryptEncodedText(this.shopDetail.receipt_options.mpesa_business_name),e.receipt_options.footer_message=this.cryptoSrv.decryptEncodedText(this.shopDetail.receipt_options.footer_message),e.receipt_options.image_url=this.cryptoSrv.decryptEncodedText(this.shopDetail.receipt_options.image_url);var i="";i+="\x1b!\0";let l=0,a=0,c=0;this.cartItems.forEach(p=>{const x=p.unit.unit_name.length+p.unit.unit_quantity.toString().length;l=Math.max(l,x);const Z=p.qty.toString().length;a=Math.max(a,Z);const A=p.sp.toString().length;c=Math.max(c,A)});const r="UNIT",T="@PRICE",f=a-"QTY".length+6,V=c-T.length+3,N=r+" ".repeat(l-r.length+5)+"QTY"+" ".repeat(f)+T+" ".repeat(V)+"TOTAL";i+="\x1bE\r",i+="-----------------------------------------------\n",i+=N+"\n",i+="-----------------------------------------------\n\n",i+="\x1bE\n",this.cartItems.forEach(p=>{i+=p.item.name+"  -  "+p.location.name+"\n";const x=(0,y._)(p.unit.unit_name)+"("+(0,d.uf)(p.unit.unit_quantity,this.locale,".0")+")   x",Z=(0,d.uf)(p.qty,this.locale,".0"),A=(0,d.uf)(p.sp,this.locale,".2"),Ve=(0,d.uf)(parseFloat(p.sp.toString())*parseFloat(p.qty.toString()),this.locale,".2"),ze=a-Z.length+6,Xe=c-A.length+3;i+=x+" ".repeat(l-x.length+5)+Z+" ".repeat(ze)+A+" ".repeat(Xe)+Ve+"\n",i+="\n\n",i+="\x1ba0"});var g="";g+="\x1bE\r",""!==e.receipt_options.till&&(g+="LIPA NA MPESA TILL NUMBER: "+e.receipt_options.till+"\n",""===e.receipt_options.paybill&&(g+="\n")),""!==e.receipt_options.paybill&&(""!==e.receipt_options.till&&(g+="\n"),g+="M-PESA PAYBILL NUMBER: "+e.receipt_options.paybill+"\n",g+="PAYBILL ACCOUNT: "+e.receipt_options.paybill_account+"\n",g+="\n"),(""!==e.receipt_options.paybill||""!==e.receipt_options.till)&&(g+="\x1bE\n",g+="M-PESA BUSINESS NAME: "+e.receipt_options.mpesa_business_name+"\n",g+="\n"),new Date;var E=new d.uU("en-US");const C=Date.now(),R=E.transform(C,"medium"),h=e.name.toUpperCase();this.receiptCustomer=(0,y._)(this.selectedCustomer.name);var m=function(p){return String.fromCharCode(p)},b="\x1dh"+m(70)+"\x1df"+m(0)+"\x1dk"+m(69)+m(this.shopDetail.tcode.length)+this.shopDetail.tcode+m(0);if(""!==e.receipt_options.image_url){const p=(0,d.uf)(this.totalCartAmount,this.locale,".2");let x="";return this.shopDetail.contacts.forEach(A=>{x+=this.cryptoSrv.decryptEncodedText(A)+", "}),["\x1b@","\x1ba1","\x1d!\x10","\x1bE\r","\x1d!\x10",h+"\n","\n",{type:"raw",format:"image",flavor:"file",data:this.shopLogoUrl+e.receipt_options.image_url,options:{language:"ESCPOS",dotDensity:"single"}},"\x1bE\n","\x1d!\0","\x1d!\0","\n",e.description+"\n",e.location+"\n","FOR ENQUIRIES CALL: "+x+"\n","\n","\x1ba0","\x1bE\r","INVOICE ORDER FOR; "+this.receiptCustomer+"\n","\x1bE\n","\n",i+"\n","-----------------------------------------------\n","\x1bE\r","\x1d!\x10","TOTAL     "+p,"\n","\x1bE\n","\x1d!\0","-----------------------------------------------\n","\x1ba1",this.showReprintForm?"":b,g,"\x1bE\r","THIS RECEIPT IS NOT VALID FOR GOODS FOR\n","LATER COLLECTION\n","\x1bE\n","** THANK YOU AND WELCOME AGAIN **\n","RECEIPT # "+e.tcode+"  "+R+"\n\n","Served by "+(0,y._)(e.username),"\n","\n\n\n\n\n\n\n","\x1dV\0"]}{const p=(0,d.uf)(this.totalCartAmount,this.locale,".2");let x="";return this.shopDetail.contacts.forEach(A=>{x+=this.cryptoSrv.decryptEncodedText(A)+", "}),["\x1b@","\x1ba1","\x1d!\x10","\x1bE\r",h+"\n","\x1bE\n","\x1d!\0","\x1d!\0","\n",e.description+"\n",e.location+"\n","FOR ENQUIRIES CALL: "+x+"\n","\n","\x1ba0","\x1bE\r","INVOICE ORDER FOR; "+this.receiptCustomer+"\n","\x1bE\n","\n",i+"\n","-----------------------------------------------\n","\x1bE\r","\x1d!\x10","TOTAL     "+p,"\n","\x1bE\n","\x1d!\0","-----------------------------------------------\n","\x1d!\x10","\x1bE\r",this.showReprintForm?"":"BALANCE B.F       "+(0,d.uf)(parseFloat(e.balance_bf),this.locale,".0")+"\n",this.showReprintForm?"":"TOTAL BALANCE    "+(0,d.uf)(parseFloat(e.balance_bf)+this.totalCartAmount,this.locale,".0")+"\n","\x1bE\n","\x1d!\0","\x1ba1",this.showReprintForm?"":b,g,"\x1bE\r","THIS RECEIPT IS NOT VALID FOR GOODS FOR\n","LATER COLLECTION\n","\x1bE\n","** THANK YOU AND WELCOME AGAIN **\n","RECEIPT # "+e.tcode+"  "+R+"\n\n","Served by "+(0,y._)(e.username),"\n","\n\n\n\n\n\n\n","\x1dV\0"]}}createPrintDataWaitingDelivery(){let e={};e.name=this.cryptoSrv.decryptEncodedText(this.shopDetail.name),e.tcode=this.cryptoSrv.decryptEncodedText(this.shopDetail.tcode),e.username=this.cryptoSrv.decryptEncodedText(this.shopDetail.username),e.location=this.cryptoSrv.decryptEncodedText(this.shopDetail.location),e.description=this.cryptoSrv.decryptEncodedText(this.shopDetail.description),e.contacts=[],this.shopDetail.contacts.forEach(h=>{let m=this.cryptoSrv.decryptEncodedText(h);e.contacts.push(m)}),e.receipt_options={},e.receipt_options.till=this.cryptoSrv.decryptEncodedText(this.shopDetail.receipt_options.till),e.receipt_options.paybill=this.cryptoSrv.decryptEncodedText(this.shopDetail.receipt_options.paybill),e.receipt_options.paybill_account=this.cryptoSrv.decryptEncodedText(this.shopDetail.receipt_options.paybill_account),e.receipt_options.mpesa_business_name=this.cryptoSrv.decryptEncodedText(this.shopDetail.receipt_options.mpesa_business_name),e.receipt_options.footer_message=this.cryptoSrv.decryptEncodedText(this.shopDetail.receipt_options.footer_message),e.receipt_options.image_url=this.cryptoSrv.decryptEncodedText(this.shopDetail.receipt_options.image_url);var i="";i+="\x1b!\0";let l=0,a=0,c=0;this.cartItems.forEach(h=>{const m=h.unit.unit_name.length+h.unit.unit_quantity.toString().length;l=Math.max(l,m);const b=h.qty.toString().length;a=Math.max(a,b);const p=h.sp.toString().length;c=Math.max(c,p)});const r="UNIT",D=a-"QTY".length+6,U=r+" ".repeat(l-r.length+5)+"QTY"+" ".repeat(D)+" ";i+="\x1bE\r",i+="-----------------------------------------------\n",i+=U+"\n",i+="-----------------------------------------------\n\n",i+="\x1bE\n",this.cartItems.forEach(h=>{i+=h.item.name+"  -  "+h.location.name+"\n";const m=(0,y._)(h.unit.unit_name)+"("+(0,d.uf)(h.unit.unit_quantity,this.locale,".0")+")   x",b=(0,d.uf)(h.qty,this.locale,".0");i+=m+" ".repeat(l-m.length+5)+b+" \n",i+="\n\n",i+="\x1ba0"}),new Date;var N=new d.uU("en-US");const g=Date.now(),L=N.transform(g,"medium"),E=e.name.toUpperCase();this.receiptCustomer=(0,y._)(this.selectedCustomer.name);var C=function(h){return String.fromCharCode(h)};if(C(70),C(0),C(69),C(e.tcode.length),C(0),""!==e.receipt_options.image_url){(0,d.uf)(this.totalCartAmount,this.locale,".2");let m="";return this.shopDetail.contacts.forEach(p=>{m+=this.cryptoSrv.decryptEncodedText(p)+", "}),["\x1b@","\x1ba1","\x1d!\x10","\x1bE\r","\x1d!\x10",E+"\n","\n",{type:"raw",format:"image",flavor:"file",data:this.shopLogoUrl+this.cryptoSrv.decryptEncodedText(this.shopDetail.receipt_options.image_url),options:{language:"ESCPOS",dotDensity:"single"}},"\x1bE\n","\x1d!\0","\x1d!\0","\n",e.description+"\n",e.location+"\n","FOR ENQUIRIES CALL: "+m+"\n","\n","\x1bE\r","\x1d!\x10","DELIVERY NOTE\n","\n","\x1d!\0","\x1ba0","INVOICE ORDER FOR; "+this.receiptCustomer+"\n","\x1bE\n","\n",i+"\n","\x1bE\r","\x1d!\x10","\n","\x1bE\n","\x1d!\0","\x1ba1","\x1bE\r","Received by __________________________________________\n\n","Sign  ___________________________________________\n\n","Date  ___________________________________________\n\n","\x1bE\n","** THANK YOU AND WELCOME AGAIN **\n","RECEIPT # "+e.tcode+"  "+L+"\n\n","Served by "+(0,y._)(e.username),"\n","\n\n\n\n\n\n\n","\x1dV\0"]}{(0,d.uf)(this.totalCartAmount,this.locale,".2");let m="";return this.shopDetail.contacts.forEach(p=>{m+=this.cryptoSrv.decryptEncodedText(p)+", "}),["\x1b@","\x1ba1","\x1d!\x10","\x1bE\r","\x1d!\x10",E+"\n","\x1bE\n","\x1d!\0","\x1d!\0","\n",e.description+"\n",e.location+"\n","FOR ENQUIRIES CALL: "+m+"\n","\n","\x1bE\r","\x1d!\x10","DELIVERY NOTE\n","\n","\x1d!\0","\x1ba0","INVOICE ORDER FOR; "+this.receiptCustomer+"\n","\x1bE\n","\n",i+"\n","\x1bE\r","\x1d!\x10","\n","\x1bE\n","\x1d!\0","\x1ba1","\x1bE\r","Received by __________________________________________\n\n","Sign  ___________________________________________\n\n","Date  ___________________________________________\n\n","\x1bE\n","** THANK YOU AND WELCOME AGAIN **\n","RECEIPT # "+e.tcode+"  "+L+"\n\n","Served by "+(0,y._)(e.username),"\n","\n\n\n\n\n\n\n","\x1dV\0"]}}downloadReceipt(e){const i={};i.number=this.cryptoSrv.decryptEncodedText(this.shopDetail.tcode),i.invoice_total=this.totalCartAmount,i.date=new Date,i.items=[],this.cartItems.forEach(o=>{i.items.push({item:o.item.name,unit:o.unit,unit_quantity:o.qty,selling_price:o.sp})}),this.pdfSrv.downloadReceipt(i,this.shopDetail,this.selectedCustomer,e)}printTestWaitingCustomer(){this.printSrv.printtest2(this.createPrintDataWaiting()),this.cryptoSrv.decryptEncodedText(this.shopDetail.name).toLowerCase().includes("ryden")&&setTimeout(()=>{this.printSrv.printtest2(this.createPrintDataWaiting())},1500),(this.displayItemsDialog||this.showReprintForm)&&(this.displayItemsDialog=!1)}printTestWaitingCustomerDelivery(){this.printSrv.printtest2(this.createPrintDataWaitingDelivery()),(this.displayItemsDialog||this.showReprintForm)&&(this.displayItemsDialog=!1)}getImageWaitingCustomer(e){this.getBase64ImageFromURL(e).subscribe(i=>{this.base64TrimmedURL=i,this.printSrv.printtest2(this.createPrintDataWaiting()),setTimeout(()=>{this.ngOnInit()},1700),this.toastr.success("Sale completed!")})}getBase64ImageFromURL(e){return W.y.create(i=>{let o=new Image;o.crossOrigin="Anonymous",o.src=e,o.complete?(i.next(this.getBase64Image(o)),i.complete()):(o.onload=()=>{i.next(this.getBase64Image(o)),i.complete()},o.onerror=l=>{i.error(l)})})}getBase64Image(e){var i=document.createElement("canvas");i.width=e.width,i.height=e.height,i.getContext("2d").drawImage(e,-5,0);let l=i.toDataURL("image/png");return this.base64DefaultURL=l,l.replace(/^data:image\/(png|jpg);base64,/,"")}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(B.t2),t.Y36(z.$),t.Y36(X._W),t.Y36(tt.e),t.Y36(et.s),t.Y36(it.F),t.Y36(d.JJ),t.Y36(k.YP),t.Y36(ot.$),t.Y36(t.soG))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-debtor-sale"]],viewQuery:function(e,i){if(1&e&&(t.Gf(ut,5),t.Gf(ht,5),t.Gf(mt,5)),2&e){let o;t.iGM(o=t.CRH())&&(i.table=o.first),t.iGM(o=t.CRH())&&(i.overlay=o.first),t.iGM(o=t.CRH())&&(i.overlay1=o.first)}},decls:25,vars:35,consts:[["class","row",4,"ngIf"],["appendTo","body","modal","true",3,"header","closable","visible","style","baseZIndex","visibleChange",4,"ngIf"],["appendTo","body","modal","true","header","",3,"closable","visible","baseZIndex","visibleChange","onHide"],["styleClass","p-datatable-customers","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"value","rowHover","rows","showCurrentPageReport","rowsPerPageOptions","paginator","filterDelay","globalFilterFields",4,"ngIf"],["bdOpacity","#fff","name","reprint","bdColor","rgba(255,255,255,0.76)","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[2,"color","#02926e"],["appendTo","body","modal","true",3,"header","closable","visible","baseZIndex","visibleChange","onHide"],[1,"row"],[1,"col-md-12","text-right"],["label","Reprint","icon","pi pi-print","iconPos","right","styleClass","p-button-sm p-button-help",3,"click"],[1,"col-md-12"],["appendTo","body","modal","true","header","Items with less quantity available",3,"closable","visible","style","baseZIndex","visibleChange",4,"ngIf"],[3,"showCloseIcon"],["op1",""],["pTemplate",""],["op",""],["header","Confirm","icon","pi pi-exclamation-triangle","appendTo","body",3,"baseZIndex"],["bdOpacity","#fff","bdColor","rgba(255,255,255,0.76)","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[1,"col-md-3"],[1,"col-md-6"],[1,"card"],[1,"card-header"],[1,"card-title"],["label","Reprint a receipt","icon","fas fa-print","styleClass","p-button-sm p-button-outlined p-button-help float-right",3,"click"],[1,"card-body"],["styleClass","p-datatable-customers","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"value","rowHover","rows","showCurrentPageReport","rowsPerPageOptions","paginator","filterDelay","globalFilterFields"],["dt22",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"ui-selectable-row"],[2,"width","15rem"],["colspan","2"],["pInputText","","type","text","placeholder","Search...",1,"ui-column-filter",3,"input"],[2,"word-wrap","normal"],[2,"white-space","nowrap"],["label","Sell to customer","icon","pi pi-arrow-right","iconPos","right","styleClass","p-button-sm p-button-primary mr-5 float-right",3,"class","click",4,"ngIf"],["class","danger",4,"ngIf"],["label","Sell to customer","icon","pi pi-arrow-right","iconPos","right","styleClass","p-button-sm p-button-primary mr-5 float-right",3,"click"],[1,"danger"],["colspan","3",2,"text-align","center"],["appendTo","body","modal","true",3,"header","closable","visible","baseZIndex","visibleChange"],["type","button","pButton","","icon","pi pi-times","label","Close",1,"p-button-danger","p-button-sm","float-right",3,"click"],["bdOpacity","#fff","bdColor","rgba(255,255,255,0.76)","size","medium","name","waiting","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[1,"col-md-8"],[1,"card-title","mb-4"],[1,"card-body","p-0","m-0"],["styleClass","p-datatable-customers","dataKey","id","editMode","row","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"value","rows","showCurrentPageReport","rowsPerPageOptions","paginator","filterDelay","globalFilterFields"],["dt1",""],[1,"col-md-4"],["dt82",""],["class","row py-3",4,"ngIf"],[2,"width","5rem"],[2,"width","10rem"],[2,"width","20rem"],["pInputText","","type","text","placeholder","Search item...",1,"ui-column-filter",3,"input"],["colspan","7"],[2,"word-wrap","normal",3,"pEditableRow"],[3,"click",4,"ngIf"],["class","animate-flicker warning",4,"ngIf"],[4,"ngIf"],["class","pt-2",4,"ngIf"],["class","flex align-items-center justify-content-center gap-0",4,"ngIf"],[3,"click"],["label","","shape","circle",3,"style",4,"ngFor","ngForOf"],["label","","shape","circle"],[1,"animate-flicker","warning"],["pTemplate","input"],["pTemplate","output"],["placeholder","Select location","name","unit","appendTo","body","optionLabel","location.name",3,"options","disabled","ngModel","filter","onChange","ngModelChange","keydown.enter"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"ui-helper-clearfix"],["placeholder","Select unit","name","unit","appendTo","body","optionLabel","",3,"options","disabled","ngModel","filter","onChange","ngModelChange","keydown.enter"],["pInputText","","autocomplete","off","type","text","name","qty",2,"width","6rem",3,"id","ngModel","ngModelChange","input","keydown.enter"],["class","m-0 p-0 animate-flicker",4,"ngIf"],[1,"m-0","p-0","animate-flicker"],[2,"font-size","12px"],[1,"text-danger"],["pInputText","","autocomplete","off","type","text",2,"width","6rem",3,"disabled","id","ngModel","ngModelChange","input","keydown.enter"],[1,"pt-2"],[1,"flex","align-items-center","justify-content-center","gap-0"],["pButton","","pRipple","","type","button","pInitEditableRow","","icon","pi pi-pencil","class","p-button-rounded p-button-text",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","pSaveEditableRow","","icon","pi pi-check","class","p-button-rounded p-button-sm p-button-success m-0 p-0",3,"id","disabled","click",4,"ngIf"],["pButton","","pRipple","","type","button","pCancelEditableRow","","icon","pi pi-times","class","p-button-rounded p-button-text p-button-sm p-button-danger m-0 p-0",3,"click",4,"ngIf"],["class","loader",4,"ngIf"],["pButton","","pRipple","","type","button","pInitEditableRow","","icon","pi pi-pencil",1,"p-button-rounded","p-button-text",3,"click"],["pButton","","pRipple","","type","button","pSaveEditableRow","","icon","pi pi-check",1,"p-button-rounded","p-button-sm","p-button-success","m-0","p-0",3,"id","disabled","click"],["pButton","","pRipple","","type","button","pCancelEditableRow","","icon","pi pi-times",1,"p-button-rounded","p-button-text","p-button-sm","p-button-danger","m-0","p-0",3,"click"],[1,"loader"],["pSortableColumn","name",2,"width","10rem"],["field","name"],["pInputText","","type","text","placeholder","Search item name",1,"ui-column-filter",3,"input"],["label","","icon","pi pi-trash","iconPos","right","styleClass","p-button-danger p-button-outlined p-button-sm",3,"onClick"],[1,"row","py-3"],[1,"col-md-12","text-center"],[1,"card","bg-white","text-center"],[1,"card-content","text-center"],[1,"col-md-8","pb-3","offset-md-4"],[1,"ui-fluid","px-2"],[1,"p-field"],[1,"field-radiobutton"],["name","city11","value","today","inputId","city11",3,"ngModel","ngModelChange"],["for","city11"],["class","field-radiobutton",4,"ngIf"],["appendTo","body","name","start_date","required","","readonlyInput","true",3,"ngModel","maxDate","touchUI","monthNavigator","ngModelChange",4,"ngIf"],[1,"col-md-4","py-3"],["name","receipt1","value","yes","inputId","receipt1",3,"ngModel","ngModelChange"],["for","receipt1"],["name","receipt2","value","no","inputId","receipt2",3,"ngModel","ngModelChange"],["for","receipt2"],["name","receipt3","value","yes","inputId","receipt3",3,"ngModel","ngModelChange"],["for","receipt3"],["name","receipt4","value","no","inputId","receipt4",3,"ngModel","ngModelChange"],["for","receipt4"],["name","receipt5","value","yes","inputId","receipt5",3,"ngModel","ngModelChange"],["for","receipt5"],["name","receipt6","value","no","inputId","receipt6",3,"ngModel","ngModelChange"],["for","receipt6"],[1,"col-md-8","offset-md-4","pb-4"],["pButton","","type","button","icon","pi pi-check","label","Complete sale",1,"p-button-raised","p-button-success",3,"click"],["name","city22","value","notToday","inputId","city22",3,"ngModel","ngModelChange"],["for","city22"],["appendTo","body","name","start_date","required","","readonlyInput","true",3,"ngModel","maxDate","touchUI","monthNavigator","ngModelChange"],["autocomplete","off",3,"ngSubmit",4,"ngIf"],["bdOpacity","#fff","name","sell","bdColor","rgba(255,255,255,0.76)","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],["autocomplete","off",3,"ngSubmit"],["form2","ngForm"],[1,"ui-fluid"],[1,"col-6"],[1,"p-field","pb-3"],["for","location"],["placeholder","Select location","name","location","appendTo","body","optionLabel","location.name","filter","true",3,"options","ngModel","onChange","ngModelChange"],["for","unit"],["placeholder","Select item unit","name","unit","appendTo","body","optionLabel","unit_name","filter","true",3,"options","disabled","ngModel","onChange","ngModelChange"],["class","col-6",4,"ngIf"],["for","unitq"],["id","unitq","name","unit_quantity","required","","type","number","pattern","[0-9]+","pInputNumber","",1,"form-control",3,"disabled","ngModel","input","ngModelChange"],["id","unitq-help","class","p-error block",4,"ngIf"],["id","unitsp","name","unit_price","required","","type","number","pInputNumber","",1,"form-control",3,"ngModel","input","ngModelChange"],["id","disc-help","class","p-error block animate-flicker",4,"ngIf"],["for","totalp"],["id","totalp","name","total_price","required","","type","text","pInputText","",1,"form-control",3,"disabled","value"],["type","button","pButton","","icon","pi pi-times","label","Cancel",1,"p-button-danger","p-button-sm","float-right",3,"click"],["type","submit","pButton","","icon","pi pi-check","label","Add to list",1,"p-button-success","p-button-sm","mr-3","float-right",3,"disabled"],["selectionMode","single","responsiveLayout","scroll",3,"value","paginator","rows"],["id","unitq-help",1,"p-error","block"],["id","disc-help",1,"p-error","block","animate-flicker"],["dtr",""],["pSortableColumn","customer",2,"width","15rem"],[2,"width","25rem"],["colspan","8"],["label","Show items","icon","pi pi-list","iconPos","right","styleClass","p-button-info p-button-sm mr-3",3,"onClick",4,"ngIf"],["ngbDropdown","","class","d-inline-block","container","body","placement","bottom-start",4,"ngIf"],["label","Show items","icon","pi pi-list","iconPos","right","styleClass","p-button-info p-button-sm mr-3",3,"onClick"],["ngbDropdown","","container","body","placement","bottom-start",1,"d-inline-block"],["type","button","pButton","","id","dropdownBasic1","ngbDropdownToggle","",1,"p-button-primary","p-button-sm","p-button-outlined"],["ngbDropdownMenu","","aria-labelledby","dropdownBasic1",1,"dropdown-menu",2,"right","auto !important","left","0 !important"],["ngbDropdownItem","",3,"click"],[1,"pi","pi-print","mr-2"],["dtr2",""],["colspan","6"],["shape","circle"],["appendTo","body","modal","true","header","Items with less quantity available",3,"closable","visible","baseZIndex","visibleChange"],[1,"col-12"],["dt12",""],[4,"ngFor","ngForOf"],[1,"p-o","m-0"],[1,"small"]],template:function(e,i){1&e&&(t.YNc(0,bt,14,11,"div",0),t.YNc(1,ae,7,11,"p-dialog",1),t.YNc(2,fe,4,9,"p-dialog",1),t.TgZ(3,"p-dialog",2),t.NdJ("visibleChange",function(l){return i.showReprintForm=l})("onHide",function(){return i.showReprintForm=!1,i.ngOnInit()}),t.YNc(4,Ae,4,10,"p-table",3),t.TgZ(5,"ngx-spinner",4),t._UZ(6,"p",5),t.qZA()(),t.TgZ(7,"p-dialog",6),t.NdJ("visibleChange",function(l){return i.displayItemsDialog=l})("onHide",function(){return i.displayItemsDialog=!1}),t.TgZ(8,"div",7)(9,"h3",8)(10,"p-button",9),t.NdJ("click",function(){return i.selectReceipt(i.transactionToView,!0,!1,!1)}),t.qZA()(),t.TgZ(11,"div",10),t.YNc(12,we,4,10,"p-table",3),t.qZA()(),t.TgZ(13,"ngx-spinner",4),t._UZ(14,"p",5),t.qZA()(),t.YNc(15,ke,7,16,"p-dialog",11),t.TgZ(16,"p-overlayPanel",12,13),t.YNc(18,Je,3,3,"ng-template",14),t.qZA(),t.TgZ(19,"p-overlayPanel",12,15),t.YNc(21,Oe,3,3,"ng-template",14),t.qZA(),t._UZ(22,"p-confirmDialog",16),t.TgZ(23,"ngx-spinner",17),t._UZ(24,"p",5),t.qZA()),2&e&&(t.Q6J("ngIf",!i.loading),t.xp6(1),t.Q6J("ngIf",i.displayCustomerDialog),t.xp6(1),t.Q6J("ngIf",i.displaySellDialog),t.xp6(1),t.Akn(t.DdM(30,Ye)),t.Q6J("closable",!0)("visible",i.showReprintForm)("baseZIndex",1e4),t.xp6(1),t.Q6J("ngIf",i.showReprintForm),t.xp6(1),t.Q6J("fullScreen",!0),t.xp6(2),t.Akn(t.DdM(31,Ge)),t.Q6J("header",i.displayItemsDialog?i.transactionToView.transaction_code:"")("closable",!0)("visible",i.displayItemsDialog)("baseZIndex",1e4),t.xp6(5),t.Q6J("ngIf",i.displayItemsDialog),t.xp6(1),t.Q6J("fullScreen",!0),t.xp6(2),t.Q6J("ngIf",i.showQuantityError),t.xp6(1),t.Akn(t.DdM(32,j)),t.Q6J("@enter",void 0)("showCloseIcon",!1),t.xp6(3),t.Akn(t.DdM(33,j)),t.Q6J("showCloseIcon",!1),t.xp6(3),t.Akn(t.DdM(34,K)),t.Q6J("baseZIndex",1e4),t.xp6(1),t.Q6J("fullScreen",!0))},dependencies:[d.sg,d.O5,B.Ro,S._Y,S.Fj,S.wV,S.JJ,S.JL,S.Q7,S.c5,S.On,S.F,nt.V,k.$_,k.jx,lt.Q,P.Hq,P.zx,v.iA,v.lQ,v.YL,v.fz,v.D$,v.Pv,v.U1,v.wT,at.o,st.Lt,q.jt,q.iD,q.Vi,q.TH,rt.T,ct.H,_t.q,pt.EU,dt.f,d.JJ,d.rS,d.H9,d.uU],styles:["label[_ngcontent-%COMP%]{text-transform:none}.dropdown[_ngcontent-%COMP%]{z-index:20000!important}.loader[_ngcontent-%COMP%]{width:30px;aspect-ratio:2;--_g: no-repeat radial-gradient(circle closest-side,#02926e 90%,#ffffff);background:var(--_g) 0% 50%,var(--_g) 50% 50%,var(--_g) 100% 50%;background-size:33.3333333333% 50%;animation:l3 1s infinite linear}@keyframes l3{20%{background-position:0% 0%,50% 50%,100% 50%}40%{background-position:0% 100%,50% 0%,100% 50%}60%{background-position:0% 50%,50% 100%,100% 0%}80%{background-position:0% 50%,50% 50%,100% 100%}}[_nghost-%COMP%]     p-colorpicker .p-colorpicker .p-colorpicker-preview{border-radius:30px}[_nghost-%COMP%]     p-dialog .p-dialog-header{border-radius:30px!important}[_nghost-%COMP%]     .p-dialog .p-dialog-footer{border-bottom-right-radius:30px}"],data:{animation:[(0,w.X$)("enter",[(0,w.eR)("void => *",[(0,w.oB)({opacity:0}),(0,w.jt)(1e3,(0,w.oB)({opacity:1}))])])]}}),n})(),data:{title:"Debtor sale"}}];let Ke=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[F.Bz.forChild(He),F.Bz]}),n})();var $e=_(4397);let je=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[Ke,$e.U]}),n})()}}]);