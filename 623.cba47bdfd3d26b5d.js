"use strict";(self.webpackChunkmatngular=self.webpackChunkmatngular||[]).push([[623],{3623:(Vt,M,a)=>{a.r(M),a.d(M,{AllStockModule:()=>Ft});var S=a(3434),U=a(4397),k=a(2318),t=a(4650);const N=[{path:"",component:S.J,data:{title:"Products"}}];let q=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[k.Bz.forChild(N),k.Bz]}),o})();var w=a(1932),x=a(3166),C=a(7185),I=a(9775),_=a(8423),p=a(805),y=a(1927),m=a(6895),l=a(4006),f=a(1493),h=a(5593),g=a(3087),T=a(3942);function E(o,s){1&o&&(t.TgZ(0,"tr",25),t._UZ(1,"th",26),t.TgZ(2,"th"),t._uU(3,"VAT Percent "),t.qZA(),t._UZ(4,"th",27),t.qZA())}function J(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"tr",28),t._UZ(1,"td"),t.TgZ(2,"td"),t._uU(3),t.ALo(4,"number"),t.qZA(),t.TgZ(5,"td")(6,"button",29),t.NdJ("click",function(){const r=t.CHM(i).$implicit,c=t.oxw();return t.KtG(c.confirmDelete(r.id))}),t.qZA()()()}if(2&o){const i=s.$implicit;t.xp6(3),t.hij(" ",t.xi3(4,1,i.vat_percent,".2")," ")}}function Q(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"form",30,31),t.NdJ("ngSubmit",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.addNewItem())}),t.TgZ(2,"div",0)(3,"div",1)(4,"div",32)(5,"div",33)(6,"label",34),t._uU(7,"VAT %"),t.qZA(),t.TgZ(8,"input",35),t.NdJ("ngModelChange",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.newItemModel.vat=n)}),t.qZA()()()()(),t.TgZ(9,"p-footer")(10,"button",36),t.NdJ("click",function(){t.CHM(i);const n=t.oxw();return n.displayNewItemDialog=!1,t.KtG(n.newItemModel.vat=0)}),t.qZA(),t._UZ(11,"button",37),t.qZA()()}if(2&o){const i=t.MAs(1),e=t.oxw();t.xp6(8),t.Q6J("ngModel",e.newItemModel.vat),t.xp6(3),t.Q6J("disabled",!i.valid||e.newItemModel.vat<0)}}function D(o,s){if(1&o&&t._UZ(0,"app-notification",38),2&o){const i=t.oxw();t.Q6J("message","VAT record added!")("showNotification",i.showNotification)}}const P=function(){return[10,25,50]},Y=function(){return["name","description"]},H=function(){return{width:"20vw"}},F=function(){return{width:"30vw"}};let V=(()=>{class o{constructor(i,e,n,r,c,u,d){this.apiSrv=i,this.cryptoSrv=e,this.toastr=n,this.printSrv=r,this.spinner=c,this.confirmationService=u,this.authSrv=d,this.displayNewItemDialog=!1,this.newItemModel={},this.showNotification=!1,this.total_vat=0,this.showVatDialog=!1}ngOnInit(){}confirmDelete(i){this.confirmationService.confirm({message:"Are you sure you want to delete this VAT? Any item containing this VAT will still retain it!",acceptButtonStyleClass:"p-button-primary p-button-sm",rejectButtonStyleClass:"p-button-danger p-button-sm",acceptLabel:"Delete",rejectLabel:"Cancel",accept:()=>{this.delete(i)},reject:()=>{}})}delete(i){this.spinner.show();const e={action:this.cryptoSrv.encodeEncryptText("delete_vat_record"),added_by:this.authSrv.getUserDetailToken("uid"),vid:i};this.apiSrv.post(e).then(n=>{"error"!=n.status?"error2"!=n.status?(this.toastr.success("VAT record deleted"),this.vat_records=this.vat_records.filter(r=>r.id!==i)):(this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):this.toastr.error(n.message),this.spinner.hide()}).catch(n=>{this.toastr.error(n),this.spinner.hide()})}addNewItem(){this.spinner.show("new");const i={action:this.cryptoSrv.encodeEncryptText("add_vat_record"),added_by:this.authSrv.getUserDetailToken("uid"),percent:this.cryptoSrv.encodeEncryptText(this.newItemModel.vat.toString())};this.apiSrv.post(i).then(e=>{"error"!=e.status?"error2"!=e.status?(this.vat_records=e.records,this.showNotification=!0,setTimeout(()=>{this.displayNewItemDialog=!1},1300)):(this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):this.toastr.error(e.message),this.spinner.hide("new")}).catch(e=>{this.toastr.error(e),this.spinner.hide("new")})}showTotalVat(){this.spinner.show();const i={action:this.cryptoSrv.encodeEncryptText("get-stock-vat"),uid:this.authSrv.getUserDetailToken("uid")};this.apiSrv.read(i).then(e=>{"error"!=e.status?"error2"!=e.status?(this.total_vat=e.total,this.showVatDialog=!0):(this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):this.toastr.error(e.message),this.spinner.hide()}).catch(e=>{this.toastr.error(e),this.spinner.hide()})}}return o.\u0275fac=function(i){return new(i||o)(t.Y36(w.s),t.Y36(x.$),t.Y36(C._W),t.Y36(I.$),t.Y36(_.t2),t.Y36(p.YP),t.Y36(y.e))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-vat"]],inputs:{vat_records:"vat_records"},decls:34,vars:32,consts:[[1,"row"],[1,"col-md-12"],["pButton","","type","button","icon","pi pi-dollar","label","Show total stock VAT",1,"p-button-info","p-button-outlined","p-button-sm","mb-2","mt-2",3,"click"],["pButton","","type","button","icon","pi pi-plus","label","Add a new VAT %",1,"p-button-success","p-button-sm","float-right","mb-2","mt-2",3,"click"],["styleClass","p-datatable-customers","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"value","rowHover","rows","showCurrentPageReport","rowsPerPageOptions","paginator","filterDelay","globalFilterFields"],["dt",""],["pTemplate","header"],["pTemplate","body"],["appendTo","body","blockScroll","true","modal","true","transitionOptions","390ms cubic-bezier(0, 0, 0.2, 1)",3,"header","closable","visible","baseZIndex","visibleChange"],["autocomplete","off",3,"ngSubmit",4,"ngIf"],[3,"message","showNotification",4,"ngIf"],["bdOpacity","#fff","name","new","bdColor","rgba(255,255,255,0.76)","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[2,"color","#02926e"],["appendTo","body","modal","true","header","",3,"blockScroll","closable","visible","baseZIndex","visibleChange"],[1,"col-xl-12","col-lg-12","col-12"],[1,"card","card-inverse","bg-info"],[1,"card-content"],[1,"card-body"],[1,"media"],[1,"media-center","align-self-center"],[1,"media-body","text-center"],[1,"card-text"],[2,"font-size","12px"],["type","button","pButton","","icon","pi pi-times","label","Close",1,"p-button-danger","p-button-sm","float-right",3,"click"],["bdOpacity","#fff","bdColor","rgba(255,255,255,0.76)","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[1,"ui-selectable-row"],[2,"width","4rem"],[2,"width","12rem"],[2,"word-wrap","normal"],["pButton","","type","button","icon","pi pi-trash","label","Delete",1,"p-button-danger","p-button-sm","p-button-outlined",3,"click"],["autocomplete","off",3,"ngSubmit"],["form2","ngForm"],[1,"ui-fluid"],[1,"p-field","pb-3"],["for","vat"],["id","vat","name","vat","required","","type","number","min","0","pInputNumber","",1,"form-control",3,"ngModel","ngModelChange"],["type","button","pButton","","icon","pi pi-times","label","Cancel",1,"p-button-danger","p-button-sm","float-right",3,"click"],["type","submit","pButton","","icon","pi pi-check","label","Save",1,"p-button-success","p-button-sm","mr-3","float-right",3,"disabled"],[3,"message","showNotification"]],template:function(i,e){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t.NdJ("click",function(){return e.showTotalVat()}),t.qZA(),t.TgZ(3,"button",3),t.NdJ("click",function(){return e.showNotification=!1,e.displayNewItemDialog=!0}),t.qZA()(),t.TgZ(4,"div",1)(5,"p-table",4,5),t.YNc(7,E,5,0,"ng-template",6),t.YNc(8,J,7,4,"ng-template",7),t.qZA()()(),t.TgZ(9,"p-dialog",8),t.NdJ("visibleChange",function(r){return e.displayNewItemDialog=r}),t.YNc(10,Q,12,2,"form",9),t.YNc(11,D,1,2,"app-notification",10),t.TgZ(12,"ngx-spinner",11),t._UZ(13,"p",12),t.qZA()(),t.TgZ(14,"p-dialog",13),t.NdJ("visibleChange",function(r){return e.showVatDialog=r}),t.TgZ(15,"div",0)(16,"div",14)(17,"div",15)(18,"div",16)(19,"div",17)(20,"div",18),t._UZ(21,"div",19),t.TgZ(22,"div",20)(23,"h3",21)(24,"span",22),t._uU(25,"Ksh"),t.qZA(),t._uU(26),t.ALo(27,"number"),t.qZA(),t.TgZ(28,"span"),t._uU(29,"Total stock VAT"),t.qZA()()()()()()()(),t.TgZ(30,"p-footer")(31,"button",23),t.NdJ("click",function(){return e.showVatDialog=!1}),t.qZA()()(),t.TgZ(32,"ngx-spinner",24),t._UZ(33,"p",12),t.qZA()),2&i&&(t.xp6(5),t.Q6J("value",e.vat_records)("rowHover",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",t.DdM(28,P))("paginator",!0)("filterDelay",0)("globalFilterFields",t.DdM(29,Y)),t.xp6(4),t.Akn(t.DdM(30,H)),t.s9C("header",e.showNotification?"":"New VAT %"),t.Q6J("closable",!1)("visible",e.displayNewItemDialog)("baseZIndex",1e4),t.xp6(1),t.Q6J("ngIf",!e.showNotification),t.xp6(1),t.Q6J("ngIf",e.showNotification),t.xp6(1),t.Q6J("fullScreen",!1),t.xp6(2),t.Akn(t.DdM(31,F)),t.Q6J("blockScroll",!0)("closable",!1)("visible",e.showVatDialog)("baseZIndex",1e4),t.xp6(12),t.hij(" ",t.xi3(27,25,e.total_vat,".2")," "),t.xp6(6),t.Q6J("fullScreen",!0))},dependencies:[m.O5,_.Ro,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.Q7,l.qQ,l.On,l.F,f.V,p.$_,p.jx,h.Hq,g.iA,T.c,m.JJ]}),o})();var Z=a(1740),v=a(2435);const G=["op"];function K(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"tr",16)(1,"th"),t._uU(2,"Category "),t.qZA(),t._UZ(3,"th",17),t.qZA(),t.TgZ(4,"tr")(5,"th")(6,"input",18),t.NdJ("input",function(n){t.CHM(i),t.oxw();const r=t.MAs(5);return t.KtG(r.filter(n.target.value,"name","contains"))}),t.qZA()(),t._UZ(7,"th"),t.qZA()}}function O(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"tr",19)(1,"td"),t._uU(2),t.ALo(3,"titlecase"),t.qZA(),t.TgZ(4,"td")(5,"button",20),t.NdJ("click",function(n){const c=t.CHM(i).$implicit,u=t.oxw();return t.KtG(u.showEdit(c,n))}),t.qZA(),t.TgZ(6,"button",21),t.NdJ("click",function(){const r=t.CHM(i).$implicit,c=t.oxw();return t.KtG(c.confirmDelete(r.id))}),t.qZA()()()}if(2&o){const i=s.$implicit;t.xp6(2),t.hij(" ",t.lcZ(3,1,i.name)," ")}}function L(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"form",22,23),t.NdJ("ngSubmit",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.addNewItem())}),t.TgZ(2,"div",0)(3,"div",1)(4,"div",24)(5,"div",25)(6,"label",26),t._uU(7,"Category name"),t.qZA(),t.TgZ(8,"input",27),t.NdJ("ngModelChange",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.newItemModel.name=n)}),t.qZA()()()()(),t.TgZ(9,"p-footer")(10,"button",28),t.NdJ("click",function(){t.CHM(i);const n=t.oxw();return n.displayNewItemDialog=!1,t.KtG(n.newItemModel.name="")}),t.qZA(),t._UZ(11,"button",29),t.qZA()()}if(2&o){const i=t.MAs(1),e=t.oxw();t.xp6(8),t.Q6J("ngModel",e.newItemModel.name),t.xp6(3),t.Q6J("disabled",!i.valid||""==e.newItemModel.name)}}function B(o,s){if(1&o&&t._UZ(0,"app-notification",30),2&o){const i=t.oxw();t.Q6J("message","Category added!")("showNotification",i.showNotification)}}function j(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"form",22,23),t.NdJ("ngSubmit",function(){t.CHM(i);const n=t.oxw(2);return t.KtG(n.updateItem())}),t.TgZ(2,"div",0)(3,"div",1)(4,"div",24)(5,"div",25)(6,"label",26),t._uU(7,"Cageory name"),t.qZA(),t.TgZ(8,"input",32),t.NdJ("ngModelChange",function(n){t.CHM(i);const r=t.oxw(2);return t.KtG(r.categoryToView.name=n)}),t.qZA()()()(),t.TgZ(9,"div",1)(10,"button",28),t.NdJ("click",function(){t.CHM(i);const n=t.oxw(2);return t.KtG(n.hideEdit())}),t.qZA(),t._UZ(11,"button",29),t.qZA()()()}if(2&o){const i=t.MAs(1),e=t.oxw(2);t.xp6(8),t.Q6J("ngModel",e.categoryToView.name),t.xp6(3),t.Q6J("disabled",!i.valid||""==e.categoryToView.name)}}function R(o,s){if(1&o&&t._UZ(0,"app-notification",30),2&o){const i=t.oxw(2);t.Q6J("message","Category updated!")("showNotification",i.showNotification)}}function z(o,s){if(1&o&&(t.YNc(0,j,12,2,"form",8),t.YNc(1,R,1,2,"app-notification",9),t.TgZ(2,"ngx-spinner",31),t._UZ(3,"p",11),t.qZA()),2&o){const i=t.oxw();t.Q6J("ngIf",!i.showNotification),t.xp6(1),t.Q6J("ngIf",i.showNotification),t.xp6(1),t.Q6J("fullScreen",!1)}}const $=function(){return[10,25,50]},W=function(){return["name","description"]},X=function(){return{width:"20vw"}},tt=function(){return{width:"350px"}};let et=(()=>{class o{constructor(i,e,n,r,c,u,d){this.apiSrv=i,this.cryptoSrv=e,this.toastr=n,this.printSrv=r,this.spinner=c,this.confirmationService=u,this.authSrv=d,this.displayNewItemDialog=!1,this.newItemModel={},this.categoryToView={},this.categoryToViewDefault={},this.showNotification=!1}ngOnInit(){}confirmDelete(i){this.confirmationService.confirm({message:"Are you sure you want to delete this category? Any items grouped under this category will have no category!",acceptButtonStyleClass:"p-button-primary p-button-sm",rejectButtonStyleClass:"p-button-danger p-button-sm",acceptLabel:"Delete",rejectLabel:"Cancel",accept:()=>{this.delete(i)},reject:()=>{}})}delete(i){this.spinner.show();const e={action:this.cryptoSrv.encodeEncryptText("delete_category"),added_by:this.authSrv.getUserDetailToken("uid"),category:i};this.apiSrv.post(e).then(n=>{"error"!=n.status?"error2"!=n.status?(this.toastr.success("Category deleted"),this.categories=n.records):(this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):this.toastr.error(n.message),this.spinner.hide()}).catch(n=>{this.toastr.error(n),this.spinner.hide()})}addNewItem(){this.spinner.show("new");const i={action:this.cryptoSrv.encodeEncryptText("add_category"),added_by:this.authSrv.getUserDetailToken("uid"),category:this.cryptoSrv.encodeEncryptText(this.newItemModel.name)};this.apiSrv.post(i).then(e=>{"error"!=e.status?"error2"!=e.status?(this.showNotification=!0,setTimeout(()=>{this.displayNewItemDialog=!1},1300),this.categories=e.records,this.newItemModel.name=""):(this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):this.toastr.error(e.message),this.spinner.hide("new")}).catch(e=>{this.toastr.error(e),this.spinner.hide("new")})}showEdit(i,e){this.categoryToView=i,this.categoryToViewDefault=this.apiSrv.deepCopy(i),this.showNotification=!1,this.overlay.toggle(e)}hideEdit(){const i=this.categories.find(({id:n})=>n===this.categoryToView.id),e=this.categories.indexOf(i);this.categories[e]=this.categoryToViewDefault,this.overlay.hide()}updateItem(){this.spinner.show("edit");const i={action:this.cryptoSrv.encodeEncryptText("update_category"),added_by:this.authSrv.getUserDetailToken("uid"),id:this.categoryToView.id,category:this.cryptoSrv.encodeEncryptText(this.categoryToView.name)};this.apiSrv.post(i).then(e=>{"error"!=e.status?"error2"!=e.status?(this.showNotification=!0,setTimeout(()=>{this.overlay.hide()},1300),this.newItemModel.name=""):(this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):this.toastr.error(e.message),this.spinner.hide("edit")}).catch(e=>{this.toastr.error(e),this.spinner.hide("new")})}}return o.\u0275fac=function(i){return new(i||o)(t.Y36(w.s),t.Y36(x.$),t.Y36(C._W),t.Y36(I.$),t.Y36(_.t2),t.Y36(p.YP),t.Y36(y.e))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-stock-categories"]],viewQuery:function(i,e){if(1&i&&t.Gf(G,5),2&i){let n;t.iGM(n=t.CRH())&&(e.overlay=n.first)}},inputs:{categories:"categories"},decls:18,vars:25,consts:[[1,"row"],[1,"col-md-12"],["pButton","","type","button","icon","pi pi-plus","label","Add a new category",1,"p-button-success","p-button-sm","float-right","mb-2",3,"click"],["styleClass","p-datatable-customers","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"value","rowHover","rows","showCurrentPageReport","rowsPerPageOptions","paginator","filterDelay","globalFilterFields"],["dt",""],["pTemplate","header"],["pTemplate","body"],["appendTo","body","blockScroll","true","modal","true","transitionOptions","390ms cubic-bezier(0, 0, 0.2, 1)",3,"header","closable","visible","baseZIndex","visibleChange"],["autocomplete","off",3,"ngSubmit",4,"ngIf"],[3,"message","showNotification",4,"ngIf"],["bdOpacity","#fff","name","new","bdColor","rgba(255,255,255,0.76)","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[2,"color","#02926e"],[3,"showCloseIcon"],["op",""],["pTemplate",""],["bdOpacity","#fff","name","","bdColor","rgba(255,255,255,0.76)","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[1,"ui-selectable-row"],[2,"width","20rem"],["pInputText","","type","text","placeholder","Search...",1,"ui-column-filter",3,"input"],[2,"word-wrap","normal"],["pButton","","type","button","icon","pi pi-pencil","label","Edit",1,"p-button-success","p-button-sm","mr-2","p-button-outlined",3,"click"],["pButton","","type","button","icon","pi pi-trash","label","Delete",1,"p-button-danger","p-button-sm","p-button-outlined",3,"click"],["autocomplete","off",3,"ngSubmit"],["form2","ngForm"],[1,"ui-fluid"],[1,"p-field","pb-3"],["for","vat"],["id","vat","name","vat","required","","type","text","pInputText","",1,"form-control",3,"ngModel","ngModelChange"],["type","button","pButton","","icon","pi pi-times","label","Cancel",1,"p-button-danger","p-button-sm","float-right",3,"click"],["type","submit","pButton","","icon","pi pi-check","label","Save",1,"p-button-success","p-button-sm","mr-3","float-right",3,"disabled"],[3,"message","showNotification"],["bdOpacity","#fff","name","edit","bdColor","rgba(255,255,255,0.76)","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],["id","name","name","name","required","","type","text","pInputText","",1,"form-control",3,"ngModel","ngModelChange"]],template:function(i,e){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t.NdJ("click",function(){return e.showNotification=!1,e.displayNewItemDialog=!0}),t.qZA()(),t.TgZ(3,"div",1)(4,"p-table",3,4),t.YNc(6,K,8,0,"ng-template",5),t.YNc(7,O,7,3,"ng-template",6),t.qZA()()(),t.TgZ(8,"p-dialog",7),t.NdJ("visibleChange",function(r){return e.displayNewItemDialog=r}),t.YNc(9,L,12,2,"form",8),t.YNc(10,B,1,2,"app-notification",9),t.TgZ(11,"ngx-spinner",10),t._UZ(12,"p",11),t.qZA()(),t.TgZ(13,"p-overlayPanel",12,13),t.YNc(15,z,4,3,"ng-template",14),t.qZA(),t.TgZ(16,"ngx-spinner",15),t._UZ(17,"p",11),t.qZA()),2&i&&(t.xp6(4),t.Q6J("value",e.categories)("rowHover",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",t.DdM(21,$))("paginator",!0)("filterDelay",0)("globalFilterFields",t.DdM(22,W)),t.xp6(4),t.Akn(t.DdM(23,X)),t.s9C("header",e.showNotification?"":"New category"),t.Q6J("closable",!1)("visible",e.displayNewItemDialog)("baseZIndex",1e4),t.xp6(1),t.Q6J("ngIf",!e.showNotification),t.xp6(1),t.Q6J("ngIf",e.showNotification),t.xp6(1),t.Q6J("fullScreen",!1),t.xp6(2),t.Akn(t.DdM(24,tt)),t.Q6J("showCloseIcon",!1),t.xp6(3),t.Q6J("fullScreen",!0))},dependencies:[m.O5,_.Ro,l._Y,l.Fj,l.JJ,l.JL,l.Q7,l.On,l.F,f.V,p.$_,p.jx,h.Hq,g.iA,Z.o,v.T,T.c,m.rS]}),o})();var it=a(2137),nt=a(5722),ot=a(666),rt=a(605),b=a(9091),st=a(8558),lt=a(8271),at=a(613),ct=a(4920);const pt=["op"];function mt(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"button",19),t.NdJ("click",function(){t.CHM(i);const n=t.oxw(2);return n.showNotification=!1,t.KtG(n.displayNewItemDialog=!0)}),t.qZA()}}function ut(o,s){if(1&o&&(t.TgZ(0,"tr",16)(1,"th"),t._uU(2,"Unit name"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Number of pieces "),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Buying price "),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Recommended Sell price "),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Minimum Sell price "),t.qZA(),t.TgZ(11,"th"),t._uU(12,"Profit markup % "),t.qZA(),t.TgZ(13,"th",17),t.YNc(14,mt,1,0,"button",18),t.qZA()()),2&o){const i=t.oxw();t.xp6(14),t.Q6J("ngIf",i.userIsAdmin)}}function _t(o,s){1&o&&(t.TgZ(0,"small",24),t._uU(1," Selling price low "),t.qZA())}function dt(o,s){1&o&&(t.TgZ(0,"small",24),t._uU(1," Selling price low "),t.qZA())}function gt(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(n){t.CHM(i);const r=t.oxw().$implicit,c=t.oxw();return t.KtG(c.showEdit(r,n))}),t.qZA()}}function ht(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){t.CHM(i);const n=t.oxw().$implicit,r=t.oxw();return t.KtG(r.confirmDelete(n))}),t.qZA()}}function ft(o,s){if(1&o&&(t.TgZ(0,"tr",20)(1,"td"),t._uU(2),t.ALo(3,"titlecase"),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.ALo(6,"number"),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.ALo(9,"number"),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.ALo(12,"number"),t._UZ(13,"br"),t.YNc(14,_t,2,0,"small",21),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.ALo(17,"number"),t._UZ(18,"br"),t.YNc(19,dt,2,0,"small",21),t.qZA(),t.TgZ(20,"td"),t._uU(21),t.ALo(22,"number"),t.qZA(),t.TgZ(23,"td"),t.YNc(24,gt,1,0,"button",22),t.YNc(25,ht,1,0,"button",23),t.qZA()()),2&o){const i=s.$implicit,e=t.oxw();t.xp6(2),t.hij(" ",t.lcZ(3,10,i.unit_name)," "),t.xp6(3),t.hij(" ",t.xi3(6,12,i.unit_quantity,".2")," "),t.xp6(3),t.hij(" ",t.xi3(9,15,i.unit_quantity*e.buying_price,".2")," "),t.xp6(3),t.hij(" ",t.xi3(12,18,i.recom_selling_price,".2")," "),t.xp6(3),t.Q6J("ngIf",i.recom_selling_price<i.unit_quantity*e.buying_price),t.xp6(2),t.hij(" ",t.xi3(17,21,i.min_selling_price,".2")," "),t.xp6(3),t.Q6J("ngIf",i.min_selling_price<i.unit_quantity*e.buying_price),t.xp6(2),t.hij(" ",t.xi3(22,24,i.markup,".2")," "),t.xp6(3),t.Q6J("ngIf",e.userCanManageStock||e.userIsAdmin),t.xp6(1),t.Q6J("ngIf",e.userIsAdmin)}}function Tt(o,s){1&o&&(t.TgZ(0,"small",44),t._uU(1," Markup cannot be below zero "),t.qZA())}function bt(o,s){1&o&&(t.TgZ(0,"small",44),t._uU(1," Markup cannot be below zero "),t.qZA())}function wt(o,s){1&o&&(t.TgZ(0,"small",44),t._uU(1," Minimum price cannot be lower than buying price "),t.qZA())}function xt(o,s){1&o&&(t.TgZ(0,"small",44),t._uU(1," Minimum price cannot be higher than recommended price "),t.qZA())}function Ct(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"form",27,28),t.NdJ("ngSubmit",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.confirm())}),t.TgZ(2,"div",0)(3,"div",1)(4,"div",29)(5,"div",30)(6,"label",31),t._uU(7,"Unit name"),t.qZA(),t.TgZ(8,"input",32),t.NdJ("ngModelChange",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.newItemModel.name=n)}),t.qZA()()(),t.TgZ(9,"div",29)(10,"div",30)(11,"label",31),t._uU(12,"Number of pieces"),t.qZA(),t.TgZ(13,"input",33),t.NdJ("ngModelChange",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.newItemModel.pieces=n)}),t.qZA()()(),t.TgZ(14,"div",29)(15,"div",30)(16,"label",31),t._uU(17,"Unit buying price"),t.qZA(),t._UZ(18,"input",34),t.ALo(19,"number"),t.qZA()(),t.TgZ(20,"div",29)(21,"div",30)(22,"label",35),t._uU(23,"Selling markup %"),t.qZA(),t.TgZ(24,"input",36),t.NdJ("input",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.calculatePricesNew())})("ngModelChange",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.newItemModel.markup=n)}),t.qZA(),t.YNc(25,Tt,2,0,"small",37),t.qZA()(),t.TgZ(26,"div",29)(27,"div",30)(28,"label",38),t._uU(29,"Minimum markup %"),t.qZA(),t.TgZ(30,"input",39),t.NdJ("input",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.calculatePricesNew())})("ngModelChange",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.newItemModel.markup_discount=n)}),t.qZA(),t.YNc(31,bt,2,0,"small",37),t.qZA()(),t.TgZ(32,"div",29)(33,"div",30)(34,"label",31),t._uU(35,"Recommended selling price"),t.qZA(),t.TgZ(36,"input",40),t.NdJ("input",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.calculateMarkupNew())})("ngModelChange",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.newItemModel.recom_price=n)}),t.qZA()()(),t.TgZ(37,"div",29)(38,"div",30)(39,"label",31),t._uU(40,"Minimum selling price"),t.qZA(),t.TgZ(41,"input",41),t.NdJ("input",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.calculateMarkupNew())})("ngModelChange",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.newItemModel.min_price=n)}),t.qZA(),t.YNc(42,wt,2,0,"small",37),t.YNc(43,xt,2,0,"small",37),t.qZA()()()(),t.TgZ(44,"p-footer")(45,"button",42),t.NdJ("click",function(){t.CHM(i);const n=t.oxw();return n.displayNewItemDialog=!1,t.KtG(n.newItemModel={})}),t.qZA(),t._UZ(46,"button",43),t.qZA()()}if(2&o){const i=t.MAs(1),e=t.oxw();t.xp6(8),t.Q6J("ngModel",e.newItemModel.name),t.xp6(5),t.Q6J("ngModel",e.newItemModel.pieces),t.xp6(5),t.Q6J("value",t.xi3(19,12,e.getTotalPrice(),".2")),t.xp6(6),t.Q6J("ngModel",e.newItemModel.markup),t.xp6(1),t.Q6J("ngIf",e.newItemModel.markup<0),t.xp6(5),t.Q6J("ngModel",e.newItemModel.markup_discount),t.xp6(1),t.Q6J("ngIf",e.newItemModel.markup_discount<0),t.xp6(5),t.Q6J("ngModel",e.newItemModel.recom_price),t.xp6(5),t.Q6J("ngModel",e.newItemModel.min_price),t.xp6(1),t.Q6J("ngIf",e.newItemModel.min_price<e.getTotalPrice()),t.xp6(1),t.Q6J("ngIf",e.newItemModel.min_price>e.newItemModel.recom_price),t.xp6(3),t.Q6J("disabled",!i.valid||""==e.newItemModel.name||e.newItemModel.min_price>e.newItemModel.recom_price||e.newItemModel.min_price<e.getTotalPrice()||e.newItemModel.min_price>e.newItemModel.recom_price)}}function yt(o,s){if(1&o&&t._UZ(0,"app-notification",45),2&o){const i=t.oxw();t.Q6J("message","Unit added!")("showNotification",i.showNotification)}}function Zt(o,s){1&o&&(t.TgZ(0,"small",44),t._uU(1," Markup cannot be below zero "),t.qZA())}function vt(o,s){1&o&&(t.TgZ(0,"small",44),t._uU(1," Markup cannot be below zero "),t.qZA())}function Mt(o,s){1&o&&(t.TgZ(0,"small",44),t._uU(1," Selling price cannot be lower than buying price "),t.qZA())}function St(o,s){1&o&&(t.TgZ(0,"small",44),t._uU(1," Minimum price cannot be lower than buying price "),t.qZA())}function kt(o,s){1&o&&(t.TgZ(0,"small",44),t._uU(1," Minimum price cannot be higher than recommended price "),t.qZA())}function It(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"form",27,28),t.NdJ("ngSubmit",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.updateItem())}),t.TgZ(2,"div",0)(3,"div",1)(4,"div",29)(5,"div",30)(6,"label",31),t._uU(7,"Unit name"),t.qZA(),t.TgZ(8,"input",46),t.NdJ("ngModelChange",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.itemToEdit.unit_name=n)}),t.qZA()()(),t.TgZ(9,"div",29)(10,"div",30)(11,"label",31),t._uU(12,"Number of pieces"),t.qZA(),t.TgZ(13,"input",47),t.NdJ("input",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.getTotalPrice2())})("ngModelChange",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.itemToEdit.unit_quantity=n)}),t.qZA()()(),t.TgZ(14,"div",29)(15,"div",30)(16,"label",31),t._uU(17,"Unit buying price"),t.qZA(),t._UZ(18,"input",34),t.ALo(19,"number"),t.qZA()(),t.TgZ(20,"div",29)(21,"div",30)(22,"label",35),t._uU(23,"Selling markup %"),t.qZA(),t.TgZ(24,"input",36),t.NdJ("input",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.calculatePrices())})("ngModelChange",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.itemToEdit.markup=n)}),t.qZA(),t.YNc(25,Zt,2,0,"small",37),t.qZA()(),t.TgZ(26,"div",29)(27,"div",30)(28,"label",38),t._uU(29,"Minimum markup %"),t.qZA(),t.TgZ(30,"input",39),t.NdJ("input",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.calculatePrices())})("ngModelChange",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.itemToEdit.markup_discount=n)}),t.qZA(),t.YNc(31,vt,2,0,"small",37),t.qZA()(),t.TgZ(32,"div",29)(33,"div",30)(34,"label",31),t._uU(35,"Recommended selling price"),t.qZA(),t.TgZ(36,"input",40),t.NdJ("input",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.calculateMarkup())})("ngModelChange",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.itemToEdit.recom_selling_price=n)}),t.qZA(),t.YNc(37,Mt,2,0,"small",37),t.qZA()(),t.TgZ(38,"div",29)(39,"div",30)(40,"label",31),t._uU(41,"Minimum selling price"),t.qZA(),t.TgZ(42,"input",41),t.NdJ("input",function(){t.CHM(i);const n=t.oxw();return t.KtG(n.calculateMarkup())})("ngModelChange",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.itemToEdit.min_selling_price=n)}),t.qZA(),t.YNc(43,St,2,0,"small",37),t.YNc(44,kt,2,0,"small",37),t.qZA()()(),t.TgZ(45,"div",1)(46,"button",42),t.NdJ("click",function(n){t.CHM(i);const r=t.oxw();return t.KtG(r.hideEdit(n))}),t.qZA(),t._UZ(47,"button",43),t.qZA()()()}if(2&o){const i=t.MAs(1),e=t.oxw();t.xp6(8),t.Q6J("disabled",!e.userIsAdmin)("ngModel",e.itemToEdit.unit_name),t.xp6(5),t.Q6J("disabled",!e.userIsAdmin)("ngModel",e.itemToEdit.unit_quantity),t.xp6(5),t.Q6J("value",t.xi3(19,15,e.itemToEdit.buying_price,".2")),t.xp6(6),t.Q6J("ngModel",e.itemToEdit.markup),t.xp6(1),t.Q6J("ngIf",e.itemToEdit.markup<0),t.xp6(5),t.Q6J("ngModel",e.itemToEdit.markup_discount),t.xp6(1),t.Q6J("ngIf",e.itemToEdit.markup_discount<0),t.xp6(5),t.Q6J("ngModel",e.itemToEdit.recom_selling_price),t.xp6(1),t.Q6J("ngIf",e.itemToEdit.recom_selling_price<e.itemToEdit.buying_price),t.xp6(5),t.Q6J("ngModel",e.itemToEdit.min_selling_price),t.xp6(1),t.Q6J("ngIf",e.itemToEdit.min_selling_price<e.itemToEdit.buying_price),t.xp6(1),t.Q6J("ngIf",e.itemToEdit.min_selling_price>e.itemToEdit.recom_selling_price),t.xp6(3),t.Q6J("disabled",!i.valid||e.itemToEdit.recom_selling_price<e.getTotalPrice2()||e.itemToEdit.min_selling_price<e.getTotalPrice2()||e.itemToEdit.min_selling_price>e.itemToEdit.recom_selling_price)}}function At(o,s){if(1&o&&t._UZ(0,"app-notification",45),2&o){const i=t.oxw();t.Q6J("message","Unit updated!")("showNotification",i.showNotification)}}function Ut(o,s){1&o&&(t.TgZ(0,"small",44),t._uU(1," Selling price cannot be lower than buying price "),t.qZA())}function Nt(o,s){1&o&&(t.TgZ(0,"small",44),t._uU(1," Minimum price cannot be lower than buying price "),t.qZA())}function qt(o,s){1&o&&(t.TgZ(0,"small",44),t._uU(1," Minimum price cannot be higher than recommended price "),t.qZA())}function Et(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"form",27,28),t.NdJ("ngSubmit",function(){t.CHM(i);const n=t.oxw(2);return t.KtG(n.updateItem())}),t.TgZ(2,"div",0)(3,"div",1)(4,"div",29)(5,"div",30)(6,"label",31),t._uU(7,"Unit name"),t.qZA(),t.TgZ(8,"input",48),t.NdJ("ngModelChange",function(n){t.CHM(i);const r=t.oxw(2);return t.KtG(r.itemToEdit.unit_name=n)}),t.qZA()()(),t.TgZ(9,"div",29)(10,"div",30)(11,"label",31),t._uU(12,"Number of pieces"),t.qZA(),t.TgZ(13,"input",33),t.NdJ("ngModelChange",function(n){t.CHM(i);const r=t.oxw(2);return t.KtG(r.itemToEdit.unit_quantity=n)}),t.qZA()()(),t.TgZ(14,"div",29)(15,"div",30)(16,"label",31),t._uU(17,"Unit buying price"),t.qZA(),t._UZ(18,"input",34),t.ALo(19,"number"),t.qZA()(),t.TgZ(20,"div",29)(21,"div",30)(22,"label",31),t._uU(23,"Recommended selling price"),t.qZA(),t.TgZ(24,"input",49),t.NdJ("ngModelChange",function(n){t.CHM(i);const r=t.oxw(2);return t.KtG(r.itemToEdit.recom_selling_price=n)}),t.qZA(),t.YNc(25,Ut,2,0,"small",37),t.qZA()(),t.TgZ(26,"div",29)(27,"div",30)(28,"label",31),t._uU(29,"Minimum selling price"),t.qZA(),t.TgZ(30,"input",50),t.NdJ("ngModelChange",function(n){t.CHM(i);const r=t.oxw(2);return t.KtG(r.itemToEdit.min_selling_price=n)}),t.qZA(),t.YNc(31,Nt,2,0,"small",37),t.YNc(32,qt,2,0,"small",37),t.qZA()()(),t.TgZ(33,"div",1)(34,"button",42),t.NdJ("click",function(n){t.CHM(i);const r=t.oxw(2);return t.KtG(r.hideEdit(n))}),t.qZA(),t._UZ(35,"button",43),t.qZA()()()}if(2&o){const i=t.MAs(1),e=t.oxw(2);t.xp6(8),t.Q6J("ngModel",e.itemToEdit.unit_name),t.xp6(5),t.Q6J("ngModel",e.itemToEdit.unit_quantity),t.xp6(5),t.Q6J("value",t.xi3(19,9,e.getTotalPrice2(),".2")),t.xp6(6),t.Q6J("ngModel",e.itemToEdit.recom_selling_price),t.xp6(1),t.Q6J("ngIf",e.itemToEdit.recom_selling_price<e.getTotalPrice2()),t.xp6(5),t.Q6J("ngModel",e.itemToEdit.min_selling_price),t.xp6(1),t.Q6J("ngIf",e.itemToEdit.min_selling_price<e.getTotalPrice2()),t.xp6(1),t.Q6J("ngIf",e.itemToEdit.min_selling_price>e.itemToEdit.recom_selling_price),t.xp6(3),t.Q6J("disabled",!i.valid||""==e.itemToEdit.name||e.itemToEdit.recom_selling_price<e.getTotalPrice2()||e.itemToEdit.min_selling_price<e.getTotalPrice2()||e.itemToEdit.min_selling_price>e.itemToEdit.recom_selling_price)}}function Jt(o,s){if(1&o&&t._UZ(0,"app-notification",45),2&o){const i=t.oxw(2);t.Q6J("message","Unit updated!")("showNotification",i.showNotification)}}function Qt(o,s){if(1&o&&(t.YNc(0,Et,36,12,"form",7),t.YNc(1,Jt,1,2,"app-notification",8),t.TgZ(2,"ngx-spinner",11),t._UZ(3,"p",10),t.qZA()),2&o){const i=t.oxw();t.Q6J("ngIf",!i.showNotification),t.xp6(1),t.Q6J("ngIf",i.showNotification),t.xp6(1),t.Q6J("fullScreen",!1)}}const Dt=function(){return[10,25,50]},Pt=function(){return["name","description"]},A=function(){return{width:"30vw"}},Yt=function(){return{width:"350px"}};let Ht=(()=>{class o{constructor(i,e,n,r,c,u,d){this.apiSrv=i,this.cryptoSrv=e,this.toastr=n,this.spinner=r,this.confirmationService=c,this.authSrv=u,this.cdr=d,this.priceUpdated=new t.vpe,this.displayNewItemDialog=!1,this.newItemModel={},this.displayEditItemDialog=!1,this.itemToEdit={},this.itemToEditDefault={},this.showNotification=!1,this.userIsAdmin=!1,this.userCanManageStock=!1}ngOnInit(){"admin"===this.cryptoSrv.decryptEncodedText(this.authSrv.getUserDetailToken("role"))&&(this.userIsAdmin=!0),"1"===this.cryptoSrv.decryptEncodedText(this.authSrv.getRoleToken("manage_stock"))&&(this.userCanManageStock=!0),this.units&&this.units.forEach(i=>{i.min_price_ok=!(i.min_selling_price<i.unit_quantity*this.buying_price),i.recom_price_ok=!(i.recom_selling_price<i.unit_quantity*this.buying_price)})}confirm(){this.totalQty>0?this.confirmationService.confirm({message:"Stock unit quantity for this item might be affected. Please adjust the quantity after adding this unit.",acceptButtonStyleClass:"p-button-primary p-button-sm",acceptLabel:"Okay",rejectVisible:!1,accept:()=>{this.addNewItem()}}):this.addNewItem()}calculatePricesNew(){this.newItemModel.markup>0&&(this.newItemModel.recom_price=parseFloat((this.getTotalPrice()*(1+this.newItemModel.markup/100)).toFixed(0)),this.newItemModel.min_price=this.newItemModel.markup_discount>0?parseFloat((this.getTotalPrice()*(1+this.newItemModel.markup_discount/100)).toFixed(0)):this.newItemModel.recom_price)}calculateMarkupNew(){if(this.newItemModel.recom_price>0&&this.newItemModel.recom_price>=this.getTotalPrice()){let e=(this.newItemModel.recom_price-this.getTotalPrice())/this.getTotalPrice()*100;if(this.newItemModel.markup=parseFloat(e.toFixed(2)),this.newItemModel.min_price>0&&this.newItemModel.min_price>=this.getTotalPrice()&&this.newItemModel.min_price<=this.newItemModel.recom_price){let r=(this.newItemModel.min_price-this.getTotalPrice())/this.getTotalPrice()*100;this.newItemModel.markup_discount=parseFloat(r.toFixed(2))}}}addNewItem(){this.spinner.show("new"),this.newItemModel.min_price_per_piece=this.newItemModel.min_price/this.newItemModel.pieces,this.newItemModel.recom_price_per_piece=this.newItemModel.recom_price/this.newItemModel.pieces;const i={action:this.cryptoSrv.encodeEncryptText("add_item_selling_unit"),item_id:this.item_id,unit:this.cryptoSrv.encodeEncryptText(this.newItemModel.name),unit_quantity:this.cryptoSrv.encodeEncryptText(this.newItemModel.pieces.toString()),unit_min_selling_price:this.cryptoSrv.encodeEncryptText(this.newItemModel.min_price.toString()),unit_recom_selling_price:this.cryptoSrv.encodeEncryptText(this.newItemModel.recom_price.toString()),markup:this.cryptoSrv.encodeEncryptText(this.newItemModel.markup.toString()),markup_discount:this.cryptoSrv.encodeEncryptText(this.newItemModel.markup_discount.toString()),added_by:this.authSrv.getUserDetailToken("uid")};this.apiSrv.post(i).then(e=>{if("error"!=e.status)if("error2"!=e.status){const n=new Date;this.newItemModel.min_price_ok=!(this.newItemModel.min_price<this.newItemModel.pieces*this.buying_price),this.newItemModel.recom_price_ok=!(this.newItemModel.recom_price<this.newItemModel.pieces*this.buying_price),this.units.push({id:e.id,unit_name:this.newItemModel.name,unit_quantity:this.newItemModel.pieces,min_selling_price:this.newItemModel.min_price,recom_selling_price:this.newItemModel.recom_price,min_price_ok:this.newItemModel.min_price_ok,recom_price_ok:this.newItemModel.recom_price_ok,date_created:n}),this.units=this.units.sort((u,d)=>d.unit_quantity-u.unit_quantity),this.spinner.hide("new"),this.newItemModel={},this.showNotification=!0,setTimeout(()=>{this.displayNewItemDialog=!1},1500)}else this.spinner.hide("new"),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout();else this.spinner.hide("new"),this.toastr.error(e.message)}).catch(e=>{this.toastr.error(e),this.spinner.hide("new")})}getTotalPrice(){return this.newItemModel.pieces?this.newItemModel.pieces*this.buying_price:0}confirmDelete(i){this.confirmationService.confirm({message:"Are you sure you want to delete this unit? Any previous sale made in this unit will still retain it!",acceptButtonStyleClass:"p-button-primary p-button-sm",rejectButtonStyleClass:"p-button-danger p-button-sm",acceptLabel:"Delete",rejectLabel:"Cancel",accept:()=>{this.delete(i)},reject:()=>{}})}delete(i){this.spinner.show();const e={action:this.cryptoSrv.encodeEncryptText("delete_item_selling_unit"),added_by:this.authSrv.getUserDetailToken("uid"),unit:i.id,unit_name:this.cryptoSrv.encodeEncryptText(i.unit_name),itid:this.item_id};this.apiSrv.post(e).then(n=>{"error"!=n.status?"error2"!=n.status?(this.toastr.success("Unit deleted!"),this.units=this.units.filter(r=>r.id!=i.id),this.spinner.hide()):(this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout(),this.spinner.hide()):(this.toastr.error(n.message),this.spinner.hide())}).catch(n=>{this.toastr.error(n),this.spinner.hide()})}showEdit(i,e){this.itemToEdit=i,this.itemToEditDefault=this.apiSrv.deepCopy(i),this.showNotification=!1,this.displayEditItemDialog=!0,this.itemToEdit.unit_quantity=parseInt(this.itemToEdit.unit_quantity.toString()),this.itemToEdit.buying_price=this.itemToEdit.unit_quantity?this.itemToEdit.unit_quantity*this.buying_price:0,0==parseFloat(this.itemToEdit.markup.toString())&&this.calculateMarkup()}calculatePrices(){this.itemToEdit.markup>0&&(this.itemToEdit.recom_selling_price=parseFloat((this.itemToEdit.buying_price*(1+this.itemToEdit.markup/100)).toFixed(0)),this.itemToEdit.min_selling_price=this.itemToEdit.markup_discount>0?parseFloat((this.itemToEdit.buying_price*(1+this.itemToEdit.markup_discount/100)).toFixed(0)):this.itemToEdit.recom_selling_price)}calculateMarkup(){this.itemToEdit.recom_selling_price>0&&this.itemToEdit.recom_selling_price>=this.itemToEdit.buying_price&&(this.itemToEdit.markup=parseFloat(((this.itemToEdit.recom_selling_price-this.itemToEdit.buying_price)/this.itemToEdit.buying_price*100).toFixed(2)),this.itemToEdit.min_selling_price>0&&this.itemToEdit.min_selling_price>=this.itemToEdit.buying_price&&this.itemToEdit.min_selling_price<=this.itemToEdit.recom_selling_price&&(this.itemToEdit.markup_discount=parseFloat(((this.itemToEdit.min_selling_price-this.itemToEdit.buying_price)/this.itemToEdit.buying_price*100).toFixed(2))))}hideEdit(i){const e=this.units.find(({id:r})=>r===this.itemToEdit.id),n=this.units.indexOf(e);this.units[n]=this.itemToEditDefault,this.showNotification=!1,this.displayEditItemDialog=!1}getTotalPrice2(){this.itemToEdit.buying_price=this.itemToEdit.unit_quantity?this.itemToEdit.unit_quantity*this.buying_price:0}updateItem(){this.spinner.show("edit");const i={action:this.cryptoSrv.encodeEncryptText("update_item_selling_unit"),unit_id:this.itemToEdit.id,item_id:this.item_id,unit:this.cryptoSrv.encodeEncryptText(this.itemToEdit.unit_name),unit_quantity:this.cryptoSrv.encodeEncryptText(this.itemToEdit.unit_quantity.toString()),unit_min_selling_price:this.cryptoSrv.encodeEncryptText(this.itemToEdit.min_selling_price.toString()),unit_recom_selling_price:this.cryptoSrv.encodeEncryptText(this.itemToEdit.recom_selling_price.toString()),markup:this.cryptoSrv.encodeEncryptText(this.itemToEdit.markup.toString()),markup_discount:this.cryptoSrv.encodeEncryptText(this.itemToEdit.markup_discount.toString()),added_by:this.authSrv.getUserDetailToken("uid")};this.apiSrv.post(i).then(e=>{"error"!=e.status?"error2"!=e.status?(this.itemToEdit.recom_price_ok=!0,this.itemToEdit.min_price_ok=!0,this.priceUpdated.emit(!0),this.units=this.units.sort((r,c)=>c.unit_quantity-r.unit_quantity),this.spinner.hide("edit"),this.itemToEdit={},this.showNotification=!0,setTimeout(()=>{this.displayEditItemDialog=!1},1500)):(this.spinner.hide("edit"),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.spinner.hide("edit"),this.toastr.error(e.message))}).catch(e=>{this.toastr.error(e),this.spinner.hide("edit")})}}return o.\u0275fac=function(i){return new(i||o)(t.Y36(w.s),t.Y36(x.$),t.Y36(C._W),t.Y36(_.t2),t.Y36(p.YP),t.Y36(y.e),t.Y36(t.sBO))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-stock-units"]],viewQuery:function(i,e){if(1&i&&t.Gf(pt,5),2&i){let n;t.iGM(n=t.CRH())&&(e.overlay=n.first)}},inputs:{units:"units",item_id:"item_id",buying_price:"buying_price",totalQty:"totalQty"},outputs:{priceUpdated:"priceUpdated"},decls:22,vars:38,consts:[[1,"row"],[1,"col-md-12"],["styleClass","p-datatable-customers","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"value","rowHover","rows","showCurrentPageReport","rowsPerPageOptions","paginator","filterDelay","globalFilterFields"],["dt",""],["pTemplate","header"],["pTemplate","body"],["appendTo","body","blockScroll","true","modal","true","transitionOptions","390ms cubic-bezier(0, 0, 0.2, 1)",3,"header","closable","visible","baseZIndex","visibleChange"],["autocomplete","off",3,"ngSubmit",4,"ngIf"],[3,"message","showNotification",4,"ngIf"],["bdOpacity","#fff","name","new","bdColor","rgba(255,255,255,0.76)","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[2,"color","#02926e"],["bdOpacity","#fff","name","edit","bdColor","rgba(255,255,255,0.76)","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[3,"showCloseIcon","styleClass"],["op",""],["pTemplate",""],["bdOpacity","#fff","bdColor","rgba(255,255,255,0.76)","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[1,"ui-selectable-row"],[2,"width","20rem"],["pButton","","type","button","icon","pi pi-plus","label","Add a new selling unit","class","p-button-success p-button-sm float-right",3,"click",4,"ngIf"],["pButton","","type","button","icon","pi pi-plus","label","Add a new selling unit",1,"p-button-success","p-button-sm","float-right",3,"click"],[2,"word-wrap","normal"],["class","animate-flicker danger",4,"ngIf"],["pButton","","type","button","icon","pi pi-pencil","label","Edit","class","mr-2 p-button-success p-button-outline p-button-sm p-button-outlined",3,"click",4,"ngIf"],["pButton","","type","button","icon","pi pi-trash","label","Delete","class","p-button-danger p-button-outline p-button-sm p-button-outlined",3,"click",4,"ngIf"],[1,"animate-flicker","danger"],["pButton","","type","button","icon","pi pi-pencil","label","Edit",1,"mr-2","p-button-success","p-button-outline","p-button-sm","p-button-outlined",3,"click"],["pButton","","type","button","icon","pi pi-trash","label","Delete",1,"p-button-danger","p-button-outline","p-button-sm","p-button-outlined",3,"click"],["autocomplete","off",3,"ngSubmit"],["form2","ngForm"],[1,"ui-fluid"],[1,"p-field","pb-3"],["for","vat"],["id","name","name","name","required","","type","text","min","0","pInputText","",1,"form-control",3,"ngModel","ngModelChange"],["id","pieces","name","pieces","required","","type","number","pattern","[0-9]+","min","1","pInputNumber","",1,"form-control",3,"ngModel","ngModelChange"],["id","buying_price","name","buying_price","required","","type","text","disabled","true","min","0","pInputText","",1,"form-control",3,"value"],["for","markup"],["id","markup","name","markup","required","","type","number","min","0","pInputNumber","",1,"form-control",3,"ngModel","input","ngModelChange"],["id","unitq-help","class","p-error block animate-flicker",4,"ngIf"],["for","markup_discount"],["id","markup_discount","name","markup_discount","required","","type","number","min","0","pInputNumber","",1,"form-control",3,"ngModel","input","ngModelChange"],["id","recom_price","name","recom_price","required","","type","number","min","0","pInputNumber","",1,"form-control",3,"ngModel","input","ngModelChange"],["id","min_price","name","min_price","required","","type","number","min","0","pInputNumber","",1,"form-control",3,"ngModel","input","ngModelChange"],["type","button","pButton","","icon","pi pi-times","label","Cancel",1,"p-button-danger","p-button-sm","float-right",3,"click"],["type","submit","pButton","","icon","pi pi-check","label","Save",1,"p-button-success","p-button-sm","mr-3","float-right",3,"disabled"],["id","unitq-help",1,"p-error","block","animate-flicker"],[3,"message","showNotification"],["id","name","name","name","required","","type","text","pInputText","",1,"form-control",3,"disabled","ngModel","ngModelChange"],["id","pieces","name","pieces","required","","type","number","pattern","[0-9]+","min","1","pInputNumber","",1,"form-control",3,"disabled","ngModel","input","ngModelChange"],["id","name","name","name","required","","type","text","pInputText","",1,"form-control",3,"ngModel","ngModelChange"],["id","recom_price","name","recom_price","required","","type","number","min","0","pInputNumber","",1,"form-control",3,"ngModel","ngModelChange"],["id","min_price","name","min_price","required","","type","number","min","0.0001","pInputNumber","",1,"form-control",3,"ngModel","ngModelChange"]],template:function(i,e){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"p-table",2,3),t.YNc(4,ut,15,1,"ng-template",4),t.YNc(5,ft,26,27,"ng-template",5),t.qZA()()(),t.TgZ(6,"p-dialog",6),t.NdJ("visibleChange",function(r){return e.displayNewItemDialog=r}),t.YNc(7,Ct,47,15,"form",7),t.YNc(8,yt,1,2,"app-notification",8),t.TgZ(9,"ngx-spinner",9),t._UZ(10,"p",10),t.qZA()(),t.TgZ(11,"p-dialog",6),t.NdJ("visibleChange",function(r){return e.displayEditItemDialog=r}),t.ALo(12,"titlecase"),t.YNc(13,It,48,18,"form",7),t.YNc(14,At,1,2,"app-notification",8),t.TgZ(15,"ngx-spinner",11),t._UZ(16,"p",10),t.qZA()(),t.TgZ(17,"p-overlayPanel",12,13),t.YNc(19,Qt,4,3,"ng-template",14),t.qZA(),t.TgZ(20,"ngx-spinner",15),t._UZ(21,"p",10),t.qZA()),2&i&&(t.xp6(2),t.Q6J("value",e.units)("rowHover",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",t.DdM(33,Dt))("paginator",!0)("filterDelay",0)("globalFilterFields",t.DdM(34,Pt)),t.xp6(4),t.Akn(t.DdM(35,A)),t.s9C("header",e.showNotification?"":"New selling unit"),t.Q6J("closable",!1)("visible",e.displayNewItemDialog)("baseZIndex",1e4),t.xp6(1),t.Q6J("ngIf",!e.showNotification),t.xp6(1),t.Q6J("ngIf",e.showNotification),t.xp6(1),t.Q6J("fullScreen",!1),t.xp6(2),t.Akn(t.DdM(36,A)),t.s9C("header",e.showNotification?"":t.lcZ(12,31,e.itemToEdit.unit_name)),t.Q6J("closable",!1)("visible",e.displayEditItemDialog)("baseZIndex",1e4),t.xp6(2),t.Q6J("ngIf",!e.showNotification),t.xp6(1),t.Q6J("ngIf",e.showNotification),t.xp6(1),t.Q6J("fullScreen",!1),t.xp6(2),t.Akn(t.DdM(37,Yt)),t.Q6J("showCloseIcon",!1)("styleClass","custom-overlay-panel"),t.xp6(3),t.Q6J("fullScreen",!0))},dependencies:[m.O5,_.Ro,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.Q7,l.c5,l.qQ,l.On,l.F,f.V,p.$_,p.jx,h.Hq,g.iA,Z.o,v.T,T.c,m.JJ,m.rS],styles:["label[_ngcontent-%COMP%]{text-transform:none}.p-overlaypanel[_ngcontent-%COMP%]{min-width:0;min-width:initial;max-width:none;max-width:initial}.custom-overlay-panel[_ngcontent-%COMP%]{left:0!important;transform:translate(-100%)!important}"]}),o})(),Ft=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[q,U.U]}),o})();t.B6R(S.J,[m.sg,m.O5,_.Ro,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.Q7,l.c5,l.qQ,l.On,l.F,f.V,p.$_,p.jx,it.Q,h.Hq,h.zx,g.iA,g.lQ,g.fz,nt.NU,Z.o,ot.Lt,rt.a,b.jt,b.iD,b.Vi,b.TH,v.T,st.H,lt.q,at.EU,ct.R,Ht,T.c,V,et],[m.JJ,m.rS])}}]);