"use strict";(self.webpackChunkmatngular=self.webpackChunkmatngular||[]).push([[340],{5340:(j,g,a)=>{a.r(g),a.d(g,{ExpensesModule:()=>F});var h=a(2318),p=a(7340),e=a(4650),m=a(8423),f=a(3166),T=a(7185),v=a(1927),y=a(1932),l=a(805),c=a(6895),d=a(4006),_=a(1493),C=a(2137),A=a(5593),Z=a(3087),b=a(1740),M=a(613),E=a(585),S=a(3054);function J(o,r){1&o&&(e.TgZ(0,"tr",44)(1,"th",45),e._uU(2,"Description"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Amount "),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Paid via "),e.qZA(),e._UZ(7,"th"),e.qZA())}function I(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"tr",46)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"number"),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.ALo(8,"titlecase"),e.qZA(),e.TgZ(9,"td")(10,"button",47),e.NdJ("click",function(){const i=e.CHM(t).$implicit,u=e.oxw(2);return e.KtG(u.confirmDelete(i))}),e.qZA()()()}if(2&o){const t=r.$implicit;e.xp6(2),e.hij(" ",t.purpose," "),e.xp6(2),e.hij(" ",e.xi3(5,3,t.amount,".2")," "),e.xp6(3),e.hij(" ",e.lcZ(8,6,t.channel)," ")}}const D=function(){return[10,25,50]},U=function(){return["name","description"]};function w(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",4),e._UZ(1,"div",33),e.TgZ(2,"div",34)(3,"div",35)(4,"div",36)(5,"h4",37),e._uU(6," Expenses "),e.TgZ(7,"button",38),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return s.displayNewItemDialog=!0,e.KtG(s.expenseToAdd={})}),e.qZA()()(),e.TgZ(8,"div",39)(9,"p-table",40,41),e.YNc(11,J,8,0,"ng-template",42),e.YNc(12,I,11,8,"ng-template",43),e.qZA()()()()()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("@enter",void 0),e.xp6(6),e.Q6J("value",t.expenses)("rowHover",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",e.DdM(9,D))("paginator",!0)("filterDelay",0)("globalFilterFields",e.DdM(10,U))}}function N(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",15)(1,"p-radioButton",48),e.NdJ("ngModelChange",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.todayChecked=s)}),e.qZA(),e.TgZ(2,"label",49),e._uU(3,"Different date"),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.todayChecked)}}function B(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"p-calendar",50),e.NdJ("ngModelChange",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.expenseToAdd.date_incurred=s)}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("ngModel",t.expenseToAdd.date_incurred)("maxDate",t.maxDate)("touchUI",!1)("monthNavigator",!0)}}const x=function(){return{width:"30vw"}},Q=[{path:"",component:(()=>{class o{constructor(t,n,s,i,u,Y){this.spinner=t,this.cryptoSrv=n,this.toastr=s,this.authSrv=i,this.apiSrv=u,this.confirmationService=Y,this.loading=!1,this.expenses=[],this.expenseToAdd={},this.displayNewItemDialog=!1,this.todayChecked="today",this.userIsAdmin=!1}ngOnInit(){"admin"===this.cryptoSrv.decryptEncodedText(this.authSrv.getUserDetailToken("role"))&&(this.userIsAdmin=!0),"1"===this.cryptoSrv.decryptEncodedText(this.authSrv.getRoleToken("adding_expenses"))||"admin"===this.cryptoSrv.decryptEncodedText(this.authSrv.getUserDetailToken("role"))?this.getAllExpenses():(this.toastr.error("You have no rights to access that page!"),this.authSrv.logout())}getAllExpenses(){this.expenseToAdd.date_incurred=new Date,this.todayChecked="today",this.expenseToAdd.channel="cash",this.spinner.show();const t={action:this.cryptoSrv.encodeEncryptText("get-user-today-expenses"),uid:this.authSrv.getUserDetailToken("uid")};this.apiSrv.read(t).then(n=>{"error"!=n.status?"error2"!=n.status?(this.expenses=n.expenses,this.spinner.hide(),this.loading=!1):(this.spinner.hide(),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.spinner.hide(),this.toastr.error(n.message))}).catch(n=>{this.toastr.error(n),this.spinner.hide()})}addItem(){"today"===this.todayChecked&&(this.expenseToAdd.date_incurred=new Date);const t=new Date;this.expenseToAdd.date_incurred.setHours(t.getHours()),this.expenseToAdd.date_incurred.setMinutes(t.getMinutes()),this.expenseToAdd.date_incurred.setSeconds(t.getSeconds()),this.spinner.show("new");const n={action:this.cryptoSrv.encodeEncryptText("add-expense"),purpose:this.cryptoSrv.encodeEncryptText(this.expenseToAdd.purpose),paid_to:this.cryptoSrv.encodeEncryptText(this.expenseToAdd.paid_to),channel:this.cryptoSrv.encodeEncryptText(this.expenseToAdd.channel),amount:this.cryptoSrv.encodeEncryptText(this.expenseToAdd.amount.toString()),date_incurred:this.cryptoSrv.encodeEncryptText(this.expenseToAdd.date_incurred.toLocaleString("sv-SE",{hour12:!1})),uid:this.authSrv.getUserDetailToken("uid")};this.apiSrv.post(n).then(s=>{"error"!=s.status?"error2"!=s.status?(this.displayNewItemDialog=!1,this.expenseToAdd={},this.ngOnInit(),this.toastr.success("Expense added!")):(this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):this.toastr.error(s.message),this.spinner.hide("new")}).catch(s=>{this.toastr.error(s),this.spinner.hide("new")})}confirmDelete(t){this.confirmationService.confirm({message:"Are you sure you want to delete this expense?",acceptButtonStyleClass:"p-button-primary p-button-sm",rejectButtonStyleClass:"p-button-danger p-button-sm",acceptLabel:"Delete",rejectLabel:"Cancel",accept:()=>{this.delete(t)},reject:()=>{}})}delete(t){this.spinner.show();const n={action:this.cryptoSrv.encodeEncryptText("delete-expense"),uid:this.authSrv.getUserDetailToken("uid"),id:t.id};this.apiSrv.post(n).then(s=>{"error"!=s.status?"error2"!=s.status?(this.toastr.success("Expense deleted!"),this.expenses=this.expenses.filter(i=>i.id!==t.id)):(this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):this.toastr.error(s.message),this.spinner.hide()}).catch(s=>{this.toastr.error(s),this.spinner.hide()})}hideNewItemDialog(){this.expenseToAdd={},this.expenseToAdd.date_incurred=new Date,this.todayChecked="today",this.expenseToAdd.channel="cash",this.displayNewItemDialog=!1}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(m.t2),e.Y36(f.$),e.Y36(T._W),e.Y36(v.e),e.Y36(y.s),e.Y36(l.YP))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-expenses"]],decls:50,vars:22,consts:[["class","row",4,"ngIf"],["appendTo","body","modal","true","header","New expense",3,"closable","visible","baseZIndex","visibleChange"],["autocomplete","off",3,"ngSubmit"],["form2","ngForm"],[1,"row"],[1,"col-md-12"],[1,"ui-fluid"],[1,"p-field","pb-3"],["for","des"],["name","purpose","id","des","pInputTextarea","",1,"form-control",3,"ngModel","ngModelChange"],["for","amount"],["id","amount","name","amount","required","","type","number","pattern","[0-9]+","pInputNumber","",1,"form-control",3,"ngModel","ngModelChange"],["for","pt"],["id","pt","name","pt","required","","type","text","pInputText","",1,"form-control",3,"ngModel","ngModelChange"],["for","firstname3 py-3"],[1,"field-radiobutton"],["name","city","value","cash","inputId","city1",3,"ngModel","ngModelChange"],["for","city1",1,"primary"],[1,"fas","fa-money-bill"],["name","city","value","mpesa","inputId","city2",3,"ngModel","ngModelChange"],["for","city2",1,"success"],[1,"fas","fa-mobile-alt"],[1,"p-field"],["name","today","value","today","inputId","city11",3,"ngModel","ngModelChange"],["for","today"],["class","field-radiobutton",4,"ngIf"],["appendTo","body","name","start_date","required","","readonlyInput","true",3,"ngModel","maxDate","touchUI","monthNavigator","ngModelChange",4,"ngIf"],["type","submit","pButton","","icon","pi pi-check","label","Save",1,"p-button-success","p-button-sm","float-right",3,"disabled"],["type","button","pButton","","icon","pi pi-times","label","Cancel",1,"ui-button-danger","p-button-danger","mr-3","p-button-sm","float-right",3,"click"],["bdOpacity","#fff","name","new","bdColor","rgba(255,255,255,0.76)","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[2,"color","#02926e"],["header","Confirm","icon","pi pi-exclamation-triangle","appendTo","body",3,"baseZIndex"],["bdOpacity","#fff","bdColor","rgba(255,255,255,0.76)","size","medium","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[1,"col-md-3"],[1,"col-md-6"],[1,"card"],[1,"card-header"],[1,"card-title","mb-4"],["pButton","","type","button","icon","pi pi-plus","label","Add a new expense",1,"p-button-success","p-button-sm","float-right","mb-2",3,"click"],[1,"card-body","p-0","m-0"],["styleClass","p-datatable-customers","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"value","rowHover","rows","showCurrentPageReport","rowsPerPageOptions","paginator","filterDelay","globalFilterFields"],["dt",""],["pTemplate","header"],["pTemplate","body"],[1,"ui-selectable-row"],[2,"width","25rem"],[2,"word-wrap","normal"],["pButton","","type","button","icon","pi pi-trash","label","Delete",1,"p-button-danger","p-button-sm","p-button-outlined","float-right",3,"click"],["name","notToday","value","notToday","inputId","city22",3,"ngModel","ngModelChange"],["for","notToday"],["appendTo","body","name","start_date","required","","readonlyInput","true",3,"ngModel","maxDate","touchUI","monthNavigator","ngModelChange"]],template:function(t,n){if(1&t&&(e.YNc(0,w,13,11,"div",0),e.TgZ(1,"p-dialog",1),e.NdJ("visibleChange",function(i){return n.displayNewItemDialog=i}),e.TgZ(2,"form",2,3),e.NdJ("ngSubmit",function(){return n.addItem()}),e.TgZ(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"label",8),e._uU(9,"Description"),e.qZA(),e.TgZ(10,"textarea",9),e.NdJ("ngModelChange",function(i){return n.expenseToAdd.purpose=i}),e._uU(11,"                  "),e.qZA()(),e.TgZ(12,"div",7)(13,"label",10),e._uU(14,"Amount"),e.qZA(),e.TgZ(15,"input",11),e.NdJ("ngModelChange",function(i){return n.expenseToAdd.amount=i}),e.qZA()(),e.TgZ(16,"div",7)(17,"label",12),e._uU(18,"Paid to"),e.qZA(),e.TgZ(19,"input",13),e.NdJ("ngModelChange",function(i){return n.expenseToAdd.paid_to=i}),e.qZA()(),e.TgZ(20,"div",7)(21,"label",14),e._uU(22,"Paid using"),e.qZA(),e.TgZ(23,"div",15)(24,"p-radioButton",16),e.NdJ("ngModelChange",function(i){return n.expenseToAdd.channel=i}),e.qZA(),e.TgZ(25,"label",17),e._uU(26,"Cash "),e._UZ(27,"i",18),e.qZA()(),e.TgZ(28,"div",15)(29,"p-radioButton",19),e.NdJ("ngModelChange",function(i){return n.expenseToAdd.channel=i}),e.qZA(),e.TgZ(30,"label",20),e._uU(31,"Mpesa "),e._UZ(32,"i",21),e.qZA()()(),e.TgZ(33,"div",22)(34,"h5"),e._uU(35,"Date incurred"),e.qZA(),e.TgZ(36,"div",15)(37,"p-radioButton",23),e.NdJ("ngModelChange",function(i){return n.todayChecked=i}),e.qZA(),e.TgZ(38,"label",24),e._uU(39,"Today"),e.qZA()(),e.YNc(40,N,4,1,"div",25),e.YNc(41,B,1,4,"p-calendar",26),e.qZA()()()(),e.TgZ(42,"p-footer"),e._UZ(43,"button",27),e.TgZ(44,"button",28),e.NdJ("click",function(){return n.hideNewItemDialog()}),e.qZA()()(),e.TgZ(45,"ngx-spinner",29),e._UZ(46,"p",30),e.qZA()(),e._UZ(47,"p-confirmDialog",31),e.TgZ(48,"ngx-spinner",32),e._UZ(49,"p",30),e.qZA()),2&t){const s=e.MAs(3);e.Q6J("ngIf",!n.loading),e.xp6(1),e.Akn(e.DdM(20,x)),e.Q6J("closable",!1)("visible",n.displayNewItemDialog)("baseZIndex",1e4),e.xp6(9),e.Q6J("ngModel",n.expenseToAdd.purpose),e.xp6(5),e.Q6J("ngModel",n.expenseToAdd.amount),e.xp6(4),e.Q6J("ngModel",n.expenseToAdd.paid_to),e.xp6(5),e.Q6J("ngModel",n.expenseToAdd.channel),e.xp6(5),e.Q6J("ngModel",n.expenseToAdd.channel),e.xp6(8),e.Q6J("ngModel",n.todayChecked),e.xp6(3),e.Q6J("ngIf",n.userIsAdmin),e.xp6(1),e.Q6J("ngIf","notToday"==n.todayChecked),e.xp6(2),e.Q6J("disabled",!s.valid||null==n.expenseToAdd.channel),e.xp6(2),e.Q6J("fullScreen",!1),e.xp6(2),e.Akn(e.DdM(21,x)),e.Q6J("baseZIndex",1e4),e.xp6(1),e.Q6J("fullScreen",!0)}},dependencies:[c.O5,m.Ro,d._Y,d.Fj,d.wV,d.JJ,d.JL,d.Q7,d.c5,d.On,d.F,_.V,l.$_,l.jx,C.Q,A.Hq,Z.iA,b.o,M.EU,E.f,S.g,c.JJ,c.rS],styles:["label[_ngcontent-%COMP%]{text-transform:none}"],data:{animation:[(0,p.X$)("enter",[(0,p.eR)("void => *",[(0,p.oB)({opacity:0}),(0,p.jt)(1e3,(0,p.oB)({opacity:1}))])])]}}),o})(),data:{title:"Expenses"}}];let q=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[h.Bz.forChild(Q),h.Bz]}),o})();var P=a(4397);let F=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[q,P.U]}),o})()}}]);