"use strict";(self.webpackChunkmatngular=self.webpackChunkmatngular||[]).push([[459],{2433:(J,g,r)=>{r.r(g),r.d(g,{CashSaleModule:()=>Tt});var p=r(2841),y=r(2318),t=r(4650);const f=[{path:"",component:p.E,data:{title:"Products"}}];let u=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[y.Bz.forChild(f),y.Bz]}),n})();var M=r(4397),_=r(7340),v=r(8423),U=r(3166),Q=r(7185),E=r(1927),L=r(1932),c=r(6895),m=r(4006),w=r(1493),x=r(805),T=r(5593),d=r(3087),Z=r(1740),P=r(666),S=r(2435),k=r(8558),b=r(8271),O=r(613),A=r(585),F=r(3942);const B=["op"],D=["op1"];function H(n,s){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"titlecase"),t.qZA()),2&n){const e=s.$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,e.name))}}function R(n,s){if(1&n&&(t.TgZ(0,"div",53)(1,"div"),t._uU(2),t.ALo(3,"titlecase"),t.qZA()()),2&n){const e=s.$implicit;t.xp6(2),t.Oqu(t.lcZ(3,1,e.name))}}function G(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",34)(1,"div",17)(2,"div",18)(3,"label",56),t._uU(4,"Cash amount"),t.qZA(),t._UZ(5,"br"),t.TgZ(6,"input",57),t.NdJ("input",function(){t.CHM(e);const o=t.oxw(3);return t.KtG(o.checkTotalAmountPaidCash())})("ngModelChange",function(o){t.CHM(e);const a=t.oxw(3);return t.KtG(a.paymentModel.cash_amount=o)}),t.qZA()()()()}if(2&n){const e=t.oxw(3);t.xp6(2),t.Q6J("@enter",void 0),t.xp6(4),t.Q6J("ngModel",e.paymentModel.cash_amount)}}function K(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",34)(1,"div",17)(2,"div",18)(3,"label",58),t._uU(4,"Mpesa amount"),t.qZA(),t._UZ(5,"br"),t.TgZ(6,"input",59),t.NdJ("input",function(){t.CHM(e);const o=t.oxw(3);return t.KtG(o.checkTotalAmountPaidMpesa())})("ngModelChange",function(o){t.CHM(e);const a=t.oxw(3);return t.KtG(a.paymentModel.mpesa_amount=o)}),t.qZA()()()()}if(2&n){const e=t.oxw(3);t.xp6(2),t.Q6J("@enter",void 0),t.xp6(4),t.Q6J("ngModel",e.paymentModel.mpesa_amount)}}function V(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",34)(1,"div",17)(2,"div",18)(3,"label",60),t._uU(4,"Bank amount"),t.qZA(),t._UZ(5,"br"),t.TgZ(6,"input",61),t.NdJ("input",function(){t.CHM(e);const o=t.oxw(3);return t.KtG(o.checkTotalAmountPaidBank())})("ngModelChange",function(o){t.CHM(e);const a=t.oxw(3);return t.KtG(a.paymentModel.bank_amount=o)}),t.qZA()()()()}if(2&n){const e=t.oxw(3);t.Q6J("@enter",void 0),t.xp6(6),t.Q6J("ngModel",e.paymentModel.bank_amount)}}function Y(n,s){if(1&n&&(t.TgZ(0,"div",54),t.YNc(1,G,7,2,"div",55),t.YNc(2,K,7,2,"div",55),t.YNc(3,V,7,2,"div",55),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.showCashInput),t.xp6(1),t.Q6J("ngIf",e.showMpesaInput),t.xp6(1),t.Q6J("ngIf",e.showBankInput)}}function $(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",20)(1,"p-radioButton",62),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw(2);return t.KtG(a.todayChecked=o)}),t.qZA(),t.TgZ(2,"label",63),t._uU(3,"Different date"),t.qZA()()}if(2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngModel",e.todayChecked)}}function j(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"p-calendar",64),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw(2);return t.KtG(a.dateOfSale=o)}),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("ngModel",e.dateOfSale)("maxDate",e.maxDate)("touchUI",!1)("monthNavigator",!0)}}function z(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",65)(1,"div",66)(2,"div",67)(3,"div",68)(4,"span",69),t._uU(5," Customer's name "),t.qZA(),t.TgZ(6,"input",70),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw(2);return t.KtG(a.receiptCustomer=o)}),t.qZA()()()()()}if(2&n){const e=t.oxw(2);t.xp6(6),t.Q6J("ngModel",e.receiptCustomer)}}function W(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"form",9,10),t.NdJ("ngSubmit",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.waitingCustomer?o.completePaymentWaiting():o.completePayment())}),t.TgZ(2,"div",11)(3,"div",12)(4,"h6",13),t._uU(5," Select customer "),t.TgZ(6,"p-dropdown",14),t.NdJ("onChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.selectCustomer(o))})("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.cashCustomer=o)}),t.YNc(7,H,3,3,"ng-template",15),t.YNc(8,R,4,3,"ng-template",16),t.qZA()()(),t.TgZ(9,"div",12)(10,"div",17)(11,"div",18)(12,"h6",19),t._uU(13,"Payment method"),t.qZA(),t.TgZ(14,"div",20)(15,"p-radioButton",21),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.paymentModel.pay_method=o)})("onClick",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.changePaymentMethod("cash"))}),t.qZA(),t.TgZ(16,"label",22),t._uU(17,"Cash "),t._UZ(18,"i",23),t.qZA()(),t.TgZ(19,"div",20)(20,"p-radioButton",24),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.paymentModel.pay_method=o)})("onClick",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.changePaymentMethod("mpesa"))}),t.qZA(),t.TgZ(21,"label",25),t._uU(22,"Mpesa "),t._UZ(23,"i",26),t.qZA()(),t.TgZ(24,"div",20)(25,"p-radioButton",27),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.paymentModel.pay_method=o)})("onClick",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.changePaymentMethod("bank"))}),t.qZA(),t.TgZ(26,"label",28),t._uU(27,"Bank "),t._UZ(28,"i",29),t.qZA()(),t.TgZ(29,"div",20)(30,"p-radioButton",30),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.paymentModel.pay_method=o)})("onClick",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.showMultiplePaymentForm())}),t.qZA(),t.TgZ(31,"label",31),t._uU(32,"Multiple "),t._UZ(33,"i",32),t.qZA()()()()(),t.YNc(34,Y,4,3,"div",33),t.TgZ(35,"div",34,35)(37,"div",17)(38,"div",18)(39,"h5"),t._uU(40,"Date of sale"),t.qZA(),t.TgZ(41,"div",20)(42,"p-radioButton",36),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.todayChecked=o)}),t.qZA(),t.TgZ(43,"label",37),t._uU(44,"Today"),t.qZA()(),t.YNc(45,$,4,1,"div",38),t.YNc(46,j,1,4,"p-calendar",39),t.qZA()()(),t.TgZ(47,"div",40)(48,"div",17)(49,"div",18)(50,"div",20)(51,"p-radioButton",41),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.printReceipt=o)}),t.qZA(),t.TgZ(52,"label",42),t._uU(53,"Print sale receipt"),t.qZA()(),t.TgZ(54,"div",20)(55,"p-radioButton",43),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.printReceipt=o)}),t.qZA(),t.TgZ(56,"label",44),t._uU(57,"No sale receipt"),t.qZA()()()()(),t.TgZ(58,"div",40)(59,"div",17)(60,"div",18)(61,"div",20)(62,"p-radioButton",45),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.printDeliveryReceipt=o)}),t.qZA(),t.TgZ(63,"label",46),t._uU(64,"Print delivery receipt"),t.qZA()(),t.TgZ(65,"div",20)(66,"p-radioButton",47),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.printDeliveryReceipt=o)}),t.qZA(),t.TgZ(67,"label",48),t._uU(68,"No delivery receipt"),t.qZA()()()()(),t.YNc(69,z,7,1,"div",49),t.qZA(),t.TgZ(70,"div",50)(71,"div",51),t._UZ(72,"button",52),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(6),t.Q6J("options",e.myCashCustomers)("ngModel",e.cashCustomer)("filter",!0),t.xp6(9),t.Q6J("ngModel",e.paymentModel.pay_method),t.xp6(5),t.Q6J("ngModel",e.paymentModel.pay_method),t.xp6(5),t.Q6J("ngModel",e.paymentModel.pay_method),t.xp6(5),t.Q6J("ngModel",e.paymentModel.pay_method),t.xp6(4),t.Q6J("ngIf",e.displayMultiplePaymentForm),t.xp6(8),t.Q6J("ngModel",e.todayChecked),t.xp6(3),t.Q6J("ngIf",e.userIsAdmin),t.xp6(1),t.Q6J("ngIf","notToday"==e.todayChecked),t.xp6(5),t.Q6J("ngModel",e.printReceipt),t.xp6(4),t.Q6J("ngModel",e.printReceipt),t.xp6(7),t.Q6J("ngModel",e.printDeliveryReceipt),t.xp6(4),t.Q6J("ngModel",e.printDeliveryReceipt),t.xp6(3),t.Q6J("ngIf",null==e.waitingCustomer),t.xp6(3),t.Q6J("disabled",!e.paymentValid||!e.cashCustomer)}}function X(n,s){if(1&n&&t._UZ(0,"app-notification",71),2&n){const e=t.oxw();t.Q6J("message","Sale completed!")("showNotification",e.showNotification)}}function tt(n,s){1&n&&(t.TgZ(0,"tr",79)(1,"th",80),t._uU(2,"Item "),t.qZA(),t.TgZ(3,"th",81),t._uU(4,"Quantity ordered "),t.qZA(),t.TgZ(5,"th",80),t._uU(6,"Quantity available "),t.qZA(),t._UZ(7,"th",82),t.qZA())}function et(n,s){1&n&&t._UZ(0,"div",86)}const ot=function(n){return{"word-wrap":"normal",color:n}},q=function(n){return{"background-color":n,color:"#ffffff",cursor:"pointer"}};function nt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.ALo(3,"titlecase"),t.qZA(),t.TgZ(4,"td")(5,"p-avatarGroup",83),t.NdJ("click",function(o){const l=t.CHM(e).$implicit,h=t.oxw(2);return t.KtG(h.showLocationsQuantityOrdered(l.item,l,o))}),t._UZ(6,"p-avatar",84),t.qZA()(),t.TgZ(7,"td")(8,"p-avatarGroup",83),t.NdJ("click",function(o){const l=t.CHM(e).$implicit,h=t.oxw(2);return t.KtG(h.showLocationsQuantityNew(l.item,o))}),t._UZ(9,"p-avatar",84),t.qZA()(),t.TgZ(10,"td"),t.YNc(11,et,1,0,"div",85),t.qZA()()}if(2&n){const e=s.$implicit,i=t.oxw(2);t.Akn(t.VKq(10,ot,e.location.color)),t.xp6(2),t.hij(" ",t.lcZ(3,8,e.item.name)," "),t.xp6(4),t.Akn(t.VKq(12,q,e.location.color)),t.xp6(3),t.Akn(t.VKq(14,q,e.location.color)),t.xp6(2),t.Q6J("ngIf",i.loaderToShow==e.item.id)}}const at=function(){return{width:"50vw"}},it=function(){return[500]},st=function(){return["item.name"]};function rt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"p-dialog",72),t.NdJ("visibleChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.showQuantityError=o)}),t.TgZ(1,"div",73)(2,"div",74)(3,"p-table",75,76),t.YNc(5,tt,8,0,"ng-template",77),t.YNc(6,nt,12,16,"ng-template",78),t.qZA()()()()}if(2&n){const e=t.oxw();t.Akn(t.DdM(13,at)),t.Q6J("closable",!0)("visible",e.showQuantityError)("baseZIndex",1e4),t.xp6(3),t.Q6J("value",e.lessItems)("rowHover",!0)("rows",10)("showCurrentPageReport",!1)("rowsPerPageOptions",t.DdM(14,it))("paginator",!1)("filterDelay",0)("globalFilterFields",t.DdM(15,st))}}function lt(n,s){if(1&n&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"titlecase"),t.ALo(3,"number"),t.qZA()),2&n){const e=s.$implicit;t.xp6(1),t.AsE(" ",t.lcZ(2,2,e.unit_name)," (",t.lcZ(3,4,e.unit_quantity),") ")}}function mt(n,s){if(1&n&&(t.TgZ(0,"tr"),t._UZ(1,"th"),t.TgZ(2,"th"),t._uU(3,"Location"),t.qZA(),t.YNc(4,lt,4,6,"th",88),t.qZA()),2&n){const e=t.oxw(2);t.xp6(4),t.Q6J("ngForOf",e.itemToViewLocations.selling_units)}}function pt(n,s){if(1&n&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&n){const e=s.$implicit,i=t.oxw().$implicit,o=t.oxw(2);t.xp6(1),t.hij(" ",o.getLocationUnitQuantityOrdered(i.location_quantity,o.itemToViewLocations.selling_units)[e.unit_name]," ")}}const I=function(n){return{"background-color":n,color:"#ffffff"}};function ct(n,s){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._UZ(2,"p-avatar",84),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.ALo(5,"titlecase"),t.qZA(),t.YNc(6,pt,2,1,"td",88),t.qZA()),2&n){const e=s.$implicit,i=t.oxw(2);t.xp6(2),t.Akn(t.VKq(6,I,e.location.color)),t.xp6(2),t.Oqu(t.lcZ(5,4,e.location.name)),t.xp6(2),t.Q6J("ngForOf",i.itemToViewLocations.selling_units)}}function dt(n,s){if(1&n&&(t.TgZ(0,"p-table",87),t.YNc(1,mt,5,1,"ng-template",77),t.YNc(2,ct,7,8,"ng-template",78),t.qZA()),2&n){const e=t.oxw();t.Q6J("value",e.itemToViewLocations.locations_qty)("paginator",!1)("rows",5)}}function ut(n,s){if(1&n&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"titlecase"),t.ALo(3,"number"),t.TgZ(4,"p",89)(5,"i",90),t._uU(6),t.ALo(7,"number"),t.qZA()()()),2&n){const e=s.$implicit;t.xp6(1),t.AsE(" ",t.lcZ(2,3,e.unit_name)," (",t.lcZ(3,5,e.unit_quantity),") "),t.xp6(5),t.Oqu("@Ksh "+t.lcZ(7,7,e.recom_selling_price))}}function ht(n,s){if(1&n&&(t.TgZ(0,"tr"),t._UZ(1,"th"),t.TgZ(2,"th"),t._uU(3,"Location"),t.qZA(),t.YNc(4,ut,8,9,"th",88),t.qZA()),2&n){const e=t.oxw(2);t.xp6(4),t.Q6J("ngForOf",e.itemToViewLocations.selling_units)}}function _t(n,s){if(1&n&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&n){const e=s.$implicit,i=t.oxw().$implicit,o=t.oxw(2);t.xp6(1),t.hij(" ",o.getLocationUnitQuantity(i.location_quantity,o.itemToViewLocations.selling_units)[e.unit_name]," ")}}function gt(n,s){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._UZ(2,"p-avatar",84),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.ALo(5,"titlecase"),t.qZA(),t.YNc(6,_t,2,1,"td",88),t.qZA()),2&n){const e=s.$implicit,i=t.oxw(2);t.xp6(2),t.Akn(t.VKq(6,I,e.location.color)),t.xp6(2),t.Oqu(t.lcZ(5,4,e.location.name)),t.xp6(2),t.Q6J("ngForOf",i.itemToViewLocations.selling_units)}}function yt(n,s){if(1&n&&(t.TgZ(0,"p-table",87),t.YNc(1,ht,5,1,"ng-template",77),t.YNc(2,gt,7,8,"ng-template",78),t.qZA()),2&n){const e=t.oxw();t.Q6J("value",e.itemToViewLocations.locations_qty)("paginator",!1)("rows",5)}}const N=function(){return{width:"500px"}};let ft=(()=>{class n{constructor(e,i,o,a,l){this.spinner=e,this.cryptoSrv=i,this.toastr=o,this.authSrv=a,this.apiSrv=l,this.status=new t.vpe,this.paymentValid=!1,this.changeToGiveCustomer="0",this.paymentModel={},this.todayChecked="today",this.maxDate=new Date,this.displayMultiplePaymentForm=!1,this.printReceipt="yes",this.printDeliveryReceipt="no",this.receiptCustomer="",this.dateOfSale=new Date,this.showCashInput=!0,this.showMpesaInput=!0,this.showBankInput=!0,this.showNotification=!1,this.userIsAdmin=!1,this.showQuantityError=!1,this.lessItems=[],this.loaderToShow="",this.itemToViewLocations={}}ngOnInit(){"admin"===this.cryptoSrv.decryptEncodedText(this.authSrv.getUserDetailToken("role"))&&(this.userIsAdmin=!0),this.paymentModel={}}selectCustomer(e){this.cashCustomer=e.value,this.receiptCustomer="Cash customer"!=this.cashCustomer.name?this.cashCustomer.name:""}changePaymentMethod(e){this.paymentModel.pay_method=e,"cash"===e&&(this.paymentModel.cash_amount=this.totalCartAmount,this.paymentModel.mpesa_amount=0,this.paymentModel.bank_amount=0,this.paymentValid=!0),("mpesa"===e||"kcb"===e)&&(this.paymentModel.mpesa_amount=this.totalCartAmount,this.paymentModel.cash_amount=0,this.paymentModel.bank_amount=0,this.paymentValid=!0),("bank"===e||"equity"===e)&&(this.paymentModel.bank_amount=this.totalCartAmount,this.paymentModel.cash_amount=0,this.paymentModel.mpesa_amount=0,this.paymentValid=!0),this.displayMultiplePaymentForm=!1}showMultiplePaymentForm(){this.paymentValid=!1,this.paymentModel.mpesa_amount=0,this.paymentModel.bank_amount=0,this.paymentModel.cash_amount=0,this.paymentModel.pay_method="multiple",this.displayMultiplePaymentForm=!0}checkTotalAmountPaidCash(){null==this.paymentModel.cash_amount&&(this.paymentModel.cash_amount=0),null==this.paymentModel.mpesa_amount&&(this.paymentModel.mpesa_amount=0),null==this.paymentModel.bank_amount&&(this.paymentModel.bank_amount=0),parseFloat(this.paymentModel.cash_amount)+parseFloat(this.paymentModel.mpesa_amount)+parseFloat(this.paymentModel.bank_amount)===this.totalCartAmount?(this.paymentValid=!0,0===this.paymentModel.mpesa_amount&&(this.showMpesaInput=!1),0===this.paymentModel.bank_amount&&(this.showBankInput=!1)):(this.paymentValid=!1,this.showMpesaInput=!0,this.showCashInput=!0,this.showBankInput=!0)}checkTotalAmountPaidMpesa(){null==this.paymentModel.cash_amount&&(this.paymentModel.cash_amount=0),null==this.paymentModel.mpesa_amount&&(this.paymentModel.mpesa_amount=0),null==this.paymentModel.bank_amount&&(this.paymentModel.bank_amount=0),parseFloat(this.paymentModel.cash_amount)+parseFloat(this.paymentModel.mpesa_amount)+parseFloat(this.paymentModel.bank_amount)===this.totalCartAmount?(this.paymentValid=!0,0===this.paymentModel.cash_amount&&(this.showCashInput=!1),0===this.paymentModel.bank_amount&&(this.showBankInput=!1)):(this.paymentValid=!1,this.showMpesaInput=!0,this.showCashInput=!0,this.showBankInput=!0)}checkTotalAmountPaidBank(){null==this.paymentModel.cash_amount&&(this.paymentModel.cash_amount=0),null==this.paymentModel.mpesa_amount&&(this.paymentModel.mpesa_amount=0),null==this.paymentModel.bank_amount&&(this.paymentModel.bank_amount=0),parseFloat(this.paymentModel.cash_amount)+parseFloat(this.paymentModel.mpesa_amount)+parseFloat(this.paymentModel.bank_amount)===this.totalCartAmount?(this.paymentValid=!0,0===this.paymentModel.cash_amount&&(this.showCashInput=!1),0===this.paymentModel.mpesa_amount&&(this.showMpesaInput=!1)):(this.paymentValid=!1,this.showMpesaInput=!0,this.showCashInput=!0,this.showBankInput=!0)}completePayment(){this.spinner.show("pay");const e=new Date;this.dateOfSale.setHours(e.getHours()),this.dateOfSale.setMinutes(e.getMinutes()),this.dateOfSale.setSeconds(e.getSeconds());const i={action:this.cryptoSrv.encodeEncryptText("complete-cash-payment-new"),payment_method:this.cryptoSrv.encodeEncryptText(this.paymentModel.pay_method),cash_amount:this.cryptoSrv.encodeEncryptText(this.paymentModel.cash_amount.toString()),mpesa_amount:this.cryptoSrv.encodeEncryptText(this.paymentModel.mpesa_amount.toString()),bank_amount:this.cryptoSrv.encodeEncryptText(this.paymentModel.bank_amount.toString()),date_of_sale:this.cryptoSrv.encodeEncryptText(this.dateOfSale.toLocaleString("sv-SE",{hour12:!1})),added_by:this.authSrv.getUserDetailToken("uid"),customer_id:this.cashCustomer.id,customer:this.cryptoSrv.encodeEncryptText(this.receiptCustomer)};this.apiSrv.post(i).then(o=>{"error"!=o.status?"error2"!=o.status?"lock"!=o.status?(this.showNotification=!0,setTimeout(()=>{this.status.emit({status:!0,customerName:this.receiptCustomer,printReceipt:"yes"===this.printReceipt,printDeliveryReceipt:"yes"===this.printDeliveryReceipt,paymentModel:this.paymentModel,shopDetail:o.Shop})},1500),this.spinner.hide("pay")):(this.spinner.hide("pay"),this.toastr.warning(o.message)):(this.spinner.hide("pay"),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.spinner.hide("pay"),"locked"===o.message?this.toastr.warning("Item is locked by "+o.user):"Quantity less!"==o.message?(this.showQuantityError=!0,this.lessItems=o.items):this.toastr.error(o.message))}).catch(o=>{this.toastr.error(o),this.spinner.hide("pay")})}completePaymentWaiting(){this.spinner.show("pay");const e=new Date;this.dateOfSale.setHours(e.getHours()),this.dateOfSale.setMinutes(e.getMinutes()),this.dateOfSale.setSeconds(e.getSeconds());const i={action:this.cryptoSrv.encodeEncryptText("complete-cash-payment-waiting"),payment_method:this.cryptoSrv.encodeEncryptText(this.paymentModel.pay_method),cash_amount:this.cryptoSrv.encodeEncryptText(this.paymentModel.cash_amount.toString()),mpesa_amount:this.cryptoSrv.encodeEncryptText(this.paymentModel.mpesa_amount.toString()),bank_amount:this.cryptoSrv.encodeEncryptText(this.paymentModel.bank_amount.toString()),date_of_sale:this.cryptoSrv.encodeEncryptText(this.dateOfSale.toLocaleString("sv-SE",{hour12:!1})),added_by:this.authSrv.getUserDetailToken("uid"),customer_id:this.cashCustomer.id,customer:this.cryptoSrv.encodeEncryptText(this.waitingCustomer.customer)};this.apiSrv.post(i).then(o=>{"error"!=o.status?"error2"!=o.status?"lock"!=o.status?(this.showNotification=!0,setTimeout(()=>{this.status.emit({status:!0,customerName:this.waitingCustomer.customer,printReceipt:"yes"===this.printReceipt,printDeliveryReceipt:"yes"===this.printDeliveryReceipt,paymentModel:this.paymentModel,shopDetail:o.Shop})},1500),this.spinner.hide("pay")):(this.spinner.hide("pay"),this.toastr.warning(o.message)):(this.spinner.hide(),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.spinner.hide("pay"),"locked"===o.message?this.toastr.warning("Item is locked by "+o.user):"Quantity less!"==o.message?(this.showQuantityError=!0,this.lessItems=o.items):this.toastr.error(o.message))}).catch(o=>{this.toastr.error(o),this.spinner.hide("pay")})}completePaymentCashCustomer(){this.spinner.show();const e=new Date;this.dateOfSale.setHours(e.getHours()),this.dateOfSale.setMinutes(e.getMinutes()),this.dateOfSale.setSeconds(e.getSeconds());const i={action:this.cryptoSrv.encodeEncryptText("complete-cash-payment-cash-customer"),payment_method:this.cryptoSrv.encodeEncryptText(this.paymentModel.pay_method),cash_amount:this.cryptoSrv.encodeEncryptText(this.paymentModel.cash_amount.toString()),mpesa_amount:this.cryptoSrv.encodeEncryptText(this.paymentModel.mpesa_amount.toString()),bank_amount:this.cryptoSrv.encodeEncryptText(this.paymentModel.bank_amount.toString()),date_of_sale:this.cryptoSrv.encodeEncryptText(this.dateOfSale.toLocaleString("sv-SE",{hour12:!1})),added_by:this.authSrv.getUserDetailToken("uid"),customer_id:this.cashCustomer.id,name:this.cryptoSrv.encodeEncryptText(this.cashCustomer.name)};this.apiSrv.post(i).then(o=>{"error"!=o.status?"error2"!=o.status?"lock"!=o.status?(this.showNotification=!0,setTimeout(()=>{this.status.emit({status:!0,customerName:this.cashCustomer.name,printReceipt:"yes"===this.printReceipt,printDeliveryReceipt:"yes"===this.printDeliveryReceipt,paymentModel:this.paymentModel,shopDetail:o.Shop})},1500),this.spinner.hide()):(this.spinner.hide(),this.toastr.warning(o.message)):(this.spinner.hide(),this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.spinner.hide(),"locked"===o.message?this.toastr.warning("Item is locked by "+o.user):this.toastr.error(o.message))}).catch(o=>{this.toastr.error(o),this.spinner.hide()})}hidePaymentForm(){this.status.emit({status:!1,customerName:"",printReceipt:!1,printDeliveryReceipt:!1,paymentModel:{},shopDetail:{}})}showLocationsQuantityNew(e,i){this.loaderToShow=e.id,this.itemToViewLocations=e;const o={action:this.cryptoSrv.encodeEncryptText("get_item_all_locations_quantity"),item_id:e.id,added_by:this.authSrv.getUserDetailToken("uid")};this.apiSrv.read(o).then(a=>{"error"!=a.status?"error2"!=a.status?(e.selling_units=a.selling_units,e.locations_qty=a.locations_qty,e.total_qty=a.total_qty,e.locations=a.locations,this.overlay.toggle(i),this.loaderToShow=""):(this.loaderToShow="",this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout()):(this.loaderToShow="",this.toastr.error(a.message))}).catch(a=>{this.toastr.error(a),this.loaderToShow=""})}getLocationUnitQuantity(e,i){const o={};return(i=i.sort((a,l)=>l.unit_quantity-a.unit_quantity)).forEach(a=>{if(e>0){const l=Math.floor(e/a.unit_quantity);o[a.unit_name]=l,e-=l*a.unit_quantity}else o[a.unit_name]=0}),o}showLocationsQuantityOrdered(e,i,o){this.loaderToShow=e.id,this.itemToViewLocations=e;const a={action:this.cryptoSrv.encodeEncryptText("get_item_all_locations_quantity"),item_id:e.id,added_by:this.authSrv.getUserDetailToken("uid")};this.apiSrv.read(a).then(l=>{if("error"!=l.status)if("error2"!=l.status){e.selling_units=l.selling_units,e.locations_qty=l.locations_qty;let h=e.locations_qty.find(wt=>wt.location.id==i.location.id);h&&(h.location_quantity=i.qty_ordered),e.locations=l.locations,this.itemToViewLocations=e,this.overlay1.toggle(o),this.loaderToShow=""}else this.loaderToShow="",this.toastr.error("Please login again.","Login session expired!"),this.authSrv.logout();else this.loaderToShow="",this.toastr.error(l.message)}).catch(l=>{this.toastr.error(l),this.loaderToShow=""})}getLocationUnitQuantityOrdered(e,i){const o={};return(i=i.sort((a,l)=>l.unit_quantity-a.unit_quantity)).forEach(a=>{if(e>0){const l=Math.floor(e/a.unit_quantity);o[a.unit_name]=l,e-=l*a.unit_quantity}else o[a.unit_name]=0}),o}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(v.t2),t.Y36(U.$),t.Y36(Q._W),t.Y36(E.e),t.Y36(L.s))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-payment-form"]],viewQuery:function(e,i){if(1&e&&(t.Gf(B,5),t.Gf(D,5)),2&e){let o;t.iGM(o=t.CRH())&&(i.overlay=o.first),t.iGM(o=t.CRH())&&(i.overlay1=o.first)}},inputs:{totalCartAmount:"totalCartAmount",waitingCustomer:"waitingCustomer",cashCustomer:"cashCustomer",myCashCustomers:"myCashCustomers"},outputs:{status:"status"},decls:11,vars:14,consts:[["autocomplete","off",3,"ngSubmit",4,"ngIf"],[3,"message","showNotification",4,"ngIf"],["appendTo","body","modal","true","header","Items with less quantity available",3,"closable","visible","style","baseZIndex","visibleChange",4,"ngIf"],[3,"showCloseIcon"],["op1",""],["pTemplate",""],["op",""],["bdOpacity","#fff","bdColor","rgba(255,255,255,0.76)","size","medium","name","pay","color","#02926e","type","ball-clip-rotate",3,"fullScreen"],[2,"color","#02926e"],["autocomplete","off",3,"ngSubmit"],["form2","ngForm"],[1,"row","pb-3"],[1,"col-md-12"],[1,"py-2","px-2"],["placeholder","Cash customer","appendTo","body","name","cashCustomer","optionLabel","name","styleClass","ml-5",3,"options","ngModel","filter","onChange","ngModelChange"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"ui-fluid","px-2"],[1,"p-field"],["for","firstname3 py-3"],[1,"field-radiobutton"],["name","city","value","cash","inputId","city1",3,"ngModel","ngModelChange","onClick"],["for","city1",1,"primary"],[1,"fas","fa-money-bill"],["name","city","value","mpesa","inputId","city2",3,"ngModel","ngModelChange","onClick"],["for","city2",1,"success"],[1,"fas","fa-mobile-alt"],["name","city","value","bank","inputId","city3",3,"ngModel","ngModelChange","onClick"],["for","city3",1,"info"],[1,"fas","fa-money-check","info"],["name","city","value","multiple","inputId","city4",3,"ngModel","ngModelChange","onClick"],["for","city4",1,"warning"],[1,"fas","fa-tasks","tertiary"],["class","row px-2",4,"ngIf"],[1,"col-md-12","py-2"],["pay1",""],["name","today","value","today","inputId","city11",3,"ngModel","ngModelChange"],["for","today"],["class","field-radiobutton",4,"ngIf"],["appendTo","body","name","start_date","required","","readonlyInput","true",3,"ngModel","maxDate","touchUI","monthNavigator","ngModelChange",4,"ngIf"],[1,"col-md-6","pt-3"],["name","receipt1","value","yes","inputId","receipt1",3,"ngModel","ngModelChange"],["for","receipt1"],["name","receipt2","value","no","inputId","receipt2",3,"ngModel","ngModelChange"],["for","receipt2"],["name","receipt3","value","yes","inputId","receipt3",3,"ngModel","ngModelChange"],["for","receipt3"],["name","receipt4","value","no","inputId","receipt4",3,"ngModel","ngModelChange"],["for","receipt4"],["class","col-md-12 pt-3",4,"ngIf"],[1,"row","py-1","text-center"],[1,"col-12","text-center"],["type","submit","pButton","","icon","pi pi-check","label","Complete",1,"p-button-success","p-button-sm",3,"disabled"],[1,"ui-helper-clearfix"],[1,"row","px-2"],["class","col-md-12 py-2",4,"ngIf"],["for","cash"],["id","cash","name","cash_amount","required","","type","number","pInputNumber","",1,"form-control",3,"ngModel","input","ngModelChange"],["for","mpesa"],["id","mpesa","name","mpesa_amount","required","","type","number","pInputNumber","",1,"form-control",3,"ngModel","input","ngModelChange"],["for","bank"],["id","bank","name","bank_amount","required","","type","number","pInputNumber","",1,"form-control",3,"ngModel","input","ngModelChange"],["name","notToday","value","notToday","inputId","city22",3,"ngModel","ngModelChange"],["for","notToday"],["appendTo","body","name","start_date","required","","readonlyInput","true",3,"ngModel","maxDate","touchUI","monthNavigator","ngModelChange"],[1,"col-md-12","pt-3"],[1,"p-grid","p-fluid"],[1,"p-col-12","p-md-12"],[1,"p-inputgroup"],[1,"p-inputgroup-addon"],["type","text","placeholder","","pInputText","","name","customer","id","customer",3,"ngModel","ngModelChange"],[3,"message","showNotification"],["appendTo","body","modal","true","header","Items with less quantity available",3,"closable","visible","baseZIndex","visibleChange"],[1,"row"],[1,"col-12"],["styleClass","p-datatable-customers","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"value","rowHover","rows","showCurrentPageReport","rowsPerPageOptions","paginator","filterDelay","globalFilterFields"],["dt12",""],["pTemplate","header"],["pTemplate","body"],[1,"ui-selectable-row"],[2,"width","5rem"],[2,"width","10rem"],[2,"width","2rem"],[3,"click"],["label","","shape","circle"],["class","loader",4,"ngIf"],[1,"loader"],["selectionMode","single","responsiveLayout","scroll",3,"value","paginator","rows"],[4,"ngFor","ngForOf"],[1,"p-o","m-0"],[1,"small"]],template:function(e,i){1&e&&(t.YNc(0,W,73,17,"form",0),t.YNc(1,X,1,2,"app-notification",1),t.YNc(2,rt,7,16,"p-dialog",2),t.TgZ(3,"p-overlayPanel",3,4),t.YNc(5,dt,3,3,"ng-template",5),t.qZA(),t.TgZ(6,"p-overlayPanel",3,6),t.YNc(8,yt,3,3,"ng-template",5),t.qZA(),t.TgZ(9,"ngx-spinner",7),t._UZ(10,"p",8),t.qZA()),2&e&&(t.Q6J("ngIf",!i.showNotification),t.xp6(1),t.Q6J("ngIf",i.showNotification),t.xp6(1),t.Q6J("ngIf",i.showQuantityError),t.xp6(1),t.Akn(t.DdM(12,N)),t.Q6J("@enter",void 0)("showCloseIcon",!1),t.xp6(3),t.Akn(t.DdM(13,N)),t.Q6J("@enter",void 0)("showCloseIcon",!1),t.xp6(3),t.Q6J("fullScreen",!1))},dependencies:[c.sg,c.O5,v.Ro,m._Y,m.Fj,m.wV,m.JJ,m.JL,m.Q7,m.On,m.F,w.V,x.jx,T.Hq,d.iA,Z.o,P.Lt,S.T,k.H,b.q,O.EU,A.f,F.c,c.JJ,c.rS],styles:["label[_ngcontent-%COMP%]{text-transform:none}.loader[_ngcontent-%COMP%]{width:30px;aspect-ratio:2;--_g: no-repeat radial-gradient(circle closest-side,#02926e 90%,#ffffff);background:var(--_g) 0% 50%,var(--_g) 50% 50%,var(--_g) 100% 50%;background-size:33.3333333333% 50%;animation:l3 1s infinite linear}@keyframes l3{20%{background-position:0% 0%,50% 50%,100% 50%}40%{background-position:0% 100%,50% 0%,100% 50%}60%{background-position:0% 50%,50% 100%,100% 0%}80%{background-position:0% 50%,50% 50%,100% 100%}}"],data:{animation:[(0,_.X$)("enter",[(0,_.eR)("void => *",[(0,_.oB)({opacity:0}),(0,_.jt)(1e3,(0,_.oB)({opacity:1}))])])]}}),n})();var Ct=r(2137),Mt=r(5722),vt=r(3608),C=r(9091),xt=r(7147);let Tt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[u,M.U]}),n})();t.B6R(p.E,[c.sg,c.O5,v.Ro,m._Y,m.Fj,m.wV,m.JJ,m.JL,m.Q7,m.c5,m.On,m.F,w.V,x.$_,x.jx,Ct.Q,T.Hq,T.zx,d.iA,d.lQ,d.YL,d.fz,d.D$,d.Pv,d.U1,d.wT,Mt.NU,Z.o,P.Lt,vt.u,C.jt,C.iD,C.Vi,C.TH,S.T,k.H,b.q,A.f,xt.A,F.c,ft],[c.JJ,c.rS,c.H9,c.uU])},3942:(J,g,r)=>{r.d(g,{c:()=>y});var p=r(4650);let y=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(u){return new(u||t)},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-notification"]],inputs:{message:"message",showNotification:"showNotification"},decls:6,vars:1,consts:[[1,"wrapper1"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 52 52",1,"checkmark"],["cx","26","cy","26","r","25","fill","none",1,"checkmark__circle"],["fill","none","d","M14.1 27.2l7.1 7.2 16.7-16.8",1,"checkmark__check"],[2,"position","absolute","margin-top","150px","margin-bottom","50px","font-weight","bold"]],template:function(u,M){1&u&&(p.TgZ(0,"div",0),p.O4$(),p.TgZ(1,"svg",1),p._UZ(2,"circle",2)(3,"path",3),p.qZA(),p.kcU(),p.TgZ(4,"p",4),p._uU(5),p.qZA()()),2&u&&(p.xp6(5),p.hij(" ",M.message," "))},styles:["*[_ngcontent-%COMP%]{padding:0;margin:0}.wrapper1[_ngcontent-%COMP%]{height:100%;display:flex;justify-content:center;align-items:center;background-color:transparent}.checkmark__circle[_ngcontent-%COMP%]{stroke-dasharray:166;stroke-dashoffset:166;stroke-width:2;stroke-miterlimit:10;stroke:#7ac142;fill:none;animation:stroke .6s cubic-bezier(.65,0,.45,1) forwards}.checkmark[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%;display:block;stroke-width:2;stroke:#fff;stroke-miterlimit:10;margin:10% auto;box-shadow:inset 0 0 #7ac142;animation:fill .4s ease-in-out .4s forwards,scale .3s ease-in-out .9s both}.checkmark__check[_ngcontent-%COMP%]{transform-origin:50% 50%;stroke-dasharray:48;stroke-dashoffset:48;animation:stroke .3s cubic-bezier(.65,0,.45,1) .8s forwards}@keyframes stroke{to{stroke-dashoffset:0}}@keyframes scale{0%,to{transform:none}50%{transform:scale3d(1.1,1.1,1)}}@keyframes fill{to{box-shadow:inset 0 0 0 30px #7ac142}}"]}),t})()}}]);